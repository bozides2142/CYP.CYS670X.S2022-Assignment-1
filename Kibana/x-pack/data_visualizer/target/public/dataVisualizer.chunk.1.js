/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[1],{138:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(139);case"v8light":return r(141)}},139:function(e,t,r){var a=r(50),n=r(140);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1};a(n,i);e.exports=n.locals||{}},140:function(e,t,r){(t=r(51)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}@media only screen and (max-width: 574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 575px) and (max-width: 767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 768px) and (max-width: 991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}\n",""]),e.exports=t},141:function(e,t,r){var a=r(50),n=r(142);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1};a(n,i);e.exports=n.locals||{}},142:function(e,t,r){(t=r(51)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}@media only screen and (max-width: 574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 575px) and (max-width: 767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 768px) and (max-width: 991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%, 500px)}.dvSearchPanel__controls{padding:0}.globalFilterGroup__wrapper-isVisible{margin:0 !important}}\n",""]),e.exports=t},143:function(e,t,r){e.exports=r(14)(14)},144:function(e,t,r){e.exports=r(14)(13)},145:function(e,t,r){e.exports=r(14)(4)},146:function(e,t,r){e.exports=r(14)(19)},147:function(e,t,r){e.exports=r(14)(2453)},148:function(e,t,r){e.exports=r(14)(2460)},149:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(150);case"v8light":return r(152)}},150:function(e,t,r){var a=r(50),n=r(151);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1};a(n,i);e.exports=n.locals||{}},151:function(e,t,r){(t=r(51)(!1)).push([e.i,".dataViewTitleHeader{min-width:300px;display:flex;flex-direction:row;align-items:center}@media only screen and (max-width: 574px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 575px) and (max-width: 767px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 768px) and (max-width: 991px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}\n",""]),e.exports=t},152:function(e,t,r){var a=r(50),n=r(153);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1};a(n,i);e.exports=n.locals||{}},153:function(e,t,r){(t=r(51)(!1)).push([e.i,".dataViewTitleHeader{min-width:300px;display:flex;flex-direction:row;align-items:center}@media only screen and (max-width: 574px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 575px) and (max-width: 767px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 768px) and (max-width: 991px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}@media only screen and (min-width: 992px) and (max-width: 1199px){.dataVisualizerPageHeader{flex-direction:column;align-items:flex-start}}\n",""]),e.exports=t},52:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a=(e,t=[])=>"object"==typeof e&&null!==e&&Object.keys(e).length>0&&(0===t.length||t.every((t=>({}.hasOwnProperty.call(e,t)))))},53:function(e,t,r){e.exports=r(14)(2455)},61:function(e,t,r){e.exports=r(14)(8)},62:function(e,t,r){"use strict";r.d(t,"c",(function(){return ae})),r.d(t,"b",(function(){return ne})),r.d(t,"a",(function(){return se}));var a=r(0),n=r.n(a),i=r(21),s=r(1),o=r(31),l=r(22),u=r(25),c=r.n(u),d=(r(69),r(52)),f=r(9);var p=r(23);const m=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const r=Object(p.cloneDeep)(e);return delete r.match_all,Object(d.a)(r.bool)?Array.isArray(r.bool.must_not)?r.bool.must_not.push(t):(Object(d.a)(r.bool.must_not)&&(r.bool.must_not=[r.bool.must_not,t]),void 0===r.bool.must_not&&(r.bool.must_not=[t])):r.bool={must_not:[t]},r};async function g(e,t,r,a){const n=t.getComputedFields().runtimeFields,i=await async function({index:e,timeFieldName:t,query:r,runtimeMappings:a}){const n=JSON.stringify({index:e,timeFieldName:t,query:r,runtimeMappings:a}),i=await Object(f.a)();return await i.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",body:n})}({index:t.title,timeFieldName:t.timeFieldName,query:a?m(r):r,...Object(d.a)(n)?{runtimeMappings:n}:{}});return e.setTime({from:c()(i.start.epoch).toISOString(),to:c()(i.end.epoch).toISOString()}),i}var b=r(49);var h=r(5);const v="exclude-frozen",y="include-frozen",x=({timefilter:e,indexPattern:t,query:r,disabled:n,callback:o})=>{const{services:{notifications:{toasts:u}}}=Object(b.a)(),c=Object(a.useCallback)((async(t,r,a)=>{try{const n=await g(e,t,r,a);"function"==typeof o&&o(n)}catch(e){u.addDanger(s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range."}))}}),[o,e,u]),[d,f]=Object(a.useState)(!1),[p,m]=function(e,t){var r;const{services:{storage:n}}=Object(b.a)(),[i,s]=Object(a.useState)(null!==(r=n.get(e))&&void 0!==r?r:t);return[i,Object(a.useCallback)((t=>{try{n.set(e,t),s(t)}catch(e){throw new Error("Unable to update storage with provided value")}}),[e,n])]}("dataVisualizer.frozenDataTierPreference",v),x=Object(a.useCallback)((e=>{m(e),c(t,r,e===v),j()}),[t,r,m,c]),j=()=>{f(!1)},O=Object(a.useMemo)((()=>[{id:v,label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataExcludingFrozenMenuLabel",{defaultMessage:"Exclude frozen data tier"})},{id:y,label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataIncludingFrozenMenuLabel",{defaultMessage:"Include frozen data tier"})}]),[]),S=Object(a.useMemo)((()=>Object(h.jsx)(i.EuiPanel,null,Object(h.jsx)(i.EuiRadioGroup,{options:O,idSelected:p,onChange:x,compressed:!0}))),[O,p,x]),E=Object(a.useMemo)((()=>p===v?Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataExcludingFrozenButtonTooltip",defaultMessage:"Use full range of data excluding frozen data tier."}):Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataIncludingFrozenButtonTooltip",defaultMessage:"Use full range of data including frozen data tier, which might have slower search results."})),[p]);return Object(h.jsx)(i.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(h.jsx)(i.EuiToolTip,{content:E},Object(h.jsx)(i.EuiButton,{isDisabled:n,onClick:()=>c(t,r,!0),"data-test-subj":"dataVisualizerButtonUseFullData"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full data"}))),Object(h.jsx)(i.EuiFlexItem,{grow:!1},Object(h.jsx)(i.EuiPopover,{id:"mlFullTimeRangeSelectorOption",button:Object(h.jsx)(i.EuiButtonIcon,{display:"base",size:"m",iconType:"boxesVertical","aria-label":s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.moreOptionsButtonAriaLabel",{defaultMessage:"More options"}),onClick:()=>{f(!d)}}),isOpen:d,closePopover:j,panelPaddingSize:"none",anchorPosition:"downRight"},S)))};var j=r(10),O=r(72),S=r(92),E=r(84),_=r(85),F=r(95);const w=({metricsStats:e,fieldsCountStats:t,showEmptyFields:r,toggleShowEmptyFields:a})=>Object(h.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"xs","data-test-subj":"dataVisualizerFieldCountPanel",responsive:!1,className:"dvFieldCount__panel"},Object(h.jsx)(F.b,{fieldsCountStats:t}),Object(h.jsx)(F.a,{metricsStats:e}),Object(h.jsx)(i.EuiFlexItem,{className:"dvFieldCount__item"},Object(h.jsx)(i.EuiSwitch,{"data-test-subj":"dataVisualizerShowEmptyFieldsSwitch",label:Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:r,onChange:a})));var N=r(28),T=r(42);const M=({width:e,chartPoints:t,timeRangeEarliest:r,timeRangeLatest:n,interval:i})=>{const{services:{data:o,uiSettings:l,fieldFormats:u,charts:d}}=Object(b.a)(),f=d.theme.useChartsTheme(),p=d.theme.useChartsBaseTheme(),m=u.deserialize({id:"date"}),g=l.get("visualization:useLegacyTimeAxis",!1),v=s.i18n.translate("xpack.dataVisualizer.dataGrid.field.documentCountChart.seriesLabel",{defaultMessage:"document count"}),y={min:r,max:n},x=Object(a.useMemo)((()=>t.length<1?[{time:r,value:0}]:1===t.length?[...t,{time:i?Number(t[0].time)+i:r,value:0}]:t),[t,r,n,i]),j=Object(a.useCallback)((e=>{o.query.timefilter.timefilter.setTime({from:c()(e.from).toISOString(),to:c()(e.to).toISOString(),mode:"absolute"})}),[o]),O=function(e){if(e.isDefault("dateFormat:tz")){return c.a.tz.guess()||c()().format("Z")}return e.get("dateFormat:tz","Browser")}(l);return Object(h.jsx)("div",{style:{width:null!=e?e:"100%"},"data-test-subj":"dataVisualizerDocumentCountChart"},Object(h.jsx)(N.Chart,{size:{width:"100%",height:120}},Object(h.jsx)(N.Settings,{xDomain:y,onBrushEnd:({x:e})=>{if(!e)return;const[t,r]=e;j({from:t,to:r})},onElementClick:([e])=>{const t=e[0].x;j({from:t,to:t+i})},theme:f,baseTheme:p}),Object(h.jsx)(N.Axis,{id:"bottom",position:N.Position.Bottom,showOverlappingTicks:!0,tickFormat:e=>m.convert(e),timeAxisLayerCount:g?0:2,style:g?{}:T.MULTILAYER_TIME_AXIS_STYLE}),Object(h.jsx)(N.Axis,{id:"left",position:N.Position.Left}),Object(h.jsx)(N.BarSeries,{id:"document_count",name:v,xScaleType:N.ScaleType.Time,yScaleType:N.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:x,timeZone:O})))},A=({totalCount:e})=>Object(h.jsx)(i.EuiFlexItem,null,Object(h.jsx)(i.EuiText,{size:"s","data-test-subj":"dataVisualizerTotalDocCountHeader"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountLabel",defaultMessage:"Total documents: {strongTotalCount}",values:{strongTotalCount:Object(h.jsx)("strong",{"data-test-subj":"dataVisualizerTotalDocCount"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountNumber",defaultMessage:"{totalCount, plural, one {#} other {#}}",values:{totalCount:e}}))}}))),I=({documentCountStats:e,totalCount:t})=>{if(void 0===e)return void 0!==t?Object(h.jsx)(A,{totalCount:t}):null;const{timeRangeEarliest:r,timeRangeLatest:a}=e;if(void 0===r||void 0===a)return null;let i=[];if(void 0!==e.buckets){const t=null==e?void 0:e.buckets;i=Object.entries(t).map((([e,t])=>({time:+e,value:t})))}return Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(A,{totalCount:t}),Object(h.jsx)(M,{chartPoints:i,timeRangeEarliest:r,timeRangeLatest:a,interval:e.interval}))};var z=r(4),C=r(60);const P=[1e3,5e3,1e4,1e5,-1].map((e=>({value:String(e),inputDisplay:e>0?Object(h.jsx)("span",{"data-test-subj":`dataVisualizerShardSizeOption ${e}`},Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.sampleSizeOptionLabel",defaultMessage:"Sample size (per shard): {wrappedValue}",values:{wrappedValue:Object(h.jsx)("b",null,e)}})):Object(h.jsx)("span",{"data-test-subj":"dataVisualizerShardSizeOption all"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.allOptionLabel",defaultMessage:"Search all"}))}))),k=({samplerShardSize:e,setSamplerShardSize:t})=>Object(h.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(h.jsx)(i.EuiFlexItem,{grow:!1,style:{width:310}},Object(h.jsx)(i.EuiSuperSelect,{options:P,valueOfSelected:String(e),onChange:e=>t(+e),"aria-label":s.i18n.translate("xpack.dataVisualizer.searchPanel.sampleSizeAriaLabel",{defaultMessage:"Select number of documents to sample"}),"data-test-subj":"dataVisualizerShardSizeSelect"})),Object(h.jsx)(i.EuiFlexItem,{grow:!1},Object(h.jsx)(i.EuiIconTip,{content:s.i18n.translate("xpack.dataVisualizer.searchPanel.queryBarPlaceholder",{defaultMessage:"Selecting a smaller sample size will reduce query run times and the load on the cluster."}),position:"right"})));var R=r(66);const V=({overallStats:e,setVisibleFieldNames:t,visibleFieldNames:r,showEmptyFields:n})=>{const i=Object(a.useMemo)((()=>{const t=[];return e&&Object.keys(e).forEach((r=>{const a=e[r];Array.isArray(a)&&a.length>0&&a.forEach((e=>{!0!==e.existsInDocs&&!0!==n||void 0===e.fieldName||t.push({value:e.fieldName})}))})),t}),[e,n]),o=Object(a.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldNameSelect",{defaultMessage:"Field name"})),[]);return Object(h.jsx)(R.a,{title:o,options:i,onChange:t,checkedOptions:r,dataTestSubj:"dataVisualizerFieldNameSelect"})};var q=r(73);const L=({indexedFieldTypes:e,setVisibleFieldTypes:t,visibleFieldTypes:r})=>{const n=Object(a.useMemo)((()=>e.map((e=>{var t;const r=null!==(t=C.b[e])&&void 0!==t?t:"";return{value:e,name:Object(h.jsx)(i.EuiFlexGroup,null,Object(h.jsx)(i.EuiFlexItem,{grow:!0}," ",r),e&&Object(h.jsx)(i.EuiFlexItem,{grow:!1},Object(h.jsx)(q.a,{type:e,tooltipEnabled:!1})))}}))),[e]),o=Object(a.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldTypeSelect",{defaultMessage:"Field type"})),[]);return Object(h.jsx)(R.a,{title:o,options:n,onChange:t,checkedOptions:r,dataTestSubj:"dataVisualizerFieldTypeSelect"})};r(138);var B=r(71);const D=({indexPattern:e,searchString:t,searchQueryLanguage:r,samplerShardSize:n,setSamplerShardSize:o,overallStats:l,indexedFieldTypes:u,setVisibleFieldTypes:c,visibleFieldTypes:d,setVisibleFieldNames:f,visibleFieldNames:p,setSearchParams:m,showEmptyFields:g})=>{const{services:{uiSettings:v,notifications:{toasts:y},data:{query:x,ui:{SearchBar:j}}}}=Object(b.a)(),[O,S]=Object(a.useState)({query:t||"",language:r});Object(a.useEffect)((()=>{S({query:t||"",language:r})}),[r,t,x.filterManager]);const E=({query:t,filters:r})=>{const a=null!=t?t:O,n=null!=r?r:x.filterManager.getFilters();try{var i;n&&x.filterManager.setFilters(n);const t=Object(B.a)(a,null!==(i=x.filterManager.getFilters())&&void 0!==i?i:[],e,v);m({searchQuery:t,searchString:a.query,queryLanguage:a.language,filters:n})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2)),y.addError(e,{title:s.i18n.translate("xpack.dataVisualizer.searchPanel.invalidSyntax",{defaultMessage:"Invalid syntax"})})}};return Object(h.jsx)(i.EuiFlexGroup,{gutterSize:"s",alignItems:"flexStart","data-test-subj":"dataVisualizerSearchPanel",className:"dvSearchPanel__container",responsive:!1},Object(h.jsx)(i.EuiFlexItem,{grow:9,className:"dvSearchBar"},Object(h.jsx)(j,{dataTestSubj:"dataVisualizerQueryInput",appName:"dataVisualizer",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:O,onQuerySubmit:e=>E({query:e.query}),onFiltersUpdated:e=>E({filters:e}),indexPatterns:[e],placeholder:s.i18n.translate("xpack.dataVisualizer.searchPanel.queryBarPlaceholderText",{defaultMessage:'Searchâ€¦ (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,customSubmitButton:Object(h.jsx)("div",null)})),Object(h.jsx)(i.EuiFlexItem,{grow:2,className:"dvSearchPanel__controls"},Object(h.jsx)(k,{samplerShardSize:n,setSamplerShardSize:o}),Object(h.jsx)(V,{overallStats:l,setVisibleFieldNames:f,visibleFieldNames:p,showEmptyFields:g}),Object(h.jsx)(L,{indexedFieldTypes:u,setVisibleFieldTypes:c,visibleFieldTypes:d})))};var Q=r(35),G=r(68),U=r.n(G);const $=({icon:e,iconAreaLabel:t,title:r,description:a,onClick:n,href:s,isDisabled:o,"data-test-subj":l})=>{const u={...s?{href:s}:{},...n?{onClick:n}:{}};return Object(h.jsx)(i.EuiPanel,{style:{cursor:o?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(h.jsx)(i.EuiLink,U()({style:{display:"block",pointerEvents:o?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":l,color:"subdued"},u),Object(h.jsx)(i.EuiFlexGroup,{gutterSize:"l",responsive:!0},Object(h.jsx)(i.EuiFlexItem,{grow:!1,style:{paddingTop:"8px"}},"string"==typeof e?Object(h.jsx)(i.EuiIcon,{size:"xl",type:e,"aria-label":t}):e),Object(h.jsx)(i.EuiFlexItem,null,Object(h.jsx)(i.EuiTitle,{size:"s"},Object(h.jsx)("h3",null,r)),Object(h.jsx)(i.EuiText,{color:"subdued"},Object(h.jsx)("p",null,a))))))},H=({indexPattern:e,searchString:t,searchQueryLanguage:r,additionalLinks:o})=>{const[u]=Object(j.f)("_g"),[c,d]=Object(a.useState)(""),[f,p]=Object(a.useState)({}),{services:{data:m,application:{capabilities:g},share:{urlGenerators:{getUrlGenerator:v}}}}=Object(b.a)();return Object(a.useEffect)((()=>{let a=!1;const n=e.id;return Promise.all(o.map((async({canDisplay:e,getUrl:t})=>!1===await e({indexPatternId:n})?null:t({globalState:u,indexPatternId:n})))).then((e=>{const t=e.reduce(((e,t,r)=>(null!==t&&(e[o[r].id]=t),e)),{});p(t)})),(async()=>{var e,i,s;if(!(null!==(e=null===(i=g.discover)||void 0===i?void 0:i.show)&&void 0!==e&&e))return;const o={indexPatternId:n};let l;o.filters=null!==(s=m.query.filterManager.getFilters())&&void 0!==s?s:[],t&&void 0!==r&&(o.query={query:t,language:r}),null!=u&&u.time&&(o.timeRange=u.time),null!=u&&u.refreshInterval&&(o.refreshInterval=u.refreshInterval);try{l=v(Q.DISCOVER_APP_URL_GENERATOR)}catch(e){return}const c=await l.createUrl(o);a||d(c)})(),()=>{a=!0}}),[e,t,r,u,g,v,o,m.query]),Object(h.jsx)("div",{"data-test-subj":"dataVisualizerActionsPanel"},o.filter((({id:e})=>void 0!==f[e])).map((e=>Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)($,{href:f[e.id],icon:e.icon,description:e.description,title:e.title,"data-test-subj":e.dataTestSubj}),Object(h.jsx)(i.EuiSpacer,{size:"m"})))),c&&Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(i.EuiTitle,{size:"s"},Object(h.jsx)("h2",null,Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),Object(h.jsx)(i.EuiSpacer,{size:"m"}),Object(h.jsx)($,{href:c,icon:"discoverApp",description:s.i18n.translate("xpack.dataVisualizer.index.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:Object(h.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"dataVisualizerViewInDiscoverCard"})))};var W=r(24),K=r(64);function J(e){K.a.next({lastRefresh:Date.now(),timeRange:e})}const Y=()=>{var e;const{services:t}=Object(b.a)(),r=t.uiSettings,{timefilter:n,history:s}=t.data.query.timefilter,[l,u]=Object(j.f)("_g"),c=(d=s,function(){var e,t;return null!==(e=null===(t=d.get())||void 0===t?void 0:t.map((({from:e,to:t})=>({start:e,end:t}))))&&void 0!==e?e:[]});var d;const f=null!==(e=null==l?void 0:l.refreshInterval)&&void 0!==e?e:n.getRefreshInterval(),m=Object(a.useCallback)(Object(p.debounce)((e=>{u("refreshInterval",e,!0)}),200),[u]),[g,v]=Object(a.useState)(n.getTime()),[y,x]=Object(a.useState)(c()),[O,S]=Object(a.useState)(n.isAutoRefreshSelectorEnabled()),[E,_]=Object(a.useState)(n.isTimeRangeSelectorEnabled()),F=r.get("dateFormat"),w=r.get(o.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),N=Object(a.useMemo)((()=>w.map((({from:e,to:t,display:r})=>({start:e,end:t,label:r})))),[w]);Object(a.useEffect)((()=>{const e=new W.Subscription,t=n.getRefreshIntervalUpdate$();void 0!==t&&e.add(t.subscribe((e=>{m(n.getRefreshInterval())})));const r=n.getTimeUpdate$();void 0!==r&&e.add(r.subscribe((e=>{v(n.getTime())})));const a=n.getEnabledUpdated$();return void 0!==a&&e.add(a.subscribe((e=>{S(n.isAutoRefreshSelectorEnabled()),_(n.isTimeRangeSelectorEnabled())}))),function(){e.unsubscribe()}}),[m,n]);const T=f.pause||!f.pause&&!f.value;return O||E?Object(h.jsx)("div",{className:"mlNavigationMenu__datePickerWrapper"},Object(h.jsx)(i.EuiSuperDatePicker,{start:g.from,end:g.to,isPaused:T,isAutoRefreshOnly:!E,refreshInterval:f.value,onTimeChange:function({start:e,end:t}){const r={from:e,to:t};n.setTime(r),v(r),x(c())},onRefresh:J,onRefreshChange:function({isPaused:e,refreshInterval:t}){m({pause:e,value:t})},recentlyUsedRanges:y,dateFormat:F,commonlyUsedRanges:N})):null};var Z=r(88);const X=n.a.memo((({docLink:e})=>{const{chrome:t}=Object(b.a)().services;return Object(a.useEffect)((()=>{t.setHelpExtension({appName:Z.a,links:[{href:e,linkType:"documentation"}]})}),[t,e]),null}));function ee(e){const{services:{dataViewFieldEditor:t,application:r}}=Object(b.a)(),{useNewFieldsApi:n,currentIndexPattern:o}=e,l=!!(null==t?void 0:t.userPermissions.editIndexPattern())&&n,[u,c]=Object(a.useState)(!1),d=Object(a.useRef)();if(Object(a.useEffect)((()=>()=>{d.current&&d.current()}),[]),void 0===t||!o||!l)return null;return Object(h.jsx)(i.EuiPopover,{panelPaddingSize:"s",isOpen:u,closePopover:()=>{c(!1)},ownFocus:!0,"data-test-subj":"dataVisualizerIndexPatternManagementPopover",button:Object(h.jsx)(i.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"dataVisualizerIndexPatternManagementButton","aria-label":s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{c(!u)}})},Object(h.jsx)(i.EuiContextMenuPanel,{"data-test-subj":"dataVisualizerIndexPatternManagementMenu",size:"s",items:[Object(h.jsx)(i.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"dataVisualizerAddIndexPatternFieldAction",onClick:()=>{c(!1),d.current=t.openEditor({ctx:{dataView:o},onSave:()=>{const e={lastRefresh:Date.now()};K.a.next(e)}})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.addFieldButton",{defaultMessage:"Add field to data view"})),Object(h.jsx)(i.EuiContextMenuItem,{key:"manage",icon:"indexSettings","data-test-subj":"dataVisualizerManageIndexPatternAction",onClick:()=>{var t;c(!1),r.navigateToApp("management",{path:`/kibana/indexPatterns/patterns/${null===(t=e.currentIndexPattern)||void 0===t?void 0:t.id}`})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.manageFieldButton",{defaultMessage:"Manage data view fields"}))]}))}X.displayName="HelpMenu";var te=r(90);r(149);const re={match_all:{}};function ae(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:!1,nonMetricConfigs:[],nonMetricsLoaded:!1,documentCountStats:void 0}}const ne=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],samplerShardSize:5e3,searchString:"",searchQuery:re,searchQueryLanguage:_.a.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,...e}),ie=ne(),se=e=>{var t,r,n,l,u;const{services:c}=Object(b.a)(),{docLinks:d,notifications:f,uiSettings:p,data:m}=c,{toasts:g}=f,[v,y]=Object(j.e)(E.a,ie),[_,F]=Object(j.f)("_g"),[N,T]=Object(a.useState)(e.currentSavedSearch),{currentIndexPattern:M,additionalLinks:A,currentSessionId:P}=e;Object(a.useEffect)((()=>{void 0!==(null==e?void 0:e.currentSavedSearch)&&T(null==e?void 0:e.currentSavedSearch)}),[null==e?void 0:e.currentSavedSearch]),Object(a.useEffect)((()=>{M.isTimeBased()||g.addWarning({title:s.i18n.translate("xpack.dataVisualizer.index.indexPatternNotBasedOnTimeSeriesNotificationTitle",{defaultMessage:"The index pattern {indexPatternTitle} is not based on a time series",values:{indexPatternTitle:M.title}}),text:s.i18n.translate("xpack.dataVisualizer.index.indexPatternNotBasedOnTimeSeriesNotificationDescription",{defaultMessage:"Anomaly detection only runs over time-based indices"})})}),[M,g]);const k=M.fields,R=Object(a.useMemo)((()=>{const e=[];return k.forEach((t=>{if(!z.g.includes(t.name)&&!0!==t.scripted){const r=Object(C.c)(t);void 0===r||e.includes(r)||e.push(r)}})),e.sort()}),[k]),V=Object(a.useCallback)((e=>{null!==N&&T(null),y({...v,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[N,v,y]),q=null!==(t=v.samplerShardSize)&&void 0!==t?t:ie.samplerShardSize,L=null!==(r=v.visibleFieldTypes)&&void 0!==r?r:ie.visibleFieldTypes,Q=null!==(n=v.visibleFieldNames)&&void 0!==n?n:ie.visibleFieldNames,G=null!==(l=v.showEmptyFields)&&void 0!==l?l:ie.showEmptyFields,U=Object(a.useMemo)((()=>({indexPattern:M,savedSearch:N,sessionId:P,visibleFieldNames:Q,allowEditDataView:!0})),[M.id,null==N?void 0:N.id,Q,P]),{configs:$,searchQueryLanguage:W,searchString:K,overallStats:J,searchQuery:Z,documentCountStats:re,metricsStats:ae,timefilter:ne,setLastRefresh:se,progress:oe,extendedColumns:le}=Object(te.a)(U,v,F);Object(a.useEffect)((()=>()=>{m.query.filterManager.removeAll()}),[M.id,m.query.filterManager]),Object(a.useEffect)((()=>{se(Date.now())}),[M.id,se]),Object(a.useEffect)((()=>{void 0!==(null==_?void 0:_.time)&&ne.setTime({from:_.time.from,to:_.time.to})}),[JSON.stringify(null==_?void 0:_.time),ne]),Object(a.useEffect)((()=>{void 0!==(null==_?void 0:_.refreshInterval)&&ne.setRefreshInterval(_.refreshInterval)}),[JSON.stringify(null==_?void 0:_.refreshInterval),ne]);const ue=Object(a.useCallback)(((e,t,r)=>{var a;const n=Object(o.generateFilters)(m.query.filterManager,e,t,r,String(M.id));n&&m.query.filterManager.addFilters(n);const i={query:K||"",language:W},s=Object(B.a)({query:K||"",language:W},null!==(a=m.query.filterManager.getFilters())&&void 0!==a?a:[],M,p);V({searchQuery:s,searchString:i.query,queryLanguage:i.language,filters:m.query.filterManager.getFilters()})}),[M,m.query.filterManager,W,K,V,p]),ce=Object(a.useMemo)((()=>{let e=0,t=0;return Object.keys(J).forEach((e=>{const r=J[e];Array.isArray(r)&&r.length>0&&(t+=r.length)})),e=!0===G?t:J.aggregatableExistsFields.length+J.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[J,G]),de=Object(a.useCallback)((function(e,t){return e.reduce(((e,r)=>{const a=t.find((e=>e.fieldName===r));return void 0!==a&&(e[r]=Object(h.jsx)(S.a,{item:a,indexPattern:M,combinedQuery:{searchQueryLanguage:W,searchString:K},onAddFilter:ue})),e}),{})}),[M,W,K,ue]),fe=Object(a.useRef)();Object(a.useEffect)((()=>{const e=fe;return()=>{e.current&&e.current()}}),[]),Object(a.useEffect)((()=>{null==m||m.query.queryString.setQuery({query:K,language:W})}),[m,W,K]);const pe=d.links.ml.guide;return Object(h.jsx)(a.Fragment,null,Object(h.jsx)(i.EuiPageBody,{"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none",panelled:!1},Object(h.jsx)(i.EuiFlexGroup,{gutterSize:"m"},Object(h.jsx)(i.EuiFlexItem,null,Object(h.jsx)(i.EuiPageContentHeader,{className:"dataVisualizerPageHeader"},Object(h.jsx)(i.EuiPageContentHeaderSection,null,Object(h.jsx)("div",{className:"dataViewTitleHeader"},Object(h.jsx)(i.EuiTitle,null,Object(h.jsx)("h1",null,M.title)),Object(h.jsx)(ee,{currentIndexPattern:M,useNewFieldsApi:!0}))),Object(h.jsx)(i.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},void 0!==M.timeFieldName&&Object(h.jsx)(i.EuiFlexItem,{grow:!1},Object(h.jsx)(x,{indexPattern:M,query:void 0,disabled:!1,timefilter:ne})),Object(h.jsx)(i.EuiFlexItem,{grow:!1},Object(h.jsx)(Y,null)))))),Object(h.jsx)(i.EuiSpacer,{size:"m"}),Object(h.jsx)(i.EuiPageContentBody,null,Object(h.jsx)(i.EuiFlexGroup,{gutterSize:"m"},Object(h.jsx)(i.EuiFlexItem,null,Object(h.jsx)(i.EuiPanel,{hasShadow:!1,hasBorder:!0},void 0!==(null==J?void 0:J.totalCount)&&Object(h.jsx)(i.EuiFlexItem,{grow:!0},Object(h.jsx)(I,{documentCountStats:re,totalCount:J.totalCount})),Object(h.jsx)(D,{indexPattern:M,searchString:K,searchQuery:Z,searchQueryLanguage:W,setSearchParams:V,samplerShardSize:q,setSamplerShardSize:e=>{y({...v,samplerShardSize:e})},overallStats:J,indexedFieldTypes:R,setVisibleFieldTypes:e=>{y({...v,visibleFieldTypes:e})},visibleFieldTypes:L,visibleFieldNames:Q,setVisibleFieldNames:e=>{y({...v,visibleFieldNames:e})},showEmptyFields:G,onAddFilter:ue}),Object(h.jsx)(i.EuiSpacer,{size:"m"}),Object(h.jsx)(w,{showEmptyFields:G,toggleShowEmptyFields:()=>{y({...v,showEmptyFields:!v.showEmptyFields})},fieldsCountStats:ce,metricsStats:ae}),Object(h.jsx)(i.EuiSpacer,{size:"m"}),Object(h.jsx)(i.EuiProgress,{value:oe,max:100,size:"xs"}),Object(h.jsx)(O.a,{items:$,pageState:v,updatePageState:y,getItemIdToExpandedRowMap:de,extendedColumns:le,loading:oe<100,showPreviewByDefault:null===(u=v.showDistributions)||void 0===u||u,onChange:y}))),Object(h.jsx)(i.EuiFlexItem,{grow:!1,style:{width:"280px"}},Object(h.jsx)(H,{indexPattern:M,searchQueryLanguage:W,searchString:K,additionalLinks:null!=A?A:[]}))))),Object(h.jsx)(X,{docLink:pe}))}},64:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(24);const n=new a.Subject},69:function(e,t,r){e.exports=r(14)(129)},70:function(e,t,r){e.exports=r(14)(21)},71:function(e,t,r){"use strict";r.d(t,"a",(function(){return nt})),r.d(t,"b",(function(){return it}));var a={};r.r(a),r.d(a,"buildNode",(function(){return q})),r.d(a,"toElasticsearchQuery",(function(){return L}));var n={};r.r(n),r.d(n,"wildcardSymbol",(function(){return B})),r.d(n,"buildNode",(function(){return G})),r.d(n,"test",(function(){return U})),r.d(n,"toElasticsearchQuery",(function(){return $})),r.d(n,"toQueryStringQuery",(function(){return H})),r.d(n,"hasLeadingWildcard",(function(){return W}));var i={};r.r(i),r.d(i,"buildNodeParams",(function(){return te})),r.d(i,"toElasticsearchQuery",(function(){return re}));var s={};r.r(s),r.d(s,"buildNodeParams",(function(){return ae})),r.d(s,"toElasticsearchQuery",(function(){return ne}));var o={};r.r(o),r.d(o,"buildNodeParams",(function(){return ie})),r.d(o,"toElasticsearchQuery",(function(){return se}));var l={};r.r(l),r.d(l,"buildNodeParams",(function(){return oe})),r.d(l,"toElasticsearchQuery",(function(){return le}));var u={};r.r(u),r.d(u,"buildNodeParams",(function(){return ue})),r.d(u,"toElasticsearchQuery",(function(){return ce}));var c={};r.r(c),r.d(c,"buildNodeParams",(function(){return de})),r.d(c,"toElasticsearchQuery",(function(){return fe}));var d={};r.r(d),r.d(d,"buildNodeParams",(function(){return pe})),r.d(d,"toElasticsearchQuery",(function(){return me}));var f={};r.r(f),r.d(f,"buildNode",(function(){return be})),r.d(f,"buildNodeWithArgumentNodes",(function(){return he})),r.d(f,"toElasticsearchQuery",(function(){return ve}));var p,m,g=r(23),b=r.n(g),h=r(2),v=r.n(h),y=r(53),x=r.n(y),j=r(86),O=r.n(j),S=function(e,t){if("boolean"!=typeof t&&"boolean"===e.type){if([1,"true"].includes(t))return!0;if([0,"false"].includes(t))return!1;throw new Error("".concat(t," is not a valid boolean value for boolean field ").concat(e.name))}return"number"!=typeof t&&"number"===e.type?Number(t):t},E=function(e){var t=Object(g.has)(e,"query.match_phrase"),r=Object(g.get)(e,"query.match",[]),a=void 0!==Object.values(r).find((function(e){return"phrase"===e.type}));return t||a},_=function(e,t){var r=S(e,t);return{script:{source:F(e),lang:e.lang,params:{value:r}}}},F=function(e){return"painless"===e.lang?"boolean compare(Supplier s, def v) {return s.get() == v;}"+"compare(() -> { ".concat(e.script," }, params.value);"):"(".concat(e.script,") == value")};!function(e){e.CUSTOM="custom",e.PHRASES="phrases",e.PHRASE="phrase",e.EXISTS="exists",e.MATCH_ALL="match_all",e.QUERY_STRING="query_string",e.RANGE="range",e.RANGE_FROM_VALUE="range_from_value",e.SPATIAL_FILTER="spatial_filter"}(p||(p={})),function(e){e.APP_STATE="appState",e.GLOBAL_STATE="globalState"}(m||(m={}));var w={gt:">",gte:">=",lte:"<=",lt:"<"},N={gt:"boolean gt(Supplier s, def v) {return s.get() > v}",gte:"boolean gte(Supplier s, def v) {return s.get() >= v}",lte:"boolean lte(Supplier s, def v) {return s.get() <= v}",lt:"boolean lt(Supplier s, def v) {return s.get() < v}"},T={gt:"boolean gt(Supplier s, def v) {return s.get().toInstant().isAfter(Instant.parse(v))}",gte:"boolean gte(Supplier s, def v) {return !s.get().toInstant().isBefore(Instant.parse(v))}",lte:"boolean lte(Supplier s, def v) {return !s.get().toInstant().isAfter(Instant.parse(v))}",lt:"boolean lt(Supplier s, def v) {return s.get().toInstant().isBefore(Instant.parse(v))}"},M=function(e,t){var r=Object(g.mapValues)(Object(g.pickBy)(t,(function(e,t){return t in w})),(function(t){return"number"===e.type&&"string"==typeof t?parseFloat(t):t})),a=Object(g.map)(r,(function(t,r){return"("+e.script+")"+Object(g.get)(w,r)+r})).join(" && ");if("painless"===e.lang){var n="date"===e.type?T:N,i=Object(g.reduce)(r,(function(e,t,r){return e.concat(Object(g.get)(n,r))}),[]).join(" "),s=Object(g.map)(r,(function(t,r){return"".concat(r,"(() -> { ").concat(e.script," }, params.").concat(r,")")})).join(" && ");a="".concat(i).concat(s)}return{script:{source:a,params:r,lang:e.lang}}};var A=function(e){return function(e){return Object(g.has)(e,"query.exists")}(e)?function(e){return e.query.exists&&e.query.exists.field}(e):E(e)?function(e){var t,r,a=null!==(t=null!==(r=e.query.match_phrase)&&void 0!==r?r:e.query.match)&&void 0!==t?t:{};return Object.keys(a)[0]}(e):function(e){var t;return(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)===p.PHRASES}(e)?function(e){return e.meta.key}(e):function(e){return Object(g.has)(e,"query.range")}(e)?function(e){return e.query.range&&Object.keys(e.query.range)[0]}(e):void 0};var I=function(e){return Object(g.get)(e,"meta.disabled",!1)},z=function(e){return Object(g.omit)(e,["meta","$state"])};function C(e,t){if(function(e){var t,r,a=Object.keys(null!==(t=e.match||(null===(r=e.query)||void 0===r?void 0:r.match))&&void 0!==t?t:{})[0];return Boolean(a&&("phrase"===Object(g.get)(e,["query","match",a,"type"])||"phrase"===Object(g.get)(e,["match",a,"type"])))}(e)){var r=e.match||e.query.match,a=Object.keys(r)[0],n=Object(g.get)(r,[a]),i=n.query;if(t){var s=t.fields.find((function(e){return e.name===a}));s&&(i=S(s,n.query))}return{meta:e.meta,$state:e.$state,query:{match_phrase:v()({},a,Object(g.omit)(x()(x()({},n),{},{query:i}),"type"))}}}return e.query||(e.query={}),e.exists&&(e.query.exists=e.exists,delete e.exists),e.range&&(e.query.range=e.range,delete e.range),e.match_all&&(e.query.match_all=e.match_all,delete e.match_all),Object.keys(e).forEach((function(t){"meta"!==t&&"query"!==t&&"$state"!==t&&(e.query[t]=e[t],delete e[t])})),e}var P=r(70),k=r.n(P),R=r(61),V=r.n(R);function q(e){return{type:"literal",value:e}}function L(e){return e.value}var B="@kuery-wildcard@";function D(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q(e){return e.replace(/[+-=&|><!(){}[\]^"~*?:\\/]/g,"\\$&")}function G(e){return e.includes(B)?{type:"wildcard",value:e}:Ve(e)}function U(e,t){var r=e.value.split(B).map(D).join("[\\s\\S]*");return new RegExp("^".concat(r,"$")).test(t)}function $(e){return e.value.split(B).join("*")}function H(e){return e.value.split(B).map(Q).join("*")}function W(e){var t=e.value;return t.startsWith(B)&&t.replace(B,"").length>0}function K(e,t){if(!t)return[];if("literal"===e.type){var r=L(e),a=t.fields.find((function(e){return e.name===r}));return a?[a]:[]}return"wildcard"===e.type?t.fields.filter((function(t){return U(e,t.name)})):void 0}var J=r(43),Y=r.n(J);function Z(e){var t=Y.a.tz.guess();return"Browser"===e?t:e}function X(e){return function(e){var t,r=null==e?void 0:e.subType;return!(null==r||null===(t=r.nested)||void 0===t||!t.path)}(e)?e.subType:void 0}function ee(e,t,r){var a=x()(x()({},e),{},{value:r?"".concat(r,".").concat(e.value):e.value});if(!t||"wildcard"===a.type&&!r)return a;var n=K(a,t).reduce((function(e,t){var a=X(t),n=null==a?void 0:a.nested.path;return r&&!n?[].concat(k()(e),["".concat(t.name,' is not a nested field but is in nested group "').concat(r,'" in the KQL expression.')]):n&&!r?[].concat(k()(e),["".concat(t.name," is a nested field, but is not in a nested group in the KQL expression.")]):n!==r?[].concat(k()(e),["Nested field ".concat(t.name," is being queried with the incorrect nested path. The correct path is ").concat(null==a?void 0:a.nested.path,".")]):e}),[]);if(n.length>0)throw new Error(n.join("\n"));return a}function te(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Object(g.isUndefined)(e))throw new Error("fieldName is a required argument");if(Object(g.isUndefined)(t))throw new Error("value is a required argument");var a="string"==typeof e?Ve(e):q(e),n="string"==typeof t?Ve(t):q(t),i=q(r);return{arguments:[a,n,i]}}function re(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=V()(e.arguments,3),i=n[0],s=n[1],o=n[2],l="wildcard"===s.type&&s.value===B,u="wildcard"===i.type&&i.value===B,c=l&&u;if(c)return{match_all:{}};var d=ee(i,t,null!=a&&a.nested?a.nested.path:void 0),f=Object(g.isUndefined)(s)?s:Le(s),p=o.value?"phrase":"best_fields";if(null===d.value)return"wildcard"===s.type?{query_string:{query:H(s)}}:{multi_match:{type:p,query:f,lenient:!0}};var m=t?K(d,t):[];if(m&&0===m.length&&m.push({name:Le(d),scripted:!1,type:""}),l&&(null==m||!m.length||(null==m?void 0:m.length)===(null==t?void 0:t.fields.length)))return{match_all:{}};var b=m.reduce((function(e,t){var n=function(e){var r=X(t);return"wildcard"!==d.type||null==r||!r.nested||null!=a&&a.nested?e:{nested:{path:r.nested.path,query:e,score_mode:"none"}}};if(!t.scripted){if(l)return[].concat(k()(e),[n({exists:{field:t.name}})]);if("wildcard"===s.type)return[].concat(k()(e),[n({query_string:{fields:[t.name],query:H(s)}})]);if("date"===t.type){var i=r.dateFormatTZ?{time_zone:Z(r.dateFormatTZ)}:{};return[].concat(k()(e),[n({range:v()({},t.name,x()({gte:f,lte:f},i))})])}var o="phrase"===p?"match_phrase":"match";return[].concat(k()(e),[n(v()({},o,v()({},t.name,f)))])}if(!l)return[].concat(k()(e),[{script:x()({},_(t,f))}])}),[]);return{bool:{should:b||[],minimum_should_match:1}}}function ae(e){return{arguments:e}}function ne(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=r.filtersInMustClause,i=e.arguments||[],s=n?"must":"filter";return{bool:v()({},s,i.map((function(e){return Le(e,t,r,a)})))}}function ie(e){return{arguments:e}}function se(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=e.arguments||[];return{bool:{should:n.map((function(e){return Le(e,t,r,a)})),minimum_should_match:1}}}function oe(e){return{arguments:[e]}}function le(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=V()(e.arguments,1),i=n[0];return{bool:{must_not:Le(i,t,r,a)}}}function ue(e,t,r){return{arguments:[Ve(e),t,ye.literal.buildNode(r)]}}function ce(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=V()(e.arguments,3),i=n[0],s=n[1],o=n[2],l=ee(i,t,null!=a&&a.nested?a.nested.path:void 0),u=t?K(l,t):[];u&&0===u.length&&u.push({name:Le(l),scripted:!1,type:""});var c=u.map((function(e){var t=function(t){var r=X(e);return"wildcard"!==l.type||null==r||!r.nested||a.nested?t:{nested:{path:r.nested.path,query:t,score_mode:"none"}}},n=v()({},s,Le(o));if(e.scripted)return{script:M(e,n)};if("date"===e.type){var i=r.dateFormatTZ?{time_zone:Z(r.dateFormatTZ)}:{};return t({range:v()({},e.name,x()(x()({},n),i))})}return t({range:v()({},e.name,n)})}));return{bool:{should:c,minimum_should_match:1}}}function de(e){return{arguments:[q(e)]}}function fe(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=V()(e.arguments,1),i=n[0],s=x()(x()({},i),{},{value:null!=a&&a.nested?"".concat(a.nested.path,".").concat(i.value):i.value}),o=L(s),l=null==t||null===(r=t.fields)||void 0===r?void 0:r.find((function(e){return e.name===o}));if(null!=l&&l.scripted)throw new Error("Exists query does not support scripted fields");return{exists:{field:o}}}function pe(e,t){return{arguments:["string"==typeof e?Ve(e):q(e),t]}}function me(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=V()(e.arguments,2),s=i[0],o=i[1],l=Le(s),u=null!=n&&null!==(r=n.nested)&&void 0!==r&&r.path?"".concat(n.nested.path,".").concat(l):l;return{nested:{path:u,query:Le(o,t,a,x()(x()({},n),{},{nested:{path:u}})),score_mode:"none"}}}var ge={is:i,and:s,or:o,not:l,range:u,exists:c,nested:d};function be(e){var t=ge[e];if(b.a.isUndefined(t))throw new Error('Unknown function "'.concat(e,'"'));for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return x()({type:"function",function:e},t.buildNodeParams.apply(t,a))}function he(e,t){if(b.a.isUndefined(ge[e]))throw new Error('Unknown function "'.concat(e,'"'));return{type:"function",function:e,arguments:t}}function ve(e,t,r,a){return ge[e.function].toElasticsearchQuery(e,t,r,a)}var ye={function:f,literal:a,wildcard:n},xe=r(143),je=r.n(xe),Oe=r(144),Se=r.n(Oe),Ee=r(145),_e=r.n(Ee),Fe=r(146),we=r.n(Fe),Ne=r(147),Te=r.n(Ne),Me=r(148),Ae=r.n(Me),Ie=r(1),ze=Ie.i18n.translate("esQuery.kql.errors.endOfInputText",{defaultMessage:"end of input"}),Ce={fieldName:Ie.i18n.translate("esQuery.kql.errors.fieldNameText",{defaultMessage:"field name"}),value:Ie.i18n.translate("esQuery.kql.errors.valueText",{defaultMessage:"value"}),literal:Ie.i18n.translate("esQuery.kql.errors.literalText",{defaultMessage:"literal"}),whitespace:Ie.i18n.translate("esQuery.kql.errors.whitespaceText",{defaultMessage:"whitespace"})},Pe=function(e){we()(r,e);var t=Te()(r);function r(e,a){var n;Se()(this,r);var i=e.message;if(e.expected){var s=e.expected.map((function(e){var t,r="other"===(t=e).type?t.description:"literal"===t.type?'"'.concat(t.text,'"'):"end"===t.type?"end of input":t.text||t.description||"";return Ce[r]||r})),o=Object(g.uniq)(s).filter((function(e){return void 0!==e})).sort().join(", ");i=Ie.i18n.translate("esQuery.kql.errors.syntaxError",{defaultMessage:"Expected {expectedList} but {foundInput} found.",values:{expectedList:o,foundInput:e.found?'"'.concat(e.found,'"'):ze}})}var l=[i,a,Object(g.repeat)("-",e.location.start.offset)+"^"].join("\n");return n=t.call(this,l),v()(_e()(n),"shortMessage",void 0),n.name="KQLSyntaxError",n.shortMessage=i,n}return je()(r)}(Ae()(Error)),ke=r(87),Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ke.parse;if(void 0===e)throw new Error("expression must be a string, got undefined instead");return r(e,x()(x()({},t),{},{helpers:{nodeTypes:ye}}))},Ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Re(e,x()(x()({},t),{},{startRule:"Literal"}),ke.parse)},qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return Re(e,t,ke.parse)}catch(t){throw"SyntaxError"===t.name?new Pe(t,e):t}},Le=function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!t||!t.type||!ye[t.type])return e(ye.function.buildNode("and",[]),r);var i=ye[t.type];return i.toElasticsearchQuery(t,r,a,n)},Be=function(){return Le.apply(void 0,arguments)};function De(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=t.map((function(e){return qe(e.query,{allowLeadingWildcards:r})}));return Qe(e,i,{dateFormatTZ:a,filtersInMustClause:n})}function Qe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=ye.function.buildNode("and",t),n=Be(a,e,r);return Object.assign({must:[],filter:[],should:[],must_not:[]},n.bool)}function Ge(e,t){var r,a;return null===(r=e.meta)||void 0===r||!r.key||!t||("custom"===(null===(a=e.meta)||void 0===a?void 0:a.type)?e.meta.index===t.id:t.fields.some((function(t){return t.name===e.meta.key})))}var Ue=function(e,t){if(!t)return e;var r=A(e);if(!r)return e;var a=t.fields.find((function(e){return e.name===r})),n=a&&X(a);if(!n)return e;var i=z(e);return{meta:e.meta,query:{nested:{path:n.nested.path,query:i.query||i}}}},$e=function(e){return function(t){return Object(g.isUndefined)(t.meta)||Object(g.isUndefined)(t.meta.negate)?!e:t.meta&&t.meta.negate===e}},He=function(e){return e.query||e},We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=e.filter((function(e){return e&&!I(e)}));var a=function(a){return e.filter((function(e){return!!e})).filter($e(a)).filter((function(e){return!r||Ge(e,t)})).map((function(e){return C(e,t)})).map((function(e){return Ue(e,t)})).map(z).map(He)};return{must:[],filter:a(!1),should:[],must_not:a(!0)}};function Ke(e,t,r){return function(e){return Object(g.has)(e,"query_string.query")}(e)&&("string"==typeof t&&(t=JSON.parse(t)),Object(g.extend)(e.query_string,t),r&&Object(g.defaults)(e.query_string,{time_zone:Z(r)})),e}function Je(e,t,r){return{must:(e||[]).map((function(e){return Ke(function(e){return Object(g.isString)(e)?""===e.trim()?{match_all:{}}:{query_string:{query:e}}:e}(e.query),t,r)})),filter:[],should:[],must_not:[]}}function Ye(e){return e.filter((function(e){return!e||"object"!==O()(e)||!Object(g.isEqual)(e,{match_all:{}})}))}var Ze=r(52);var Xe=r(8),et=r(85);const tt={bool:{must:[{match_all:{}}]}};function rt(){return Object(g.cloneDeep)(tt)}function at(e){var t;const r=(a=e,Object(Ze.a)(a,["id","type","attributes"])?null==e||null===(t=e.attributes)||void 0===t?void 0:t.kibanaSavedObjectMeta:null==e?void 0:e.kibanaSavedObjectMeta);var a;const n="string"==typeof(null==r?void 0:r.searchSourceJSON)?JSON.parse(r.searchSourceJSON):void 0;return n&&Array.isArray(n.filter)&&n.filter.forEach((e=>{e.meta.indexRefName=void 0})),n}function nt(e,t,r,a){let n=rt();if(e&&e.language===et.a.KUERY){const a=qe(e.query);if(""!==e.query&&(n=Be(a,r)),void 0!==n.bool){const e=We(t,r);Array.isArray(n.bool.filter)||(n.bool.filter=void 0===n.bool.filter?[]:[n.bool.filter]),Array.isArray(n.bool.must_not)||(n.bool.must_not=void 0===n.bool.must_not?[]:[n.bool.must_not]),n.bool.filter=[...n.bool.filter,...e.filter],n.bool.must_not=[...n.bool.must_not,...e.must_not]}}else n=function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{allowLeadingWildcards:!1,queryStringOptions:{},ignoreFilterIfFieldNotInIndex:!1};t=Array.isArray(t)?t:[t],r=Array.isArray(r)?r:[r];var n=t.filter((function(e){return Object(g.has)(e,"query")})),i=Object(g.groupBy)(n,"language"),s=De(e,i.kuery,a.allowLeadingWildcards,a.dateFormatTZ,a.filtersInMustClause),o=Je(i.lucene,a.queryStringOptions,a.dateFormatTZ),l=We(r,e,a.ignoreFilterIfFieldNotInIndex);return{bool:{must:Ye([].concat(k()(s.must),k()(o.must),k()(l.must))),filter:Ye([].concat(k()(s.filter),k()(o.filter),k()(l.filter))),should:Ye([].concat(k()(s.should),k()(o.should),k()(l.should))),must_not:[].concat(k()(s.must_not),k()(o.must_not),k()(l.must_not))}}}(r,e?[e]:[],t||[],a?Object(Xe.getEsQueryConfig)(a):void 0);return n}function it({indexPattern:e,uiSettings:t,savedSearch:r,query:a,filters:n,filterManager:i}){if(!e||!r)return;const s=a,o=n;if(r&&"searchSource"in r&&(null==r?void 0:r.searchSource)instanceof Xe.SearchSource&&void 0!==r.searchSource.getParent()&&s){var l,u,c;const e=null!==(l=Object(g.cloneDeep)(null===(u=r.searchSource.getSearchRequestBody())||void 0===u?void 0:u.query))&&void 0!==l?l:rt(),t=null===(c=r.searchSource.getField("index"))||void 0===c?void 0:c.timeFieldName;return Array.isArray(e.bool.filter)&&void 0!==t&&(e.bool.filter=e.bool.filter.filter((e=>{var r;return!(e.hasOwnProperty("range")&&null!==(r=e.range)&&void 0!==r&&r.hasOwnProperty(t))}))),{searchQuery:e,searchString:s.query,queryLanguage:s.language}}const d=at(r);if(!d&&s){i&&o&&i.setFilters(o);return{searchQuery:nt(s,Array.isArray(o)?o:[],e,t),searchString:s.query,queryLanguage:s.language}}if(d){const r=null!=s?s:null==d?void 0:d.query,a=null!=o?o:null==d?void 0:d.filter;i&&i.setFilters(a);return{searchQuery:nt(r,Array.isArray(a)?a:[],e,t),searchString:r.query,queryLanguage:r.language}}}},84:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a="DATA_VISUALIZER_INDEX_VIEWER"},85:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a={KUERY:"kuery",LUCENE:"lucene"}},86:function(e,t,r){e.exports=r(14)(43)},87:function(e,t,r){"use strict";function a(e,t,r,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,a.prototype),i.expected=t,i.found=r,i.location=n,i.name="SyntaxError",i}function n(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(a,Error),a.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,a=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){a=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source+":"+i.line+":"+i.column;if(a){var o=this.location.end,l=n("",i.line.toString().length),u=a[i.line-1],c=i.line===o.line?o.column:u.length+1;t+="\n --\x3e "+s+"\n"+l+" |\n"+i.line+" | "+u+"\n"+l+" | "+n("",i.column-1)+n("",c-i.column,"^")}else t+="\n at "+s}return t},a.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function a(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function s(e){return r[e.type](e)}return"Expected "+function(e){var t,r,a=e.map(s);if(a.sort(),a.length>0){for(t=1,r=1;t<a.length;t++)a[t-1]!==a[t]&&(a[r]=a[t],r++);a.length=r}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:a,parse:function(e,t){var r,n={},i=(t=void 0!==t?t:{}).grammarSource,s={start:ye,Literal:Ie},o=ye,l=":",u="or",c="and",d="not",f='"',p="\\",m="<=",g=">=",b="@kuery-cursor@",h=/^[\\"]/,v=/^[^"]/,y=/^[\\():<>"*{}]/,x=/^[0-9a-f]/i,j=/^[ \t\r\n\xA0]/,O=fe("(",!1),S=fe(")",!1),E=fe(":",!1),_=fe("{",!1),F=fe("}",!1),w=me("fieldName"),N=me("value"),T=me("OR"),M=fe("or",!0),A=me("AND"),I=fe("and",!0),z=me("NOT"),C=fe("not",!0),P=me("literal"),k=fe('"',!1),R=fe("\\",!1),V=pe(["\\",'"'],!1,!1),q=pe(['"'],!0,!1),L={type:"any"},B=fe("*",!1),D=fe("\\t",!1),Q=fe("\\r",!1),G=fe("\\n",!1),U=pe(["\\","(",")",":","<",">",'"',"*","{","}"],!1,!1),$=fe("u",!1),H=pe([["0","9"],["a","f"]],!1,!0),W=fe("<=",!1),K=fe(">=",!1),J=fe("<",!1),Y=fe(">",!1),Z=me("whitespace"),X=pe([" ","\t","\r","\n","Â "],!1,!1),ee=fe("@kuery-cursor@",!1),te=function(e,t){return t},re=function(e,t){return t},ae=function(e){if("cursor"===e.type)return e;!$e&&"wildcard"===e.type&&He.wildcard.hasLeadingWildcard(e)&&function(e,t){throw t=void 0!==t?t:be(oe,se),function(e,t){return new a(e,null,null,t)}(e,t)}("Leading wildcards are disabled. See query:allowLeadingWildcards in Advanced Settings.");const t=Ke(!1);return r=>We("is",[r,e,t])},ne=function(){return Ge},ie=function(t,r,a){const{start:n,end:i}=be(oe,se);return{type:"cursor",start:n.offset,end:i.offset-r.length,prefix:t.join(""),suffix:a.join(""),text:e.substring(oe,se).replace(r,"")}},se=0,oe=0,le=[{line:1,column:1}],ue=0,ce=[],de=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function fe(e,t){return{type:"literal",text:e,ignoreCase:t}}function pe(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function me(e){return{type:"other",description:e}}function ge(t){var r,a=le[t];if(a)return a;for(r=t-1;!le[r];)r--;for(a={line:(a=le[r]).line,column:a.column};r<t;)10===e.charCodeAt(r)?(a.line++,a.column=1):a.column++,r++;return le[t]=a,a}function be(e,t){var r=ge(e),a=ge(t);return{source:i,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:a.line,column:a.column}}}function he(e){se<ue||(se>ue&&(ue=se,ce=[]),ce.push(e))}function ve(e,t,r){return new a(a.buildMessage(e,t),e,t,r)}function ye(){var e,t,r,a,i,s;for(e=se,t=[],r=De();r!==n;)t.push(r),r=De();return(r=xe())===n&&(r=null),(a=Re())!==n?(oe=e,i=r,e="cursor"===(s=a).type?{...s,suggestionTypes:["conjunction"]}:null!==i?i:He.function.buildNode("is","*","*")):(se=e,e=n),e}function xe(){var e,t,r,a,i;if(e=se,(t=je())!==n){if(r=[],a=se,Te()!==n&&(i=je())!==n?(oe=a,a=te(0,i)):(se=a,a=n),a!==n)for(;a!==n;)r.push(a),a=se,Te()!==n&&(i=je())!==n?(oe=a,a=te(0,i)):(se=a,a=n);else r=n;r!==n?(oe=e,e=function(e,t){const r=[e,...t];return Ge&&r.find((e=>"cursor"===e.type))||We("or",r)}(t,r)):(se=e,e=n)}else se=e,e=n;return e===n&&(e=je()),e}function je(){var e,t,r,a,i;if(e=se,(t=Oe())!==n){if(r=[],a=se,Me()!==n&&(i=Oe())!==n?(oe=a,a=te(0,i)):(se=a,a=n),a!==n)for(;a!==n;)r.push(a),a=se,Me()!==n&&(i=Oe())!==n?(oe=a,a=te(0,i)):(se=a,a=n);else r=n;r!==n?(oe=e,e=function(e,t){const r=[e,...t];return Ge&&r.find((e=>"cursor"===e.type))||We("and",r)}(t,r)):(se=e,e=n)}else se=e,e=n;return e===n&&(e=Oe()),e}function Oe(){var e,t,r;return e=se,Ae()!==n&&(t=Se())!==n?(oe=e,e="cursor"===(r=t).type?r:We("not",[r])):(se=e,e=n),e===n&&(e=Se()),e}function Se(){var t,r,a,i,s,o,u,c;if(t=se,40===e.charCodeAt(se)?(r="(",se++):(r=n,0===de&&he(O)),r!==n){for(a=[],i=De();i!==n;)a.push(i),i=De();(i=xe())!==n&&(s=Re())!==n?(41===e.charCodeAt(se)?(o=")",se++):(o=n,0===de&&he(S)),o!==n?(oe=t,u=i,t="cursor"===(c=s).type?{...c,suggestionTypes:["conjunction"]}:u):(se=t,t=n)):(se=t,t=n)}else se=t,t=n;return t===n&&(t=function(){var t,r,a,i,s,o,u,c,d,f;if(t=se,(r=Ee())!==n){for(a=[],i=De();i!==n;)a.push(i),i=De();if(58===e.charCodeAt(se)?(i=":",se++):(i=n,0===de&&he(E)),i!==n){for(s=[],o=De();o!==n;)s.push(o),o=De();if(123===e.charCodeAt(se)?(o="{",se++):(o=n,0===de&&he(_)),o!==n){for(u=[],c=De();c!==n;)u.push(c),c=De();(c=xe())!==n&&(d=Re())!==n?(125===e.charCodeAt(se)?(f="}",se++):(f=n,0===de&&he(F)),f!==n?(oe=t,t=function(e,t,r){return"cursor"===t.type?{...t,nestedPath:t.nestedPath?`${e.value}.${t.nestedPath}`:e.value}:"cursor"===r.type?{...r,suggestionTypes:["conjunction"]}:We("nested",[e,t])}(r,c,d)):(se=t,t=n)):(se=t,t=n)}else se=t,t=n}else se=t,t=n}else se=t,t=n;t===n&&(t=function(){var t;(t=function(){var t,r,a,i,s,o;if(t=se,(r=Ee())!==n){for(a=[],i=De();i!==n;)a.push(i),i=De();if((i=function(){var t,r;t=se,e.substr(se,2)===m?(r=m,se+=2):(r=n,0===de&&he(W));r!==n&&(oe=t,r="lte");(t=r)===n&&(t=se,e.substr(se,2)===g?(r=g,se+=2):(r=n,0===de&&he(K)),r!==n&&(oe=t,r="gte"),(t=r)===n&&(t=se,60===e.charCodeAt(se)?(r="<",se++):(r=n,0===de&&he(J)),r!==n&&(oe=t,r="lt"),(t=r)===n&&(t=se,62===e.charCodeAt(se)?(r=">",se++):(r=n,0===de&&he(Y)),r!==n&&(oe=t,r="gt"),t=r)));return t}())!==n){for(s=[],o=De();o!==n;)s.push(o),o=De();(o=Ie())!==n?(oe=t,l=r,u=i,t="cursor"===(c=o).type?{...c,suggestionTypes:["conjunction"]}:We("range",[l,u,c])):(se=t,t=n)}else se=t,t=n}else se=t,t=n;var l,u,c;return t}())===n&&(t=function(){var t,r,a,i,s,o;if(t=se,(r=Ee())!==n){for(a=[],i=De();i!==n;)a.push(i),i=De();if(58===e.charCodeAt(se)?(i=l,se++):(i=n,0===de&&he(E)),i!==n){for(s=[],o=De();o!==n;)s.push(o),o=De();(o=_e())!==n?(oe=t,u=r,t="cursor"===(c=o).type?{...c,fieldName:u.value,suggestionTypes:["value","conjunction"]}:c(u)):(se=t,t=n)}else se=t,t=n}else se=t,t=n;var u,c;return t}())===n&&(t=function(){var e,t;e=se,(t=Ne())!==n&&(oe=e,t=function(e){if("cursor"===e.type){const t=`${e.prefix}${e.suffix}`.trim();return{...e,fieldName:t,suggestionTypes:["field","operator","conjunction"]}}return e(Ke(null))}(t));return e=t}());return t}());return t}()),t}function Ee(){var e;return de++,e=Ie(),de--,e===n&&(n,0===de&&he(w)),e}function _e(){var t,r,a,i,s,o,l,u;if(t=se,40===e.charCodeAt(se)?(r="(",se++):(r=n,0===de&&he(O)),r!==n){for(a=[],i=De();i!==n;)a.push(i),i=De();(i=function(){var e,t,r,a,i;if(e=se,(t=Fe())!==n){if(r=[],a=se,Te()!==n&&(i=Fe())!==n?(oe=a,a=re(0,i)):(se=a,a=n),a!==n)for(;a!==n;)r.push(a),a=se,Te()!==n&&(i=Fe())!==n?(oe=a,a=re(0,i)):(se=a,a=n);else r=n;r!==n?(oe=e,e=function(e,t){const r=[e,...t],a=Ge&&r.find((e=>"cursor"===e.type));return a?{...a,suggestionTypes:["value"]}:e=>We("or",r.map((t=>t(e))))}(t,r)):(se=e,e=n)}else se=e,e=n;e===n&&(e=Fe());return e}())!==n&&(s=Re())!==n?(41===e.charCodeAt(se)?(o=")",se++):(o=n,0===de&&he(S)),o!==n?(oe=t,l=i,t="cursor"===(u=s).type?{...u,suggestionTypes:["conjunction"]}:l):(se=t,t=n)):(se=t,t=n)}else se=t,t=n;return t===n&&(t=Ne()),t}function Fe(){var e,t,r,a,i;if(e=se,(t=we())!==n){if(r=[],a=se,Me()!==n&&(i=we())!==n?(oe=a,a=re(0,i)):(se=a,a=n),a!==n)for(;a!==n;)r.push(a),a=se,Me()!==n&&(i=we())!==n?(oe=a,a=re(0,i)):(se=a,a=n);else r=n;r!==n?(oe=e,e=function(e,t){const r=[e,...t],a=Ge&&r.find((e=>"cursor"===e.type));return a?{...a,suggestionTypes:["value"]}:e=>We("and",r.map((t=>t(e))))}(t,r)):(se=e,e=n)}else se=e,e=n;return e===n&&(e=we()),e}function we(){var e,t,r;return e=se,Ae()!==n&&(t=_e())!==n?(oe=e,e="cursor"===(r=t).type?{...list,suggestionTypes:["value"]}:e=>We("not",[r(e)])):(se=e,e=n),e===n&&(e=_e()),e}function Ne(){var e,t;return de++,e=se,(t=ze())!==n&&(oe=e,t=function(e){if("cursor"===e.type)return e;const t=Ke(!0);return r=>We("is",[r,e,t])}(t)),(e=t)===n&&(e=se,(t=Pe())!==n&&(oe=e,t=ae(t)),e=t),de--,e===n&&(t=n,0===de&&he(N)),e}function Te(){var t,r,a,i,s;if(de++,t=se,r=[],(a=De())!==n)for(;a!==n;)r.push(a),a=De();else r=n;if(r!==n)if("or"===e.substr(se,2).toLowerCase()?(a=e.substr(se,2),se+=2):(a=n,0===de&&he(M)),a!==n){if(i=[],(s=De())!==n)for(;s!==n;)i.push(s),s=De();else i=n;i!==n?t=r=[r,a,i]:(se=t,t=n)}else se=t,t=n;else se=t,t=n;return de--,t===n&&(r=n,0===de&&he(T)),t}function Me(){var t,r,a,i,s;if(de++,t=se,r=[],(a=De())!==n)for(;a!==n;)r.push(a),a=De();else r=n;if(r!==n)if("and"===e.substr(se,3).toLowerCase()?(a=e.substr(se,3),se+=3):(a=n,0===de&&he(I)),a!==n){if(i=[],(s=De())!==n)for(;s!==n;)i.push(s),s=De();else i=n;i!==n?t=r=[r,a,i]:(se=t,t=n)}else se=t,t=n;else se=t,t=n;return de--,t===n&&(r=n,0===de&&he(A)),t}function Ae(){var t,r,a,i;if(de++,t=se,"not"===e.substr(se,3).toLowerCase()?(r=e.substr(se,3),se+=3):(r=n,0===de&&he(C)),r!==n){if(a=[],(i=De())!==n)for(;i!==n;)a.push(i),i=De();else a=n;a!==n?t=r=[r,a]:(se=t,t=n)}else se=t,t=n;return de--,t===n&&(r=n,0===de&&he(z)),t}function Ie(){var e;return de++,(e=ze())===n&&(e=Pe()),de--,e===n&&(n,0===de&&he(P)),e}function ze(){var t,r,a,i,s,o,l;if(t=se,oe=se,(r=(r=ne())?void 0:n)!==n)if(34===e.charCodeAt(se)?(a=f,se++):(a=n,0===de&&he(k)),a!==n){for(i=[],s=Ce();s!==n;)i.push(s),s=Ce();if((s=Qe())!==n){for(o=[],l=Ce();l!==n;)o.push(l),l=Ce();34===e.charCodeAt(se)?(l=f,se++):(l=n,0===de&&he(k)),l!==n?(oe=t,t=ie(i,s,o)):(se=t,t=n)}else se=t,t=n}else se=t,t=n;else se=t,t=n;if(t===n)if(t=se,34===e.charCodeAt(se)?(r=f,se++):(r=n,0===de&&he(k)),r!==n){for(a=[],i=Ce();i!==n;)a.push(i),i=Ce();34===e.charCodeAt(se)?(i=f,se++):(i=n,0===de&&he(k)),i!==n?(oe=t,t=Ke(a.join(""))):(se=t,t=n)}else se=t,t=n;return t}function Ce(){var t,r,a;return(t=Ve())===n&&(t=Le())===n&&(t=se,92===e.charCodeAt(se)?(r=p,se++):(r=n,0===de&&he(R)),r!==n?(h.test(e.charAt(se))?(a=e.charAt(se),se++):(a=n,0===de&&he(V)),a!==n?(oe=t,t=a):(se=t,t=n)):(se=t,t=n),t===n&&(t=se,r=se,de++,a=Qe(),de--,a===n?r=void 0:(se=r,r=n),r!==n?(v.test(e.charAt(se))?(a=e.charAt(se),se++):(a=n,0===de&&he(q)),a!==n?(oe=t,t=a):(se=t,t=n)):(se=t,t=n))),t}function Pe(){var e,t,r,a,i,s;if(e=se,oe=se,(t=(t=ne())?void 0:n)!==n){for(r=[],a=ke();a!==n;)r.push(a),a=ke();if((a=Qe())!==n){for(i=[],s=ke();s!==n;)i.push(s),s=ke();oe=e,e=ie(r,a,i)}else se=e,e=n}else se=e,e=n;if(e===n){if(e=se,t=[],(r=ke())!==n)for(;r!==n;)t.push(r),r=ke();else t=n;t!==n&&(oe=e,t=function(e){const t=e.join("").trim();return"null"===t?Ke(null):"true"===t?Ke(!0):"false"===t?Ke(!1):e.includes(Ye)?Je(t):Ke(t)}(t)),e=t}return e}function ke(){var t,r,a,i,s;return(t=Ve())===n&&(t=function(){var t,r,a;t=se,92===e.charCodeAt(se)?(r=p,se++):(r=n,0===de&&he(R));r!==n&&(a=qe())!==n?(oe=t,t=a):(se=t,t=n);return t}())===n&&(t=Le())===n&&(t=function(){var t,r,a;t=se,92===e.charCodeAt(se)?(r=p,se++):(r=n,0===de&&he(R));r!==n?(e.substr(se,2).toLowerCase()===u?(a=e.substr(se,2),se+=2):(a=n,0===de&&he(M)),a===n&&(e.substr(se,3).toLowerCase()===c?(a=e.substr(se,3),se+=3):(a=n,0===de&&he(I)),a===n&&(e.substr(se,3).toLowerCase()===d?(a=e.substr(se,3),se+=3):(a=n,0===de&&he(C)))),a!==n?(oe=t,t=a):(se=t,t=n)):(se=t,t=n);return t}())===n&&(t=function(){var t,r;t=se,42===e.charCodeAt(se)?(r="*",se++):(r=n,0===de&&he(B));r!==n&&(oe=t,r=Ye);return t=r}())===n&&(t=se,r=se,de++,a=qe(),de--,a===n?r=void 0:(se=r,r=n),r!==n?(a=se,de++,i=function(){var e;(e=Te())===n&&(e=Me())===n&&(e=Ae());return e}(),de--,i===n?a=void 0:(se=a,a=n),a!==n?(i=se,de++,s=Qe(),de--,s===n?i=void 0:(se=i,i=n),i!==n?(e.length>se?(s=e.charAt(se),se++):(s=n,0===de&&he(L)),s!==n?(oe=t,t=s):(se=t,t=n)):(se=t,t=n)):(se=t,t=n)):(se=t,t=n)),t}function Re(){var e,t,r,a,i,s;if(e=se,oe=se,(t=(t=ne())?void 0:n)!==n){for(r=[],a=De();a!==n;)r.push(a),a=De();if((a=Qe())!==n){for(i=[],s=De();s!==n;)i.push(s),s=De();oe=e,e=ie(r,a,i)}else se=e,e=n}else se=e,e=n;if(e===n)for(e=[],t=De();t!==n;)e.push(t),t=De();return e}function Ve(){var t,r;return t=se,"\\t"===e.substr(se,2)?(r="\\t",se+=2):(r=n,0===de&&he(D)),r!==n&&(oe=t,r="\t"),(t=r)===n&&(t=se,"\\r"===e.substr(se,2)?(r="\\r",se+=2):(r=n,0===de&&he(Q)),r!==n&&(oe=t,r="\r"),(t=r)===n&&(t=se,"\\n"===e.substr(se,2)?(r="\\n",se+=2):(r=n,0===de&&he(G)),r!==n&&(oe=t,r="\n"),t=r)),t}function qe(){var t;return y.test(e.charAt(se))?(t=e.charAt(se),se++):(t=n,0===de&&he(U)),t}function Le(){var t,r,a;return t=se,92===e.charCodeAt(se)?(r=p,se++):(r=n,0===de&&he(R)),r!==n&&(a=function(){var t,r,a,i,s,o,l,u;t=se,117===e.charCodeAt(se)?(r="u",se++):(r=n,0===de&&he($));r!==n?(a=se,i=se,(s=Be())!==n&&(o=Be())!==n&&(l=Be())!==n&&(u=Be())!==n?i=s=[s,o,l,u]:(se=i,i=n),(a=i!==n?e.substring(a,se):i)!==n?(oe=t,c=a,t=String.fromCharCode(parseInt(c,16))):(se=t,t=n)):(se=t,t=n);var c;return t}())!==n?(oe=t,t=a):(se=t,t=n),t}function Be(){var t;return x.test(e.charAt(se))?(t=e.charAt(se),se++):(t=n,0===de&&he(H)),t}function De(){var t;return de++,j.test(e.charAt(se))?(t=e.charAt(se),se++):(t=n,0===de&&he(X)),de--,t===n&&(n,0===de&&he(Z)),t}function Qe(){var t,r;return t=se,oe=se,(ne()?void 0:n)!==n?(e.substr(se,14)===b?(r=b,se+=14):(r=n,0===de&&he(ee)),r!==n?(oe=t,t=Ue):(se=t,t=n)):(se=t,t=n),t}const{parseCursor:Ge,cursorSymbol:Ue,allowLeadingWildcards:$e=!0,helpers:{nodeTypes:He}}=t,We=He.function.buildNodeWithArgumentNodes,Ke=He.literal.buildNode,Je=He.wildcard.buildNode,{wildcardSymbol:Ye}=He.wildcard;if((r=o())!==n&&se===e.length)return r;throw r!==n&&se<e.length&&he({type:"end"}),ve(ce,ue<e.length?e.charAt(ue):null,ue<e.length?be(ue,ue+1):be(ue,ue))}}},88:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(1);const n=a.i18n.translate("xpack.dataVisualizer.chrome.help.appName",{defaultMessage:"Data Visualizer"})},90:function(e,t,r){"use strict";r.d(t,"a",(function(){return se}));var a=r(0),n=r(24),i=r(1),s=r(49),o=r(71);var l=r(64),u=r(44),c=r(8),d=r(23),f=r(25),p=r.n(f),m=r(69),g=r.n(m);const b=new RegExp("^([0-9]*)\\s*("+g.a.units.join("|")+")$"),h=["ms","s","m","h"],v=["ms","s","m","h","d"];const{duration:y}=p.a;const x=g.a.unitsDesc,j=x.indexOf("w"),O=function(){const e=[[y(500,"ms"),y(100,"ms")],[y(5,"second"),y(1,"second")],[y(10,"second"),y(5,"second")],[y(15,"second"),y(10,"second")],[y(30,"second"),y(15,"second")],[y(1,"minute"),y(30,"second")],[y(5,"minute"),y(1,"minute")],[y(10,"minute"),y(5,"minute")],[y(15,"minute"),y(10,"minute")],[y(30,"minute"),y(10,"minute")],[y(1,"hour"),y(30,"minute")],[y(2,"hour"),y(1,"hour")],[y(4,"hour"),y(2,"hour")],[y(6,"hour"),y(4,"hour")],[y(8,"hour"),y(6,"hour")],[y(12,"hour"),y(8,"hour")],[y(24,"hour"),y(12,"hour")],[y(2,"d"),y(1,"d")],[y(4,"d"),y(2,"d")],[y(1,"week"),y(4,"d")],[y(1,"month"),y(1,"week")],[y(1,"year"),y(1,"month")],[1/0,y(1,"year")]].slice(0).reverse();function t(e,t,r){return function(a,n){const i=function(a,n){const i=n/a;let s;for(let a=0;a<e.length;a++){const n=e[a],o=t(n[0],n[1],i);if(null==o){if(!r)continue;if(s)return s;break}if(!r)return o;s=o}const o=Math.max(Math.floor(i),1);return p.a.duration(o,"ms")}(a,n);if(i)return p.a.duration(i._data)}}return{near:t(e,(function(e,t,r){if(e>r){if(e===1/0)return t;const a=e.asMilliseconds(),n=t.asMilliseconds();return Math.abs(a-r)<=Math.abs(n)?e:t}}),!0),lessThan:t(e,(function(e,t,r){if(t<r)return e!==1/0?e:t})),atLeast:t(e,(function(e,t,r){if(t<=r)return t}))}}();function S(e,t){this._timeBucketsConfig=e,this._fieldFormats=t,this.barTarget=this._timeBucketsConfig[c.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[c.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function E(e,t){const r=function(e){for(let t=0;t<x.length;t++){const r=x[t],a=e.as(r);if(a>=1&&Math.floor(a)===a){if(t<=j)continue;return{value:a,unit:r,expression:a+r}}}const t=e.as("ms");return{value:t,unit:"ms",expression:t+"ms"}}(e);e.esValue=r.value,e.esUnit=r.unit,e.expression=r.expression,e.overflow=t>e&&p.a.duration(e-t);const a=p.a.normalizeUnits(r.unit);return 1===r.value?e.description=a:e.description=`${r.value} ${a}s`,e}function _(e){return e&&"isValid"in e&&e.isValid()}S.prototype.setBarTarget=function(e){this.barTarget=e},S.prototype.setMaxBars=function(e){this.maxBars=e},S.prototype.setBounds=function(e){if(!e)return this.clearBounds();let t;t=Object(d.isPlainObject)(e)?[e.min,e.max]:Array.isArray(e)?e:[];const r=Object(d.sortBy)(t.map(Object(d.ary)(p.a,1)),Number);if(!(2===r.length&&r.every(_)))throw this.clearBounds(),new Error("invalid bounds set: "+e);if(this._lb=r.shift(),this._ub=r.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},S.prototype.clearBounds=function(){this._lb=this._ub=null},S.prototype.hasBounds=function(){return _(this._ub)&&_(this._lb)},S.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},S.prototype.getDuration=function(){if(this.hasBounds())return p.a.duration(this._ub-this._lb,"ms")},S.prototype.setInterval=function(e){this.originalInterval=e;let t=e;if(t&&"auto"!==t){if(Object(d.isString)(t)&&(e=t,t=function(e,t=!1){const r=String(e).trim().match(b);if(!Array.isArray(r)||r.length<3)return null;try{const e=parseInt(r[1],10),a=r[2];return isNaN(e)||e<1&&-1===h.indexOf(a)||!0===t&&-1===v.indexOf(a)?null:Object(f.duration)(e,a)}catch(e){return null}}(t),0==+t&&(t=null)),!p.a.isDuration(t))throw new TypeError('"'+e+'" is not a valid interval.');this._i=t}else this._i="auto"},S.prototype.getInterval=function(){const e=this,t=e.getDuration();return E(function(r){if(!e.hasBounds())return r;const a=e.maxBars;let n;if(!(t/r>a))return r;n=O.lessThan(a,t);return+n==+r?r:(E(r,t),Object(d.assign)(n,{preScaled:r,scale:r/n,scaled:!0}))}(function(){const r=e._i;return p.a.isDuration(r)?r:O.near(e.barTarget,t)}()),t)},S.prototype.getIntervalToNearestMultiple=function(e){const t=this.getInterval(),r=t.asSeconds(),a=r%e;if(0===a)return t;let n=a>e/2?r+e-a:r-a;n=0===n?e:n;const i=p.a.duration(n,"seconds");E(i,this.getDuration());const s=t.preScaled;return void 0!==s&&s<i&&(i.preScaled=s,i.scale=s/i,i.scaled=!0),i},S.prototype.getScaledDateFormat=function(){const e=this.getInterval(),t=this._timeBucketsConfig["dateFormat:scaled"];for(let r=t.length-1;r>=0;r--){const a=t[r];if(!a[0]||e>=p.a.duration(a[0]))return a[1]}return this._timeBucketsConfig.dateFormat},S.prototype.getScaledDateFormatter=function(){return new(this._fieldFormats.getType(u.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)};var F=r(4),w=r(60),N=r(45);const T=i.i18n.translate("xpack.dataVisualizer.index.lensChart.topValuesLabel",{defaultMessage:"Top values"}),M=i.i18n.translate("xpack.dataVisualizer.index.lensChart.countLabel",{defaultMessage:"Count"});function A(e,t,r){if(void 0!==t.fieldName)return e===F.d.DATE?function(e){return{columns:{col2:{dataType:"number",isBucketed:!1,label:M,operationType:"count",scale:"ratio",sourceField:N.DOCUMENT_FIELD_NAME},col1:{dataType:"date",isBucketed:!0,label:e.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:e.fieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t):e===F.d.NUMBER?function(e,t){if(void 0===t.timeFieldName)return{columns:{col1:{label:e.fieldName,dataType:"number",isBucketed:!0,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:N.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}};return{columns:{col2:{dataType:"number",isBucketed:!1,label:i.i18n.translate("xpack.dataVisualizer.index.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:e.fieldName}}),operationType:"average",sourceField:e.fieldName},col1:{dataType:"date",isBucketed:!0,label:t.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:t.timeFieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t,r):e===F.d.IP||e===F.d.KEYWORD?function(e){return{columns:{col1:{label:T,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:N.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar_horizontal",xAccessor:"col1"}}}(t):e===F.d.BOOLEAN?function(e){return{columns:{col1:{label:T,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:M,dataType:"number",isBucketed:!1,sourceField:N.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):void 0}var I=r(46);function z(e,t,r,a){var n,s,o,u,c,d,f;const{lens:p,maps:m,data:g}=t,b=[],h=null!==(n=null==g?void 0:g.query.filterManager.getFilters())&&void 0!==n?n:[],v=()=>{const e={lastRefresh:Date.now()};l.a.next(e)};if(!0===(null===(s=t.application)||void 0===s||null===(o=s.capabilities)||void 0===o||null===(u=o.visualize)||void 0===u?void 0:u.show)&&void 0!==p){const t=null==p?void 0:p.canUseEditor();b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:e=>void 0!==function(e){let t;switch(e){case F.d.KEYWORD:t="string";break;case F.d.DATE:t="date";break;case F.d.NUMBER:t="number";break;case F.d.IP:t="ip";break;case F.d.BOOLEAN:t="string";break;default:t=void 0}return t}(e.type)&&t,onClick:t=>{const a=function(e,t,r,a){if(void 0===e||void 0===a.type||void 0===a.fieldName)return;const n=A(a.type,a,e);return n?{visualizationType:"lnsXY",title:i.i18n.translate("xpack.dataVisualizer.index.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:a.fieldName}}),references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{indexpattern:{layers:{layer1:{columnOrder:["col1","col2"],columns:n.columns}}}},filters:r,query:{language:t.searchQueryLanguage,query:t.searchString},visualization:{axisTitlesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},fittingFunction:"None",gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},layers:[n.layer],legend:{isVisible:!0,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},valueLabels:"hide"}}}:void 0}(e,r,h,t);a&&p.navigateToPrefilledEditor({id:`dataVisualizer-${t.fieldName}`,attributes:a})},"data-test-subj":"dataVisualizerActionViewInLensButton"})}var y;(null!=t&&t.uiActions&&m&&!0===(null===(c=t.application)||void 0===c||null===(d=c.capabilities)||void 0===d||null===(f=d.maps)||void 0===f?void 0:f.show)&&b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsTitle",{defaultMessage:"Explore in Maps"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsDescription",{defaultMessage:"Explore in Maps"}),type:"icon",icon:"gisApp",available:e=>e.type===F.d.GEO_POINT||e.type===F.d.GEO_SHAPE,onClick:async r=>{if(null!=t&&t.uiActions&&e){const a={indexPatternId:e.id,fieldName:r.fieldName,contextualFields:[]},n=await(null==t?void 0:t.uiActions.getTriggerCompatibleActions(I.VISUALIZE_GEO_FIELD_TRIGGER,a));n.length>0&&void 0!==n[0]&&(null==t||t.uiActions.getTrigger(I.VISUALIZE_GEO_FIELD_TRIGGER).exec(a))}},"data-test-subj":"dataVisualizerActionViewInMapsButton"}),void 0!==a)&&(null!==(y=t.dataViewFieldEditor)&&void 0!==y&&y.userPermissions.editIndexPattern()&&(b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldTitle",{defaultMessage:"Edit data view field"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldDescription",{defaultMessage:"Edit data view field"}),type:"icon",icon:"indexEdit",onClick:r=>{var n;a.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openEditor({ctx:{dataView:e},fieldName:r.fieldName,onSave:v})},"data-test-subj":"dataVisualizerActionEditIndexPatternFieldButton"}),b.push({name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteDataViewFieldTitle",{defaultMessage:"Delete data view field"}),description:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteIndexPatternFieldDescription",{defaultMessage:"Delete data view field"}),type:"icon",icon:"trash",available:e=>!0===e.deletable,onClick:r=>{var n;a.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openDeleteModal({ctx:{dataView:e},fieldName:r.fieldName,onDelete:v})},"data-test-subj":"dataVisualizerActionDeleteIndexPatternFieldButton"})));return b}var C=r(62),P=r(26);function k(e,t,r,a){const n=[];return e&&t&&r&&n.push({range:{[e]:{gte:t,lte:r,format:"epoch_millis"}}}),a&&"object"==typeof a&&n.push(a),n}function R(e,t){return t<1?e:{sample:{sampler:{shard_size:t},aggs:e}}}function V(e){return e>0?["sample"]:[]}function q(e,t){return e.match(/^[a-zA-Z0-9-_.]+$/)?e:`field_${t}`}const L=1e5,B=5e3;var D=r(52);const Q=e=>Object(D.a)(e,["rawResponse"]);function G(e){return!0===(null==e?void 0:e.isBoom)}const U=e=>{if(function(e){var t;return e&&void 0!==(null===(t=e.error)||void 0===t?void 0:t.reason)}(e))return{message:e.error.reason,statusCode:e.status,fullError:e};if(function(e){return"string"==typeof e}(e))return{message:e};var t,r;if(function(e){var t;return e&&!0===G(null===(t=e.body)||void 0===t?void 0:t.message)}(e))return null===(t=e.body.message)||void 0===t||null===(r=t.output)||void 0===r?void 0:r.payload;if(G(e))return{message:e.output.payload.message,statusCode:e.output.payload.statusCode};if(void 0===(null==e?void 0:e.body)&&(null==e||!e.message))return{message:""};if("string"==typeof e.body)return{message:e.body};if(function(e){return"object"==typeof e.body&&"message"in e.body}(e)){var a,n;if("object"==typeof e.body.attributes&&"string"==typeof(null===(a=e.body.attributes.body)||void 0===a||null===(n=a.error)||void 0===n?void 0:n.reason)){var i,s,o;const t={message:e.body.attributes.body.error.reason,statusCode:e.body.statusCode,fullError:e.body.attributes.body};var l,u,c;if("object"==typeof e.body.attributes.body.error.caused_by&&("string"==typeof(null===(i=e.body.attributes.body.error.caused_by)||void 0===i?void 0:i.reason)||"string"==typeof(null===(s=e.body.attributes.body.error.caused_by)||void 0===s||null===(o=s.caused_by)||void 0===o?void 0:o.reason)))t.causedBy=(null===(l=e.body.attributes.body.error.caused_by)||void 0===l||null===(u=l.caused_by)||void 0===u?void 0:u.reason)||(null===(c=e.body.attributes.body.error.caused_by)||void 0===c?void 0:c.reason);return Array.isArray(e.body.attributes.body.error.root_cause)&&"object"==typeof e.body.attributes.body.error.root_cause[0]&&Object(D.a)(e.body.attributes.body.error.root_cause[0],["script"])&&(t.causedBy=e.body.attributes.body.error.root_cause[0].script,t.message+=`: '${e.body.attributes.body.error.root_cause[0].script}'`),t}return{message:e.body.message,statusCode:e.body.statusCode}}return function(e){return e&&void 0!==e.message&&"string"==typeof e.message}(e)?{message:e.message}:{message:""}},$=(e,t,r,a)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:r,query:a,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const r=e.safeFieldName;s[`${r}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}})),{index:r,size:0,body:{query:a,aggs:R(s,i),...Object(D.a)(n)?{runtime_mappings:n}:{}}}})(t,r);return e.search({params:s},a).pipe(Object(P.catchError)((e=>Object(n.of)({fields:r,error:U(e)}))),Object(P.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,a=V(i);return r.map(((e,r)=>{const n=e.safeFieldName,i=Object(d.get)(t,[...a,`${n}_field_stats`,"doc_count"],0),s=Object(d.get)(t,[...a,`${n}_field_stats`,"actual_stats"],{});return{fieldName:e.fieldName,count:i,earliest:Object(d.get)(s,"min",0),latest:Object(d.get)(s,"max",0)}}))})))},H=(e,t,r,a)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:r,query:a,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const r=e.safeFieldName;s[`${r}_value_count`]={filter:{exists:{field:e.fieldName}}},s[`${r}_values`]={terms:{field:e.fieldName,size:2}}})),{index:r,size:0,body:{query:a,aggs:R(s,i),...Object(D.a)(n)?{runtime_mappings:n}:{}}}})(t,r);return e.search({params:s},a).pipe(Object(P.catchError)((e=>Object(n.of)({fields:r,error:U(e)}))),Object(P.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,a=V(i);return r.map(((e,r)=>{const n=e.fieldName,i={fieldName:e.fieldName,count:Object(d.get)(t,[...a,`${n}_value_count`,"doc_count"],0),trueCount:0,falseCount:0};return Object(d.get)(t,[...a,`${n}_values`,"buckets"],[]).forEach((e=>{i[`${e.key_as_string}Count`]=e.doc_count})),i}))})))},W=(e,t,r,a)=>{const{maxExamples:i}=t;return Object(n.combineLatest)(r.map((s=>{const o=((e,t)=>{const{index:r,timeFieldName:a,earliestMs:n,latestMs:i,query:s,runtimeFieldMap:o,maxExamples:l}=e,u=Math.max(100,null!=l?l:10),c=k(a,n,i,s);return Array.isArray(c)&&c.push({exists:{field:t.fieldName}}),{index:r,size:u,body:{fields:[t.fieldName],_source:!1,query:{bool:{filter:c}},...Object(D.a)(o)?{runtime_mappings:o}:{}}}})(t,s);return e.search({params:o},a).pipe(Object(P.catchError)((e=>Object(n.of)({fieldName:s.fieldName,fields:r,error:U(e)}))),Object(P.map)((e=>{if(!Q(e))return e;const t=e.rawResponse,r={fieldName:s.fieldName,examples:[]};if(t.hits.total>0){const e=t.hits.hits;for(let t=0;t<e.length;t++){const a=Object(d.get)(e[t].fields,s.fieldName);if(Array.isArray(a)&&a.length>0){const e=a[0];if(void 0!==e&&-1===r.examples.indexOf(e)&&(r.examples.push(e),r.examples.length===i))break}}}return r})))})))},K=(e,t,r,a)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:r,query:a,runtimeFieldMap:n,samplerShardSize:i}=e;let s=0;const o=Array.from(Array(20),(()=>s+=5)),l={};return t.forEach(((e,t)=>{const{safeFieldName:r}=e;l[`${r}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}},l[`${r}_percentiles`]={percentiles:{field:e.fieldName,percents:o,keyed:!1}};const a={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};i<1&&e.cardinality>=L?l[`${r}_top`]={sampler:{shard_size:B},aggs:{top:a}}:l[`${r}_top`]=a})),{index:r,size:0,body:{query:a,aggs:R(l,i),...Object(D.a)(n)?{runtime_mappings:n}:{}}}})(t,r);return e.search({params:s},a).pipe(Object(P.catchError)((e=>Object(n.of)({fields:r,error:U(e)}))),Object(P.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,a=V(i),n=[];return r.forEach(((e,r)=>{const s=e.safeFieldName,o=Object(d.get)(t,[...a,`${s}_field_stats`,"doc_count"],0),l=Object(d.get)(t,[...a,`${s}_field_stats`,"actual_stats"],{}),u=[...a,`${s}_top`];i<1&&e.cardinality>=L&&u.push("top");const c=Object(d.get)(t,[...u,"buckets"],[]),f={fieldName:e.fieldName,count:o,min:Object(d.get)(l,"min",0),max:Object(d.get)(l,"max",0),avg:Object(d.get)(l,"avg",0),isTopValuesSampled:e.cardinality>=L||i>0,topValues:c,topValuesSampleSize:c.reduce(((e,t)=>e+t.doc_count),Object(d.get)(t,[...u,"sum_other_doc_count"],0)),topValuesSamplerShardSize:e.cardinality>=L?B:i};if(f.count>0){const e=Object(d.get)(t,[...a,`${s}_percentiles`,"values"],[]),r=Object(d.find)(e,{key:50});f.median=void 0!==r?r.value:0,f.distribution=((e,t,r)=>{const a={percentiles:[],minPercentile:0,maxPercentile:100};if(0===e.length)return a;let n=[],i=r;if(i>=0){a.minPercentile=0,a.maxPercentile=90,n=e.slice(0,e.length-2);const r=i+1.5*(Object(d.last)(n).value-i);for(let i=n.length;i<e.length&&e[i].value<r;i++)n.push(e[i]),a.maxPercentile+=t}else{const t=i;i=e[0].value,a.minPercentile=5,a.maxPercentile=95,n=e.slice(1,e.length-1);const r=Object(d.last)(n).value,s=.25*(r-i);i-t<s&&(n.splice(0,0,e[0]),a.minPercentile=0,i=t),e[e.length-1].value-r<s&&(n.push(e[e.length-1]),a.maxPercentile=100)}const s=n.length;let o=i,l=0;for(let e=0;e<s;e++){const r=n[e];r.value.toPrecision(15)!==o.toPrecision(15)?(l>0&&a.percentiles.push({percent:l*t,minValue:o,maxValue:o}),a.percentiles.push({percent:t,minValue:o,maxValue:r.value}),o=r.value,l=0):(l++,e===s-1&&a.percentiles.push({percent:l*t,minValue:o,maxValue:o}))}return a})(e,5,f.min)}n.push(f)})),n})))},J=(e,t,r,a)=>{const{samplerShardSize:i}=t,s=((e,t)=>{const{index:r,query:a,runtimeFieldMap:n,samplerShardSize:i}=e,s={};return t.forEach(((e,t)=>{const r=e.safeFieldName,a={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};i<1&&e.cardinality>=L?s[`${r}_top`]={sampler:{shard_size:B},aggs:{top:a}}:s[`${r}_top`]=a})),{index:r,size:0,body:{query:a,aggs:R(s,i),...Object(D.a)(n)?{runtime_mappings:n}:{}}}})(t,r);return e.search({params:s},a).pipe(Object(P.catchError)((e=>Object(n.of)({fields:r,error:U(e)}))),Object(P.map)((e=>{if(!Q(e))return e;const t=e.rawResponse.aggregations,a=V(i),n=[];return r.forEach(((e,r)=>{const s=e.safeFieldName,o=[...a,`${s}_top`];i<1&&e.cardinality>=L&&o.push("top");const l=Object(d.get)(t,[...o,"buckets"],[]),u={fieldName:e.fieldName,isTopValuesSampled:e.cardinality>=L||i>0,topValues:l,topValuesSampleSize:l.reduce(((e,t)=>e+t.doc_count),Object(d.get)(t,[...o,"sum_other_doc_count"],0)),topValuesSamplerShardSize:e.cardinality>=L?B:i};n.push(u)})),n})))},Y=(e,t,r,a)=>{switch(r[0].type){case F.d.NUMBER:return K(e,t,r,a);case F.d.KEYWORD:case F.d.IP:return J(e,t,r,a);case F.d.DATE:return $(e,t,r,a);case F.d.BOOLEAN:return H(e,t,r,a);case F.d.TEXT:default:return W(e,t,r,a)}};function Z(e,t,r){const{services:{data:o,notifications:{toasts:l}}}=Object(s.a)(),[u,c]=Object(a.useState)(),[f,p]=Object(a.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),m=Object(a.useRef)(new AbortController),g=Object(a.useRef)(),b=Object(a.useRef)(),h=Object(a.useCallback)((()=>{var a,s;if(null===(a=g.current)||void 0===a||a.unsubscribe(),null===(s=b.current)||void 0===s||s.unsubscribe(),m.current.abort(),m.current=new AbortController,p({isRunning:!1,loaded:0,total:100,error:void 0}),c(void 0),!e||!t||0===t.metricConfigs.length&&0===t.nonMetricConfigs.length)return void p({loaded:100,isRunning:!1});const{sortField:u,sortDirection:f}=r;let h=[...t.metricConfigs,...t.nonMetricConfigs];"fieldName"!==u&&"type"!==u||(h=h.sort(((e,t)=>e[u].localeCompare(t[u])))),"desc"===f&&(h=h.reverse());const v=k(e.timeFieldName,e.earliest,e.latest,e.searchQuery),y={index:e.index,samplerShardSize:e.samplerShardSize,timeFieldName:e.timeFieldName,earliestMs:e.earliest,latestMs:e.latest,runtimeFieldMap:e.runtimeFieldMap,intervalMs:e.intervalMs,query:{bool:{filter:v}},maxExamples:10},x={abortSignal:m.current.signal,sessionId:null==e?void 0:e.sessionId},j=((e,t=10)=>{const r=[],a={};return e.forEach((e=>{const r=e.type;void 0===a[r]&&(a[r]=[[]]);let n=Object(d.last)(a[r]);n.length===t&&(n=[],a[r].push(n)),n.push(e)})),Object.values(a).forEach((e=>{r.push(...e)})),r})(h.map(((e,t)=>({fieldName:e.fieldName,type:e.type,cardinality:e.cardinality,safeFieldName:q(e.fieldName,t)}))),10),O=new n.Subject,S=new n.Subject,E=Object(n.combineLatest)(j.map((e=>Y(o.search,y,e,x))).filter((e=>void 0!==e))),_=e=>{l.addError(e,{title:i.i18n.translate("xpack.dataVisualizer.index.errorFetchingFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics"})}),p({isRunning:!1,error:e})},F=()=>{p({isRunning:!1})};g.current=E.subscribe({next:e=>{if(e){const t=new Map,r=[];e.forEach((e=>{var a;Array.isArray(e)?e.forEach((e=>{void 0!==e.fieldName&&t.set(e.fieldName,e)})):r.push(...null!==(a=e.fields)&&void 0!==a?a:[])})),p({loaded:t.size/h.length*100,isRunning:!0}),c(t),r.length>0&&(O.next(t),S.next(r))}},error:_,complete:F}),b.current=Object(n.combineLatest)([O,S.pipe(Object(P.switchMap)((e=>Object(n.combineLatest)(e.map((e=>Y(o.search,y,[e],x))).filter((e=>void 0!==e))))))]).subscribe({next:e=>{const t=Object(d.cloneDeep)(e[0]),r=e[1];Array.isArray(r)&&(r.forEach((e=>{Array.isArray(e)&&1===e.length&&t.set(e[0].fields[0],e[0])})),c(t),p({loaded:t.size/h.length*100,isRunning:!0}))},error:_,complete:F})}),[o.search,l,t,r]),v=Object(a.useCallback)((()=>{var e,t;null===(e=g.current)||void 0===e||e.unsubscribe(),g.current=void 0,null===(t=b.current)||void 0===t||t.unsubscribe(),b.current=void 0,m.current.abort(),p({isRunning:!1})}),[]);return Object(a.useEffect)((()=>(h(),v)),[h,v]),{progress:f,fieldStats:u,startFetch:h,cancelFetch:v}}const X=(e,t,r,a,n,i,s,o,l)=>{const u=e,c=k(n,i,s,t),d=(e=>{return void 0!==(null==(t=e)?void 0:t.aggregations)?t.aggregations:void 0!==(null==t?void 0:t.aggs)?t.aggs:void 0;var t})(o),f=void 0!==d?{...d}:{},p={...Object(D.a)(l)?l:{},...Object(D.a)(o)&&Object(D.a)(o.runtime_mappings)?o.runtime_mappings:{}};r.forEach(((e,t)=>{var r;const a=q(e,t);let n;f[`${a}_count`]={filter:{exists:{field:e}}},n=null!=o&&null!==(r=o.script_fields)&&void 0!==r&&r.hasOwnProperty(e)?f[`${a}_cardinality`]={cardinality:{script:null==o?void 0:o.script_fields[e].script}}:{cardinality:{field:e}},f[`${a}_cardinality`]=n}));return{index:u,track_total_hits:!0,size:0,body:{query:{bool:{filter:c}},...Object(D.a)(f)?{aggs:R(f,a)}:{},...Object(D.a)(p)?{runtime_mappings:p}:{}}}},ee=(e,t,r,a,n,i,s)=>{const o=e,l=k(a,n,i,t),u={query:{bool:{filter:l}},...Object(D.a)(s)?{runtime_mappings:s}:{}};return Array.isArray(l)&&l.push({exists:{field:r}}),{index:o,size:0,body:u,track_total_hits:1}},te=e=>{const{index:t,timeFieldName:r,earliest:a,latest:n,runtimeFieldMap:i,searchQuery:s,intervalMs:o}=e;return{index:t,size:0,body:{query:{bool:{filter:k(r,a,n,s)}},aggs:{eventRate:{date_histogram:{field:r,fixed_interval:`${o}ms`,min_doc_count:1}}},...Object(D.a)(i)?{runtime_mappings:i}:{}}}},re=(e,t)=>{if(!e||void 0===t.intervalMs||void 0===t.earliest||void 0===t.latest)return;const r={},a=Object(d.get)(e,["aggregations","eventRate","buckets"],[]);return Object(d.each)(a,(e=>{const t=e.key;r[t]=e.doc_count})),{interval:t.intervalMs,buckets:r,timeRangeEarliest:t.earliest,timeRangeLatest:t.latest}};function ae(e,t){const{services:{data:r,notifications:{toasts:o}}}=Object(s.a)(),[l,u]=Object(a.useState)(Object(C.c)().overallStats),[c,f]=Object(a.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),p=Object(a.useRef)(new AbortController),m=Object(a.useRef)(),g=Object(a.useCallback)((()=>{var a;if(null===(a=m.current)||void 0===a||a.unsubscribe(),p.current.abort(),p.current=new AbortController,!e||0===t)return;f({isRunning:!1,loaded:0,total:100,error:void 0});const{aggregatableFields:s,nonAggregatableFields:l,index:c,searchQuery:g,timeFieldName:b,earliest:h,latest:v,intervalMs:y,runtimeFieldMap:x,samplerShardSize:j,fieldsToFetch:O}=e,S={abortSignal:p.current.signal,sessionId:null==e?void 0:e.sessionId},E=l.length>0?Object(n.forkJoin)(l.map((e=>r.search.search({params:ee(c,g,e,b,h,v,x)},S).pipe(Object(P.switchMap)((t=>Object(n.of)({...t,rawResponse:{...t.rawResponse,fieldName:e}}))))))):Object(n.of)(void 0),_=Object(d.chunk)(s,30),F=Object(n.forkJoin)(s.length>0?_.map((e=>r.search.search({params:X(c,g,e,j,b,h,v,void 0,x)},S).pipe(Object(P.switchMap)((t=>Object(n.of)({...t,aggregatableFields:e})))))):Object(n.of)(void 0)),w=!O&&void 0!==b&&void 0!==y&&y>0?r.search.search({params:te(e)},S):Object(n.of)(void 0),N=Object(n.forkJoin)({documentCountStatsResp:w,nonAggregatableOverallStatsResp:E,aggregatableOverallStatsResp:F}).pipe(Object(P.switchMap)((({documentCountStatsResp:t,nonAggregatableOverallStatsResp:r,aggregatableOverallStatsResp:a})=>{const i=((e,t,r,a)=>{const n={totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[]};return e&&0!==t.length?(e.forEach((({rawResponse:e,aggregatableFields:t})=>{var i;const s=e.aggregations,o=null!==(i=e.hits.total.value)&&void 0!==i?i:e.hits.total;n.totalCount=o;const l=V(r),u=r>0?Object(d.get)(s,["sample","doc_count"],0):o;t.forEach(((e,t)=>{const r=q(e,t),i=Object(d.get)(s,[...l,`${r}_count`,"doc_count"],0);if(i>0){const t=Object(d.get)(s,[...l,`${r}_cardinality`,"value"],0);n.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:u,count:i,cardinality:t}})}else{var o,c;if(null!=a&&null!==(o=a.script_fields)&&void 0!==o&&o.hasOwnProperty(e)||null!=a&&null!==(c=a.runtime_mappings)&&void 0!==c&&c.hasOwnProperty(e)){const t=Object(d.get)(s,[...l,`${r}_cardinality`,"value"],0);n.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:u,count:i,cardinality:t}})}else n.aggregatableNotExistsFields.push({fieldName:e,existsInDocs:!1,stats:{}})}}))})),n):n})(a,s,j),o=((e,t)=>{const r={nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};return e&&0!==t.length?(t.forEach((t=>{const a=e.find((e=>e.rawResponse.fieldName===t)),n=void 0!==a&&a.rawResponse.hits.total>0,i={fieldName:t,existsInDocs:n};!0===n?r.nonAggregatableExistsFields.push(i):r.nonAggregatableNotExistsFields.push(i)})),r):r})(r,l);return Object(n.of)({documentCountStats:re(null==t?void 0:t.rawResponse,e),...o,...i})})));m.current=N.subscribe({next:e=>{e&&u(e)},error:t=>{var r,a,n,s,l;r=o,a=e.index,500===(n=U(t)).statusCode?r.addError(n,{title:i.i18n.translate("xpack.dataVisualizer.index.dataLoader.internalServerErrorMessage",{defaultMessage:"Error loading data in index {index}. {message}. The request may have timed out. Try using a smaller sample size or narrowing the time range.",values:{index:a,message:null!==(s=n.error)&&void 0!==s?s:n.message}})}):r.addError(n,{title:i.i18n.translate("xpack.dataVisualizer.index.errorLoadingDataMessage",{defaultMessage:"Error loading data in index {index}. {message}.",values:{index:a,message:null!==(l=n.error)&&void 0!==l?l:n.message}})}),f({isRunning:!1,error:t})},complete:()=>{f({loaded:100,isRunning:!1})}})}),[r.search,e,o,t]),b=Object(a.useCallback)((()=>{var e;null===(e=m.current)||void 0===e||e.unsubscribe(),m.current=void 0,p.current.abort()}),[]);return Object(a.useEffect)((()=>(g(),b)),[g,b]),Object(a.useMemo)((()=>({progress:c,overallStats:l})),[l,c])}const ne=Object(C.c)();function ie(e){return!F.g.includes(e)}const se=(e,t,r)=>{const{services:u}=Object(s.a)(),{uiSettings:d,data:f}=u,{samplerShardSize:p,visibleFieldTypes:m,showEmptyFields:g}=t,b=Object(a.useRef)(t),[h,v]=Object(a.useState)(0),y=e.sessionId,{currentSavedSearch:x,currentIndexPattern:j,currentQuery:O,currentFilters:E,visibleFieldNames:_,fieldsToFetch:N}=Object(a.useMemo)((()=>{var t;return{currentSavedSearch:null==e?void 0:e.savedSearch,currentIndexPattern:e.indexPattern,currentQuery:null==e?void 0:e.query,visibleFieldNames:null!==(t=null==e?void 0:e.visibleFieldNames)&&void 0!==t?t:[],currentFilters:null==e?void 0:e.filters,fieldsToFetch:null==e?void 0:e.fieldsToFetch}}),[e]),{searchQueryLanguage:T,searchString:M,searchQuery:A}=Object(a.useMemo)((()=>{const e=Object(o.b)({indexPattern:j,uiSettings:d,savedSearch:x,query:O,filters:E,filterManager:f.query.filterManager});return void 0===e||""!==t.searchString?(t.filters&&f.query.filterManager.setFilters(t.filters),{searchQuery:t.searchQuery,searchString:t.searchString,searchQueryLanguage:t.searchQueryLanguage}):{searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage}}),[null==x?void 0:x.id,j.id,t.searchString,t.searchQueryLanguage,JSON.stringify({searchQuery:t.searchQuery,currentQuery:O,currentFilters:E}),h]),I=Object(a.useMemo)((()=>new S({[c.UI_SETTINGS.HISTOGRAM_MAX_BARS]:d.get(c.UI_SETTINGS.HISTOGRAM_MAX_BARS),[c.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:d.get(c.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:d.get("dateFormat"),"dateFormat:scaled":d.get("dateFormat:scaled")})),[d]),C=(({timeRangeSelector:e,autoRefreshSelector:t}={})=>{const{services:r}=Object(s.a)(),{timefilter:n}=r.data.query.timefilter;return Object(a.useEffect)((()=>{!0===e?n.enableTimeRangeSelector():!1===e&&n.disableTimeRangeSelector(),!0===t?n.enableAutoRefreshSelector():!1===t&&n.disableAutoRefreshSelector()}),[e,t,n]),n})({timeRangeSelector:void 0!==(null==j?void 0:j.timeFieldName),autoRefreshSelector:!0}),[P,k]=Object(a.useState)(ne.metricConfigs),[R,V]=Object(a.useState)(ne.metricsLoaded),[q,L]=Object(a.useState)(),[B,D]=Object(a.useState)(ne.nonMetricConfigs),[Q,G]=Object(a.useState)(ne.nonMetricsLoaded),U=Object(a.useMemo)((()=>{const e=I,t=C;if(!e||!t||!j)return;const r=t.getActiveBounds();let a,n;var i,s;void 0!==r&&void 0!==j.timeFieldName&&(a=null===(i=r.min)||void 0===i?void 0:i.valueOf(),n=null===(s=r.max)||void 0===s?void 0:s.valueOf());const o=t.getActiveBounds();e.setInterval("auto"),o&&(e.setBounds(o),e.setBarTarget(75));const l=e.getInterval(),u=[],c=[],d=j.fields;return null==d||d.forEach((e=>{if(N&&!N.includes(e.name))return;const t=void 0!==e.displayName?e.displayName:e.name;F.g.includes(t)||(!0!==e.aggregatable||F.f.has(e.type)?c.push(e.name):u.push(e.name))})),{earliest:a,latest:n,aggInterval:l,intervalMs:null==l?void 0:l.asMilliseconds(),searchQuery:A,samplerShardSize:p,sessionId:y,index:j.title,timeFieldName:j.timeFieldName,runtimeFieldMap:j.getComputedFields().runtimeFields,aggregatableFields:u,nonAggregatableFields:c,fieldsToFetch:N}}),[I,C,j.id,JSON.stringify(A),p,y,h,N]),{overallStats:$,progress:H}=ae(U,h),W=Z(U,Object(a.useMemo)((()=>{if(H.loaded<100)return;return{metricConfigs:P.map((e=>{var t,r;if(!1!==e.existsInDocs)return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(r=e.stats)||void 0===r?void 0:r.cardinality)&&void 0!==t?t:0}})).filter((e=>void 0!==e)),nonMetricConfigs:B.map((e=>{var t,r;if(!1!==e.existsInDocs)return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(r=e.stats)||void 0===r?void 0:r.cardinality)&&void 0!==t?t:0}})).filter((e=>void 0!==e))}}),[P,B,H.loaded]),b.current),K=Object(a.useMemo)((()=>.2*H.loaded+.8*W.progress.loaded),[H.loaded,W.progress.loaded]);Object(a.useEffect)((()=>{const e=Object(n.merge)(C.getTimeUpdate$(),C.getAutoRefreshFetch$(),l.a).subscribe((()=>{r&&r({time:C.getTime(),refreshInterval:C.getRefreshInterval()}),v(Date.now())}));return()=>{e.unsubscribe()}}));const J=Object(a.useMemo)((()=>j.fields),[j]),Y=Object(a.useCallback)((()=>{const e=[],t=$.aggregatableExistsFields||[],r=J.filter((e=>e.type===c.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===ie(e.displayName))),a=r.filter((e=>t.find((t=>t.fieldName===e.spec.name))));if(!1===R)return void V(!0);let n=$.aggregatableExistsFields;r.length!==a.length&&!0===R&&(n=n.concat($.aggregatableNotExistsFields));const i=!0===R&&!0===g?r:a;i.forEach((t=>{const r=n.find((e=>e.fieldName===t.spec.name));if(!r)return;const a={...r,fieldFormat:j.getFormatterForField(t),type:F.d.NUMBER,loading:!0,aggregatable:!0,deletable:void 0!==t.runtimeField};t.displayName!==a.fieldName&&(a.displayName=t.displayName),e.push(a)})),L({totalMetricFieldsCount:r.length,visibleMetricsCount:i.length}),k(e)}),[j,J,R,$,g]),X=Object(a.useCallback)((()=>{const e=J.filter((e=>e.type!==c.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===ie(e.displayName))),t=[];let r=[];const a=$.aggregatableExistsFields||[],n=$.nonAggregatableExistsFields||[];if(e.forEach((e=>{const i=a.find((t=>t.fieldName===e.spec.name));if(void 0!==i)t.push(e),r.push(i);else{const a=n.find((t=>t.fieldName===e.spec.name));void 0!==a&&(t.push(e),r.push(a))}})),!1===Q)return void G(!0);e.length!==r.length&&!0===g&&(r=r.concat($.aggregatableNotExistsFields,$.nonAggregatableNotExistsFields));const i=[];(g?e:t).forEach((e=>{var t;const a=r.find((t=>t.fieldName===e.spec.name)),n={...a||{},fieldFormat:j.getFormatterForField(e),aggregatable:e.aggregatable,loading:null===(t=null==a?void 0:a.existsInDocs)||void 0===t||t,deletable:void 0!==e.runtimeField},s=Object(w.c)(e);void 0!==s?n.type=s:(n.type=e.type,n.isUnsupportedType=!0),e.displayName!==n.fieldName&&(n.displayName=e.displayName),i.push(n)})),D(i)}),[j,J,Q,$,g]);Object(a.useEffect)((()=>{Y(),X()}),[$,g]);const ee=Object(a.useMemo)((()=>{const e=W.fieldStats;let t=[...B,...P];return m&&m.length>0&&(t=t.filter((e=>m.findIndex((t=>t===e.type))>-1))),_&&_.length>0&&(t=t.filter((e=>_.findIndex((t=>t===e.fieldName))>-1))),e&&(t=t.map((t=>{var r;const a=null!==(r=e.get(t.fieldName))&&void 0!==r?r:{};return a?{...t,loading:!1,stats:{...t.stats,...a}}:t}))),t}),[B,P,m,_,W.fieldStats]),te=Object(a.useRef)();Object(a.useEffect)((()=>{const e=te;return()=>{e.current&&e.current()}}),[]);const re=Object(a.useMemo)((()=>{const t=z(e.indexPattern,u,{searchQueryLanguage:T,searchString:M},e.allowEditDataView?te:void 0);if(!Array.isArray(t)||t.length<1)return;return[{name:i.i18n.translate("xpack.dataVisualizer.index.dataGrid.actionsColumnLabel",{defaultMessage:"Actions"}),actions:t,width:"70px"}]}),[e.indexPattern,u,T,M,e.allowEditDataView]);return{progress:K,configs:ee,searchQueryLanguage:T,searchString:M,searchQuery:A,extendedColumns:re,documentCountStats:$.documentCountStats,metricsStats:q,overallStats:$,timefilter:C,setLastRefresh:v}}},92:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var a=r(0),n=r(56),i=r(57),s=r(65),o=r(49),l=r(4),u=r(75),c=r(55),d=r(5);const f=({config:e,indexPattern:t,combinedQuery:r})=>{const{stats:f}=e,[p,m]=Object(a.useState)([]),{services:{maps:g,data:b}}=Object(o.a)();return Object(a.useEffect)((()=>{!async function(){if(void 0!==(null==t?void 0:t.id)&&void 0!==e&&void 0!==e.fieldName&&(e.type===l.d.GEO_POINT||e.type===l.d.GEO_SHAPE)){var a;const n={indexPatternId:t.id,geoFieldName:e.fieldName,geoFieldType:e.type,filters:null!==(a=b.query.filterManager.getFilters())&&void 0!==a?a:[],query:{query:r.searchString,language:r.searchQueryLanguage}},i=g?await g.createLayerDescriptors.createESSearchSourceLayerDescriptor(n):null;i&&m([...p,i])}}()}),[t,r,e,g,b.query]),void 0===(null==f?void 0:f.examples)?null:Object(d.jsx)(n.a,{dataTestSubj:"dataVisualizerIndexBasedMapContent"},Object(d.jsx)(i.a,{config:e}),Object(d.jsx)(s.a,{examples:f.examples}),Object(d.jsx)(c.a,{className:"dvPanel__wrapper dvMap__wrapper",grow:!0},Object(d.jsx)(u.a,{layerList:p})))};var p=r(91),m=r(21),g=r(22);const b=()=>Object(d.jsx)(a.Fragment,null,Object(d.jsx)(m.EuiText,{textAlign:"center"},Object(d.jsx)(m.EuiIcon,{type:"alert"})),Object(d.jsx)(m.EuiText,{textAlign:"center",size:"xs"},Object(d.jsx)(g.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"}))),h=()=>Object(d.jsx)(a.Fragment,null,Object(d.jsx)(m.EuiSpacer,{size:"xxl"}),Object(d.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(m.EuiFlexItem,{grow:!1},Object(d.jsx)(m.EuiLoadingSpinner,{size:"l"}))),Object(d.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(m.EuiFlexItem,{grow:!1},Object(d.jsx)(m.EuiText,{color:"subdued"},Object(d.jsx)(g.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.loadingLabel",defaultMessage:"Loading"})))));var v=r(83);const y=({item:e,indexPattern:t,combinedQuery:r,onAddFilter:a})=>{const n=e,{loading:i,type:s,existsInDocs:o,fieldName:u}=n;return Object(d.jsx)("div",{className:"dvExpandedRow","data-test-subj":`dataVisualizerFieldExpandedRow-${u}`},!0===i?Object(d.jsx)(h,null):function(){var e,i;if(!1===o)return Object(d.jsx)(b,null);if(null!==(e=n.stats)&&void 0!==e&&e.error)return Object(d.jsx)(v.a,{fieldName:u,error:null===(i=n.stats)||void 0===i?void 0:i.error});switch(s){case l.d.NUMBER:return Object(d.jsx)(p.e,{config:n,onAddFilter:a});case l.d.BOOLEAN:return Object(d.jsx)(p.a,{config:n});case l.d.DATE:return Object(d.jsx)(p.b,{config:n});case l.d.GEO_POINT:case l.d.GEO_SHAPE:return Object(d.jsx)(f,{config:n,indexPattern:t,combinedQuery:r});case l.d.IP:return Object(d.jsx)(p.c,{config:n,onAddFilter:a});case l.d.KEYWORD:return Object(d.jsx)(p.d,{config:n,onAddFilter:a});case l.d.TEXT:return Object(d.jsx)(p.g,{config:n});default:return Object(d.jsx)(p.f,{config:n})}}())}}}]);