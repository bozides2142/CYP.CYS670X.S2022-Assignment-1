(window.visTypeVega_bundle_jsonpfunction=window.visTypeVega_bundle_jsonpfunction||[]).push([[7],{166:function(e,t){e.exports=function(e){const[t,a]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:a}}},167:function(e,t,a){var i,r,s;r=[],void 0===(s="function"==typeof(i=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e,t){return-1===e.indexOf(t)?e.length:e.indexOf(t)}function a(e){var a=e.replace(/^v/,"").replace(/\+.*$/,""),i=t(a,"-"),r=a.substring(0,i).split(".");return r.push(a.substring(i+1)),r}function i(e){return isNaN(Number(e))?e:Number(e)}function r(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function s(e,t){[e,t].forEach(r);for(var s=a(e),n=a(t),o=0;o<Math.max(s.length-1,n.length-1);o++){var l=parseInt(s[o]||0,10),u=parseInt(n[o]||0,10);if(l>u)return 1;if(u>l)return-1}var c=s[s.length-1],g=n[n.length-1];if(c&&g){var h=c.split(".").map(i),f=g.split(".").map(i);for(o=0;o<Math.max(h.length,f.length);o++){if(void 0===h[o]||"string"==typeof f[o]&&"number"==typeof h[o])return-1;if(void 0===f[o]||"string"==typeof h[o]&&"number"==typeof f[o])return 1;if(h[o]>f[o])return 1;if(f[o]>h[o])return-1}}else if(c||g)return c?-1:1;return 0}var n=[">",">=","=","<","<="],o={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function l(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===n.indexOf(e))throw new TypeError("Invalid operator, expected one of "+n.join("|"))}return s.compare=function(e,t,a){l(a);var i=s(e,t);return o[a].indexOf(i)>-1},s})?i.apply(t,r):i)||(e.exports=s)},236:function(e,t,a){"use strict";a.r(t),a.d(t,"VegaParser",(function(){return vega_parser_VegaParser}));var i=a(9),r=a.n(i),s=a(8),n=a.n(s),o=a(166),l=a.n(o),u=a(167),c=a.n(u),g=a(11),h=a.n(g),f=a(5),d=a(36),p=a(3),m=a(47),v=a(84),y=a(32),_=a.n(y),b=a(37);const P="%timefilter%",V="%autointerval%",w="%dashboard_context-must_clause%",M="%dashboard_context-must_not_clause%",T="%dashboard_context-filter_clause%",x="%context_query%",C="%context%",S="%timefield%",E=(e,t)=>e.dataObject.name||p.i18n.translate("visTypeVega.esQueryParser.unnamedRequest",{defaultMessage:"Unnamed request #{index}",values:{index:t}});class es_query_parser_EsQueryParser{constructor(e,t,a,i){r()(this,"_timeCache",void 0),r()(this,"_searchAPI",void 0),r()(this,"_filters",void 0),r()(this,"_onWarning",void 0),this._timeCache=e,this._searchAPI=t,this._filters=a,this._onWarning=i}parseUrl(e,t){let a=t.body,i=t[C];delete t[C];let r=t[S];delete t[S];let n=void 0!==i||void 0!==r;if(void 0===a)t.body=a={};else if(!Object(s.isPlainObject)(a))throw new Error(p.i18n.translate("visTypeVega.esQueryParser.urlBodyValueTypeErrorMessage",{defaultMessage:"{configName} must be an object",values:{configName:"url.body"}}));const o=t[x];if(delete t[x],void 0!==o){if(void 0!==a.query)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyAndBodyQueryValuesAtTheSameTimeErrorMessage",{defaultMessage:"{dataUrlParam} must not have legacy {legacyContext} and {bodyQueryConfigName} values at the same time",values:{legacyContext:'"%context_query%"',bodyQueryConfigName:'"body.query"',dataUrlParam:'"data.url"'}}));if(n)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyContextTogetherWithContextOrTimefieldErrorMessage",{defaultMessage:"{dataUrlParam} must not have {legacyContext} together with {context} or {timefield}",values:{legacyContext:'"%context_query%"',context:'"%context%"',timefield:'"%timefield%"',dataUrlParam:'"data.url"'}}));if(!0!==o&&("string"!=typeof o||0===o.length))throw new Error(p.i18n.translate("visTypeVega.esQueryParser.legacyContextCanBeTrueErrorMessage",{defaultMessage:"Legacy {legacyContext} can either be {trueValue} (ignores time range picker), or it can be the name of the time field, e.g. {timestampParam}",values:{legacyContext:'"%context_query%"',trueValue:"true",timestampParam:'"@timestamp"'}}));n=!0,i=!0;let e='"url": {"%context%": true';"string"==typeof o&&(r=o,e+=`, "%timefield%": ${JSON.stringify(r)}`),e+="}",this._onWarning(p.i18n.translate("visTypeVega.esQueryParser.legacyUrlShouldChangeToWarningMessage",{defaultMessage:"Legacy {urlParam}: {legacyUrl} should change to {result}",values:{legacyUrl:`"%context_query%": ${JSON.stringify(o)}`,result:e,urlParam:'"url"'}}))}if(void 0!==a.query){if(n)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.urlContextAndUrlTimefieldMustNotBeUsedErrorMessage",{defaultMessage:"{urlContext} and {timefield} must not be used when {queryParam} is set",values:{timefield:"url.%timefield%",urlContext:"url.%context%",queryParam:"url.body.query"}}));this._injectContextVars(a.query,!0)}else if(n&&(r&&(a.query={range:{[r]:this._createRangeFilter({[P]:!0})}}),i)){const e=Object(s.cloneDeep)(this._filters);r&&e.bool.must.push(a.query),a.query=e}return this._injectContextVars(a.aggs,!1),{dataObject:e,url:t}}async populateData(e){const t=e.map(((e,t)=>({...e.url,name:E(e,t)}))),a=this._searchAPI.search(t);(await a.toPromise()).forEach(((t,a)=>{const i=e.find((e=>E(e,a)===t.name));i&&(i.dataObject.url=i.url,i.dataObject.values=t.rawResponse)}))}_injectContextVars(e,t,a){if(e&&"object"==typeof e)if(Array.isArray(e))for(let a=0;a<e.length;){const i=e[a];if(!t||i!==T&&i!==w&&i!==M)this._injectContextVars(i,t),a++;else{let t="";switch(i){case T:t="filter";break;case w:t="must";break;case M:t="must_not"}const r=Object(s.cloneDeep)(this._filters);r&&r.bool&&r.bool[t]?Array.isArray(r.bool[t])?(e.splice(a,1,...r.bool[t]),a+=r.bool[t].length):e[a++]=r.bool[t]:e.splice(a,1)}}else for(const i of Object.keys(e)){const r=e[i];if(r&&"object"==typeof e)if("interval"!==i||"date_histogram"!==a)switch(r[P]){case"min":case"max":e[i]=this._getTimeBound(r,r[P]);continue;case!0:this._createRangeFilter(r);continue;case void 0:this._injectContextVars(r,t,i);continue;default:throw new Error(p.i18n.translate("visTypeVega.esQueryParser.timefilterValueErrorMessage",{defaultMessage:"{timefilter} property must be set to {trueValue}, {minValue}, or {maxValue}",values:{timefilter:'"%timefilter%"',trueValue:"true",minValue:'"min"',maxValue:'"max"'}}))}else{let t;if("string"==typeof r)t=r;else if(r[V]){let e=r[V];if(!0===e)e=50;else if("number"!=typeof e)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.autointervalValueTypeErrorMessage",{defaultMessage:"{autointerval} must be either {trueValue} or a number",values:{autointerval:'"%autointerval%"',trueValue:"true"}}));const{max:a,min:i}=this._timeCache.getTimeBounds();t=es_query_parser_EsQueryParser._roundInterval((a-i)/e)}Object.assign(e,Object(b.dateHistogramInterval)(t)),delete e.interval}}}_createRangeFilter(e){return e.gte=_()(this._getTimeBound(e,"min")).toISOString(),e.lte=_()(this._getTimeBound(e,"max")).toISOString(),e.format="strict_date_optional_time",delete e[P],delete e.shift,delete e.unit,e}_getTimeBound(e,t){var a;let i=(null===(a=this._timeCache.getTimeBounds()[t])||void 0===a?void 0:a.valueOf())||0;if(e.shift){const t=e.shift;if("number"!=typeof t)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.shiftMustValueTypeErrorMessage",{defaultMessage:"{shiftParam} must be a numeric value",values:{shiftParam:'"shift"'}}));let a;switch(e.unit||"d"){case"w":case"week":a=6048e5;break;case"d":case"day":a=864e5;break;case"h":case"hour":a=36e5;break;case"m":case"minute":a=6e4;break;case"s":case"second":a=1e3;break;default:throw new Error(p.i18n.translate("visTypeVega.esQueryParser.unknownUnitValueErrorMessage",{defaultMessage:"Unknown {unitParamName} value. Must be one of: [{unitParamValues}]",values:{unitParamName:'"unit"',unitParamValues:'"week", "day", "hour", "minute", "second"'}}))}i+=t*a}return i}static _roundInterval(e){switch(!0){case e<=500:return"100ms";case e<=5e3:return"1s";case e<=7500:return"5s";case e<=15e3:return"10s";case e<=45e3:return"30s";case e<=18e4:return"1m";case e<=45e4:return"5m";case e<=12e5:return"10m";case e<=27e5:return"30m";case e<=72e5:return"1h";case e<=216e5:return"3h";case e<=864e5:return"12h";case e<=6048e5:return"24h";case e<=18144e5:return"1w";case e<36288e5:return"30d";default:return"1y"}}}var j=a(85),O=a(64);class ems_file_parser_EmsFileParser{constructor(e){r()(this,"_serviceSettings",void 0),r()(this,"_fileLayersP",void 0),this._serviceSettings=e}parseUrl(e,t){if("string"!=typeof t.name)throw new Error(p.i18n.translate("visTypeVega.emsFileParser.missingNameOfFileErrorMessage",{defaultMessage:"{dataUrlParam} with {dataUrlParamValue} requires {nameParam} parameter (name of the file)",values:{dataUrlParam:'"data.url"',dataUrlParamValue:'{"%type%": "emsfile"}',nameParam:'"name"'}}));return this._fileLayersP||(this._fileLayersP=this._serviceSettings.getFileLayers()),{obj:e,name:t.name}}async populateData(e){if(0===e.length)return;const t=await this._fileLayersP;for(const{obj:a,name:i}of e){const e=null==t?void 0:t.find((e=>e.name===i));if(!e)throw new Error(p.i18n.translate("visTypeVega.emsFileParser.emsFileNameDoesNotExistErrorMessage",{defaultMessage:"{emsfile} {emsfileName} does not exist",values:{emsfileName:JSON.stringify(i),emsfile:"emsfile"}}));const r=await this._serviceSettings.getUrlForRegionLayer(e);a.url=Object(O.b)(r)}}}var D=a(33),k=a.n(D);class url_parser_UrlParser{constructor(e){r()(this,"_onWarning",void 0),this._onWarning=e}parseUrl(e,t){let a=t.url;if(!a)throw new Error(p.i18n.translate("visTypeVega.urlParser.dataUrlRequiresUrlParameterInFormErrorMessage",{defaultMessage:'{dataUrlParam} requires a {urlParam} parameter in a form "{formLink}"',values:{dataUrlParam:'"data.url"',urlParam:'"url"',formLink:"https://example.org/path/subpath"}}));const i=t.query;i?a+=(a.includes("?")?"&":"?")+k.a.param(i):this._onWarning(p.i18n.translate("visTypeVega.urlParser.urlShouldHaveQuerySubObjectWarningMessage",{defaultMessage:"Using a {urlObject} should have a {subObjectName} sub-object",values:{urlObject:'"url": {"%type%": "url", "url": ...}',subObjectName:'"query"'}})),e.url=a}populateData(){}}const N=Object(f.euiPaletteColorBlind)()[0],U={left:"row-reverse",right:"row",top:"column-reverse",bottom:"column"};class vega_parser_VegaParser{constructor(e,t,a,i,s){r()(this,"spec",void 0),r()(this,"hideWarnings",void 0),r()(this,"restoreSignalValuesOnRefresh",void 0),r()(this,"error",void 0),r()(this,"warnings",void 0),r()(this,"_urlParsers",void 0),r()(this,"isVegaLite",void 0),r()(this,"useHover",void 0),r()(this,"_config",void 0),r()(this,"useMap",void 0),r()(this,"renderer",void 0),r()(this,"tooltips",void 0),r()(this,"mapConfig",void 0),r()(this,"vlspec",void 0),r()(this,"useResize",void 0),r()(this,"containerDir",void 0),r()(this,"controlsDir",void 0),r()(this,"searchAPI",void 0),r()(this,"getServiceSettings",void 0),r()(this,"filters",void 0),r()(this,"timeCache",void 0),this.spec=e,this.hideWarnings=!1,this.error=void 0,this.warnings=[],this.searchAPI=t,this.getServiceSettings=s,this.filters=i,this.timeCache=a}async parseAsync(){try{await this._parseAsync()}catch(e){this.error=j.a.formatErrorToStr(e)}return this}async _parseAsync(){if(void 0!==this.isVegaLite)throw new Error;if("string"==typeof this.spec){const e=h.a.parse(this.spec,{legacyRoot:!1});if(!e.$schema)throw new Error(p.i18n.translate("visTypeVega.vegaParser.inputSpecDoesNotSpecifySchemaErrorMessage",{defaultMessage:"Your specification requires a {schemaParam} field with a valid URL for\nVega (see {vegaSchemaUrl}) or\nVega-Lite (see {vegaLiteSchemaUrl}).\nThe URL is an identifier only. Kibana and your browser will never access this URL.",values:{schemaParam:'"$schema"',vegaLiteSchemaUrl:"https://vega.github.io/vega-lite/docs/spec.html#top-level",vegaSchemaUrl:"https://vega.github.io/vega/docs/specification/#top-level-specification-properties"}}));this.spec=e}if(!n.a.isPlainObject(this.spec))throw new Error(p.i18n.translate("visTypeVega.vegaParser.invalidVegaSpecErrorMessage",{defaultMessage:"Invalid Vega specification"}));this.isVegaLite=this.parseSchema(this.spec).isVegaLite,this.useHover=!this.isVegaLite,this._config=this._parseConfig(),this.hideWarnings=!!this._config.hideWarnings,this._parseBool("restoreSignalValuesOnRefresh",this._config,!1),this.restoreSignalValuesOnRefresh=this._config.restoreSignalValuesOnRefresh,this.useMap="map"===this._config.type,this.renderer="svg"===this._config.renderer?"svg":"canvas",this.tooltips=this._parseTooltips(),this._setDefaultColors(),this._parseControlPlacement(),this.useMap&&(this.mapConfig=this._parseMapConfig(),this.useResize=!1),await this._resolveDataUrls(),this.isVegaLite?this._compileVegaLite():this._compileWithAutosize()}_compileWithAutosize(){const e={type:"fit",contains:"padding"};let t=this.spec.autosize,a=!0;if(this.isVegaLite||!t||"object"!=typeof t||!("signal"in t)){if(t||void 0===t||this._onWarning(p.i18n.translate("visTypeVega.vegaParser.autoSizeDoesNotAllowFalse",{defaultMessage:"{autoSizeParam} is enabled, it can only be disabled by setting {autoSizeParam} to {noneParam}",values:{autoSizeParam:'"autosize"',noneParam:'"none"'}})),"string"==typeof t)a="none"!==t,t={...e,type:t};else if("object"==typeof t){var i,r;t={...e,...t},a=Boolean((null===(i=t)||void 0===i?void 0:i.type)&&"none"!==(null===(r=t)||void 0===r?void 0:r.type))}else t=e;a&&(this.spec.width&&"container"!==this.spec.width||this.spec.height&&"container"!==this.spec.height)&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.widthAndHeightParamsAreIgnored",{defaultMessage:"{widthParam} and {heightParam} params are ignored because {autoSizeParam} is enabled. Set {autoSizeParam}: {noneParam} to disable",values:{widthParam:'"width"',heightParam:'"height"',autoSizeParam:'"autosize"',noneParam:'"none"'}})),a&&(this.spec.width="container",this.spec.height="container"),this.spec.autosize=t,this.useResize=a}}_compileVegaLite(){if(!this.useMap){const e=Object(v.compile)(this.spec,{logger:Object(m.logger)(m.None)}).normalized;"mark"in e||"layer"in e?this._compileWithAutosize():(this.useResize=!1,e.autosize&&"string"!=typeof e.autosize&&"none"===e.autosize.type&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.widthAndHeightParamsAreRequired",{defaultMessage:"Nothing is rendered when {autoSizeParam} is set to {noneParam} while using faceted or repeated {vegaLiteParam} specs. To fix, remove {autoSizeParam} or use {vegaParam}.",values:{autoSizeParam:'"autosize"',noneParam:'"none"',vegaLiteParam:"Vega-Lite",vegaParam:"Vega"}})))}this.vlspec=this.spec;const e=Object(m.logger)(m.Warn);if(e.warn=this._onWarning.bind(this),this.spec=Object(v.compile)(this.vlspec,{logger:e}).spec,this.useMap){if(!this.spec||!this.vlspec)return;const e=n.a.isPlainObject(this.vlspec.config);if(void 0===this.vlspec.config||e&&!this.vlspec.config.projection){if(!Array.isArray(this.spec.projections)||1!==this.spec.projections.length||"projection"!==this.spec.projections[0].name)throw new Error(p.i18n.translate("visTypeVega.vegaParser.VLCompilerShouldHaveGeneratedSingleProtectionObjectErrorMessage",{defaultMessage:"Internal error: Vega-Lite compiler should have generated a single projection object"}));delete this.spec.projections}this.vlspec.width||delete this.spec.width,this.vlspec.height||delete this.spec.height,this.vlspec.padding||void 0!==this.vlspec.config&&(!e||this.vlspec.config.padding)||delete this.spec.padding,this.vlspec.autosize||void 0!==this.vlspec.config&&(!e||this.vlspec.config.autosize)||delete this.spec.autosize}}_parseControlPlacement(){var e,t;if(this.containerDir=null!==(e=this._config)&&void 0!==e&&e.controlsLocation?U[this._config.controlsLocation]:void 0,void 0===this.containerDir){if(!this._config||void 0!==this._config.controlsLocation)throw new Error(p.i18n.translate("visTypeVega.vegaParser.unrecognizedControlsLocationValueErrorMessage",{defaultMessage:"Unrecognized {controlsLocationParam} value. Expecting one of [{locToDirMap}]",values:{locToDirMap:`"${Object.keys(U).join('", "')}"`,controlsLocationParam:"controlsLocation"}}));this.containerDir="column"}const a=null===(t=this._config)||void 0===t?void 0:t.controlsDirection;if(void 0!==a&&"horizontal"!==a&&"vertical"!==a)throw new Error(p.i18n.translate("visTypeVega.vegaParser.unrecognizedDirValueErrorMessage",{defaultMessage:"Unrecognized {dirParam} value. Expecting one of [{expectedValues}]",values:{expectedValues:'"horizontal", "vertical"',dirParam:"dir"}}));this.controlsDir="horizontal"===a?"row":"column"}_parseConfig(){let e=null;if(this.spec){if(void 0!==this.spec._hostConfig){if(e=this.spec._hostConfig,delete this.spec._hostConfig,!n.a.isPlainObject(e))throw new Error(p.i18n.translate("visTypeVega.vegaParser.hostConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:'"_hostConfig"'}}));this._onWarning(p.i18n.translate("visTypeVega.vegaParser.hostConfigIsDeprecatedWarningMessage",{defaultMessage:"{deprecatedConfigName} has been deprecated. Use {newConfigName} instead.",values:{deprecatedConfigName:'"_hostConfig"',newConfigName:"config.kibana"}}))}if(n.a.isPlainObject(this.spec.config)&&void 0!==this.spec.config.kibana&&(e=this.spec.config.kibana,delete this.spec.config.kibana,!n.a.isPlainObject(e)))throw new Error(p.i18n.translate("visTypeVega.vegaParser.kibanaConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:"config.kibana"}}))}return e||{}}_parseTooltips(){var e;if(this._config&&!1===this._config.tooltips)return!1;const t=(null===(e=this._config)||void 0===e?void 0:e.tooltips)||{};if(void 0===t.position)t.position="top";else if(-1===["top","right","bottom","left"].indexOf(t.position))throw new Error(p.i18n.translate("visTypeVega.vegaParser.unexpectedValueForPositionConfigurationErrorMessage",{defaultMessage:"Unexpected value for the {configurationName} configuration",values:{configurationName:"result.position"}}));if(void 0===t.padding)t.padding=16;else if("number"!=typeof t.padding)throw new Error(p.i18n.translate("visTypeVega.vegaParser.paddingConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a number",values:{configName:"config.kibana.result.padding"}}));if(void 0===t.textTruncate)t.textTruncate=!1;else if("boolean"!=typeof t.textTruncate)throw new Error(p.i18n.translate("visTypeVega.vegaParser.textTruncateConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a boolean",values:{configName:"textTruncate"}}));if(void 0===t.centerOnMark)t.centerOnMark=50;else if("boolean"==typeof t.centerOnMark)t.centerOnMark=t.centerOnMark?Number.MAX_VALUE:-1;else if("number"!=typeof t.centerOnMark)throw new Error(p.i18n.translate("visTypeVega.vegaParser.centerOnMarkConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be {trueValue}, {falseValue}, or a number",values:{configName:"config.kibana.result.centerOnMark",trueValue:"true",falseValue:"false"}}));return t}_parseMapConfig(){var e,t;const a={delayRepaint:void 0===(null===(e=this._config)||void 0===e?void 0:e.delayRepaint)||this._config.delayRepaint},i=(e,t)=>{const i=this._config?this._config[e]:void 0;if(void 0!==i){const r=parseFloat(i);if(Number.isFinite(r)&&(!t||r>=0&&r<=30))return void(a[e]=r);this._onWarning(p.i18n.translate("visTypeVega.vegaParser.someKibanaConfigurationIsNoValidWarningMessage",{defaultMessage:"{configName} is not valid",values:{configName:`config.kibana.${e}`}}))}t||(a[e]=0)};var r;(i("latitude",!1),i("longitude",!1),i("zoom",!0),i("minZoom",!0),i("maxZoom",!0),this._parseBool("mapStyle",a,!0),a.mapStyle)&&(a.emsTileServiceId=null===(r=this._config)||void 0===r?void 0:r.emsTileServiceId);this._parseBool("zoomControl",a,!0),this._parseBool("scrollWheelZoom",a,!1);const s=null===(t=this._config)||void 0===t?void 0:t.maxBounds;return void 0!==s&&(Array.isArray(s)&&4===s.length&&s.every((e=>"number"==typeof e&&Number.isFinite(e)))?a.maxBounds=s:this._onWarning(p.i18n.translate("visTypeVega.vegaParser.maxBoundsValueTypeWarningMessage",{defaultMessage:"{maxBoundsConfigName} must be an array with four numbers",values:{maxBoundsConfigName:"config.kibana.maxBounds"}}))),a}_parseBool(e,t,a){const i=this._config?this._config[e]:void 0;void 0===i?t[e]=a:"boolean"!=typeof i?(this._onWarning(p.i18n.translate("visTypeVega.vegaParser.someKibanaParamValueTypeWarningMessage",{defaultMessage:"{configName} must be a boolean value",values:{configName:`config.kibana.${e}`}})),t[e]=a):t[e]=i}parseSchema(e){try{const t=l()(e.$schema),a="vega-lite"===t.library,i=a?v.version:m.version;return c()(t.version,i)>0&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.notValidLibraryVersionForInputSpecWarningMessage",{defaultMessage:"The input spec uses {schemaLibrary} {schemaVersion}, but current version of {schemaLibrary} is {libraryVersion}.",values:{schemaLibrary:t.library,schemaVersion:t.version,libraryVersion:i}})),{isVegaLite:a,libVersion:i}}catch(e){throw Error(p.i18n.translate("visTypeVega.vegaParser.notValidSchemaForInputSpec",{defaultMessage:'The URL for the JSON "$schema" is incorrect. Correct the URL, then click Update.'}))}}async _resolveDataUrls(){if(!this._urlParsers){const e=await this.getServiceSettings(),t=this._onWarning.bind(this);this._urlParsers={elasticsearch:new es_query_parser_EsQueryParser(this.timeCache,this.searchAPI,this.filters,t),emsfile:new ems_file_parser_EmsFileParser(e),url:new url_parser_UrlParser(t)}}const e={};this.searchAPI.resetSearchStats(),this._findObjectDataUrls(this.spec,(t=>{const a=t.url;delete t.url;let i=a["%type%"];delete a["%type%"],void 0===i&&(i="elasticsearch");const r=this._urlParsers[i];if(void 0===r)throw new Error(p.i18n.translate("visTypeVega.vegaParser.notSupportedUrlTypeErrorMessage",{defaultMessage:"{urlObject} is not supported",values:{urlObject:'url: {"%type%": "${type}"}'}}));let s=e[i];void 0===s&&(e[i]=s=[]),s.push(r.parseUrl(t,a))}));const t=Object.keys(e);t.length>0&&await Promise.all(t.map((t=>this._urlParsers[t].populateData(e[t]))))}_findObjectDataUrls(e,t,a){if(Array.isArray(e))for(const i of e)this._findObjectDataUrls(i,t,a);else if(n.a.isPlainObject(e))if("data"===a&&n.a.isPlainObject(e.url)){if(void 0!==e.values||void 0!==e.source)throw new Error(p.i18n.translate("visTypeVega.vegaParser.dataExceedsSomeParamsUseTimesLimitErrorMessage",{defaultMessage:"Data must not have more than one of {urlParam}, {valuesParam}, and {sourceParam}",values:{urlParam:'"url"',valuesParam:'"values"',sourceParam:'"source"'}}));t(e)}else if("data"===a&&"string"==typeof e.url){const t=this.timeCache.getTimeBounds();e.url=e.url.replaceAll("%timefilter_min%",t.min.toString()).replaceAll("%timefilter_max%",t.max.toString())}else for(const a of Object.keys(e))this._findObjectDataUrls(e[a],t,a)}_setDefaultColors(){var e;(this._setDefaultValue({scheme:"elastic"},"config","range","category"),this.isVegaLite)?this._setDefaultValue(N,"config","mark","color"):(null===(e=this.spec)||void 0===e||!e.config.mark||void 0===this.spec.config.mark.color&&void 0===this.spec.config.mark.fill)&&(this._setDefaultValue(N,"config","arc","fill"),this._setDefaultValue(N,"config","area","fill"),this._setDefaultValue(N,"config","line","stroke"),this._setDefaultValue(N,"config","path","stroke"),this._setDefaultValue(N,"config","rect","fill"),this._setDefaultValue(N,"config","rule","stroke"),this._setDefaultValue(N,"config","shape","stroke"),this._setDefaultValue(N,"config","symbol","fill"),this._setDefaultValue(N,"config","trail","fill"));this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","title","color"),this._setDefaultValue(d.euiThemeVars.euiColorDarkShade,"config","style","guide-label","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","guide-title","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","group-title","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","group-subtitle","fill"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","tickColor"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","domainColor"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","gridColor"),this._setDefaultValue("transparent","config","background")}_setDefaultValue(e,...t){let a=this.spec;for(let e=0;e<t.length-1;e++){const i=t[e],r=a[i];if(void 0===r)a[i]={};else if(!n.a.isPlainObject(r))return;a=a[i]}const i=t[t.length-1];void 0===a[i]&&(a[i]=e)}_onWarning(...e){if(!this.hideWarnings)return this.warnings.push(j.a.formatWarningToStr(e)),j.a.formatWarningToStr(e)}}}}]);