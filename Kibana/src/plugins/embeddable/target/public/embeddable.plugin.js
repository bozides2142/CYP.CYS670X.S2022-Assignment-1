!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t,n){e.exports=n(23)(2)},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));const i=(e,t)=>t,a=e=>({state:e,references:[]}),o=(e,t)=>e,r={}},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,a,o;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(a=i;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=i;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=i;0!=a--;){var r=o[a];if(!e(t[r],n[r]))return!1}return!0}return t!=t&&n!=n}},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return d.a}));var i=n(7);const a=e=>t=>{const n=t.enhancements||{},a=e.getEmbeddableFactory(t.type),o=Object(i.b)(t);let r=o.state;const s=o.references;if(a){const e=a.extract(t);r=e.state,s.push(...e.references)}return r.enhancements={},Object.keys(n).forEach((t=>{if(!n[t])return;const i=e.getEnhancement(t).extract(n[t]);s.push(...i.references),r.enhancements[t]=i.state})),{state:r,references:s}},o=e=>(t,n)=>{const a=t.enhancements||{},o=e.getEmbeddableFactory(t.type);let r=Object(i.c)(t,n);return o&&(r=o.inject(r,n)),r.enhancements={},Object.keys(a).forEach((t=>{a[t]&&(r.enhancements[t]=e.getEnhancement(t).inject(a[t],n))})),r},r=e=>{const t=(n,a)=>{const o=n.enhancements||{},r=e.getEmbeddableFactory(n.type);let s=i.a[a]?i.a[a](n):n;const d="function"==typeof(null==r?void 0:r.migrations)?null==r?void 0:r.migrations():(null==r?void 0:r.migrations)||{};return d[a]&&(s=d[a](s)),null!=r&&r.isContainerType&&(s.panels=(n.panels||[]).map((e=>t(e,a)))),s.enhancements={},Object.keys(o).forEach((t=>{if(!o[t])return;const n=e.getEnhancement(t),i="function"==typeof(null==n?void 0:n.migrations)?null==n?void 0:n.migrations():(null==n?void 0:n.migrations)||{},r=i[a]?i[a](o[t]):o[t];s.enhancements[t]=r})),s};return t},s=e=>(t,n={})=>{const a=t.enhancements||{},o=e.getEmbeddableFactory(t.type);let r=Object(i.d)(t,n);return o&&(r=o.telemetry(t,r)),Object.keys(a).map((t=>{a[t]&&(r=e.getEnhancement(t).telemetry(a[t],r))})),r};var d=n(15)},function(e,t,n){"use strict";let i;n.d(t,"a",(function(){return i})),function(e){e.EDIT="edit",e.PREVIEW="preview",e.PRINT="print",e.VIEW="view"}(i||(i={}))},function(e,t,n){"use strict";function i(e){return Boolean(e.savedObjectId)}n.d(t,"a",(function(){return i}))},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/savedObjects/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){e.exports=n(23)(3)},function(e,t,n){"use strict";var i=n(26);n.o(i,"IncompatibleActionError")&&n.d(t,"IncompatibleActionError",(function(){return i.IncompatibleActionError})),n.o(i,"buildContextMenuForActions")&&n.d(t,"buildContextMenuForActions",(function(){return i.buildContextMenuForActions}))},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,n){"use strict";var i,a=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function s(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function d(e,t){for(var n={},i=[],a=0;a<e.length;a++){var o=e[a],d=t.base?o[0]+t.base:o[0],l=n[d]||0,c="".concat(d," ").concat(l);n[d]=l+1;var u=s(c),p={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(r[u].references++,r[u].updater(p)):r.push({identifier:c,updater:g(p,t),references:1}),i.push(c)}return i}function l(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var a=n.nc;a&&(i.nonce=a)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var r=o(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var c,u=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function p(e,t,n,i){var a=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=u(t,a);else{var o=document.createTextNode(a),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function b(e,t,n){var i=n.css,a=n.media,o=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var h=null,m=0;function g(e,t){var n,i,a;if(t.singleton){var o=m++;n=h||(h=l(t)),i=p.bind(null,n,o,!1),a=p.bind(null,n,o,!0)}else n=l(t),i=b.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=d(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var a=s(n[i]);r[a].references--}for(var o=d(e,t),l=0;l<n.length;l++){var c=s(n[l]);0===r[c].references&&(r[c].updater(),r.splice(c,1))}n=o}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var a=(r=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),d="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(d," */")),o=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[n].concat(o).concat([a]).join("\n")}var r,s,d;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(i)for(var o=0;o<this.length;o++){var r=this[o][0];null!=r&&(a[r]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);i&&a[d[0]]||(n&&(d[2]?d[2]="".concat(n," and ").concat(d[2]):d[2]=n),t.push(d))}},t}},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,a=n;return[a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]]].join("")}},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){var i=n(37),a=n(38),o=a;o.v1=i,o.v4=a,e.exports=o},function(e,t){e.exports=__kbnSharedDeps__.KbnAnalytics},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n(31),__kbnBundles__.define("plugin/embeddable/public",n,40),__kbnBundles__.define("plugin/embeddable/common",n,39)},function(e,t,n){n.p=window.__kbnPublicPath__.embeddable},function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(33);case"v8light":return n(35)}},function(e,t,n){var i=n(21),a=n(34);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1};i(a,o);e.exports=a.locals||{}},function(e,t,n){(t=n(22)(!1)).push([e.i,".embPanel{z-index:auto;flex:1;display:flex;flex-direction:column;height:100%;min-height:26px;position:relative}.embPanel-isLoading{justify-content:center;align-items:center}.embPanel .embPanel__content{display:flex;flex:1 1 100%;z-index:1;min-height:0}.embPanel .embPanel__content--fullWidth{width:100%}.embPanel__header{flex:0 0 auto;display:flex;justify-content:flex-end}.embPanel__title{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;color:#DFE5EF;font-size:12px;font-size:.85714rem;line-height:1.14286rem;font-weight:700;overflow:hidden;line-height:1.5;flex-grow:1;display:flex;flex-wrap:wrap;align-items:center}.embPanel__title:not(:empty){line-height:24px;padding-left:8px}.embPanel__title .embPanel__titleInner{overflow:hidden;display:flex;align-items:center;padding-right:8px}.embPanel__title .embPanel__titleTooltipAnchor{max-width:100%}.embPanel__title .embPanel__titleText{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important;font-weight:700}.embPanel__title .embPanel__placeholderTitleText{color:#535966;font-weight:400}.embPanel__dragger:not(.embPanel__title){flex-grow:1}.embPanel__header--floater{position:absolute;right:0;top:0;left:0;z-index:1000}.embPanel__optionsMenuButton{background-color:rgba(212,218,229,0.1);border-bottom-right-radius:0;border-top-left-radius:0}.embPanel__optionsMenuButton:focus{background-color:rgba(54,162,239,0.2)}.embPanel .embPanel__optionsMenuButton{opacity:0}.embPanel .embPanel__optionsMenuButton:focus{opacity:1}.embPanel:hover .embPanel__optionsMenuButton{opacity:1}.embPanel--editing{border-style:dashed !important;border-color:#535966 !important;transition:all 150ms cubic-bezier(0.694, 0.0482, 0.335, 1);border-width:1px}.embPanel--editing:hover,.embPanel--editing:focus{box-shadow:0 1px 5px rgba(0,0,0,0.25),0 3.6px 13px rgba(0,0,0,0.175),0 8.4px 23px rgba(0,0,0,0.15),0 23px 35px rgba(0,0,0,0.125)}.embPanel--editing .embPanel__dragger{transition:background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.embPanel--editing .embPanel__dragger:hover{background-color:rgba(243,211,113,0.3);cursor:move}.embPanel--editing .embPanel__optionsMenuButton{opacity:1}.embPanel--loading .embPanel__title{color:#7a7f89}.embPanel__error{text-align:center;justify-content:center;flex-direction:column;overflow:auto;padding:8px}.embPanel__label{position:absolute;padding-left:8px;z-index:1000}.embPanel__optionsMenuForm{padding:16px}\n",""]),e.exports=t},function(e,t,n){var i=n(21),a=n(36);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1};i(a,o);e.exports=a.locals||{}},function(e,t,n){(t=n(22)(!1)).push([e.i,".embPanel{z-index:auto;flex:1;display:flex;flex-direction:column;height:100%;min-height:26px;position:relative}.embPanel-isLoading{justify-content:center;align-items:center}.embPanel .embPanel__content{display:flex;flex:1 1 100%;z-index:1;min-height:0}.embPanel .embPanel__content--fullWidth{width:100%}.embPanel__header{flex:0 0 auto;display:flex;justify-content:flex-end}.embPanel__title{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;color:#1a1c21;font-size:12px;font-size:.85714rem;line-height:1.14286rem;font-weight:700;overflow:hidden;line-height:1.5;flex-grow:1;display:flex;flex-wrap:wrap;align-items:center}.embPanel__title:not(:empty){line-height:24px;padding-left:8px}.embPanel__title .embPanel__titleInner{overflow:hidden;display:flex;align-items:center;padding-right:8px}.embPanel__title .embPanel__titleTooltipAnchor{max-width:100%}.embPanel__title .embPanel__titleText{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important;font-weight:700}.embPanel__title .embPanel__placeholderTitleText{color:#98A2B3;font-weight:400}.embPanel__dragger:not(.embPanel__title){flex-grow:1}.embPanel__header--floater{position:absolute;right:0;top:0;left:0;z-index:1000}.embPanel__optionsMenuButton{background-color:rgba(52,55,65,0.1);border-bottom-right-radius:0;border-top-left-radius:0}.embPanel__optionsMenuButton:focus{background-color:rgba(0,119,204,0.1)}.embPanel .embPanel__optionsMenuButton{opacity:0}.embPanel .embPanel__optionsMenuButton:focus{opacity:1}.embPanel:hover .embPanel__optionsMenuButton{opacity:1}.embPanel--editing{border-style:dashed !important;border-color:#98A2B3 !important;transition:all 150ms cubic-bezier(0.694, 0.0482, 0.335, 1);border-width:1px}.embPanel--editing:hover,.embPanel--editing:focus{box-shadow:0 1px 5px rgba(0,0,0,0.1),0 3.6px 13px rgba(0,0,0,0.07),0 8.4px 23px rgba(0,0,0,0.06),0 23px 35px rgba(0,0,0,0.05)}.embPanel--editing .embPanel__dragger{transition:background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.embPanel--editing .embPanel__dragger:hover{background-color:rgba(254,197,20,0.1);cursor:move}.embPanel--editing .embPanel__optionsMenuButton{opacity:1}.embPanel--loading .embPanel__title{color:#69707D}.embPanel__error{text-align:center;justify-content:center;flex-direction:column;overflow:auto;padding:8px}.embPanel__label{position:absolute;padding-left:8px;z-index:1000}.embPanel__optionsMenuForm{padding:16px}\n",""]),e.exports=t},function(e,t,n){var i,a,o=n(24),r=n(25),s=0,d=0;e.exports=function(e,t,n){var l=t&&n||0,c=t||[],u=(e=e||{}).node||i,p=void 0!==e.clockseq?e.clockseq:a;if(null==u||null==p){var b=o();null==u&&(u=i=[1|b[0],b[1],b[2],b[3],b[4],b[5]]),null==p&&(p=a=16383&(b[6]<<8|b[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:d+1,g=h-s+(m-d)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||h>s)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=h,d=m,a=p;var f=(1e4*(268435455&(h+=122192928e5))+m)%4294967296;c[l++]=f>>>24&255,c[l++]=f>>>16&255,c[l++]=f>>>8&255,c[l++]=255&f;var v=h/4294967296*1e4&268435455;c[l++]=v>>>8&255,c[l++]=255&v,c[l++]=v>>>24&15|16,c[l++]=v>>>16&255,c[l++]=p>>>8|128,c[l++]=255&p;for(var _=0;_<6;++_)c[l+_]=u[_];return t||r(c)}},function(e,t,n){var i=n(24),a=n(25);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[o+s]=r[s];return t||a(r)}},function(e,t,n){"use strict";n.r(t);var i=n(14);n.d(t,"ViewMode",(function(){return i.a}));var a=n(13);n.d(t,"isSavedObjectEmbeddableInput",(function(){return a.e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"ACTION_ADD_PANEL",(function(){return ce})),n.d(t,"ACTION_EDIT_PANEL",(function(){return L})),n.d(t,"AddPanelAction",(function(){return add_panel_action_AddPanelAction})),n.d(t,"isReferenceOrValueEmbeddable",(function(){return Ee})),n.d(t,"Container",(function(){return container_Container})),n.d(t,"CONTEXT_MENU_TRIGGER",(function(){return B})),n.d(t,"contextMenuTrigger",(function(){return z})),n.d(t,"defaultEmbeddableFactoryProvider",(function(){return E})),n.d(t,"EditPanelAction",(function(){return edit_panel_action_EditPanelAction})),n.d(t,"Embeddable",(function(){return embeddable_Embeddable})),n.d(t,"EmbeddableChildPanel",(function(){return embeddable_child_panel_EmbeddableChildPanel})),n.d(t,"EmbeddableFactoryNotFoundError",(function(){return errors_EmbeddableFactoryNotFoundError})),n.d(t,"EmbeddablePanel",(function(){return embeddable_panel_EmbeddablePanel})),n.d(t,"EmbeddableRoot",(function(){return embeddable_root_EmbeddableRoot})),n.d(t,"ErrorEmbeddable",(function(){return error_embeddable_ErrorEmbeddable})),n.d(t,"isEmbeddable",(function(){return c})),n.d(t,"isErrorEmbeddable",(function(){return M})),n.d(t,"openAddPanelFlyout",(function(){return le})),n.d(t,"PANEL_BADGE_TRIGGER",(function(){return $})),n.d(t,"panelBadgeTrigger",(function(){return U})),n.d(t,"PANEL_NOTIFICATION_TRIGGER",(function(){return G})),n.d(t,"panelNotificationTrigger",(function(){return V})),n.d(t,"PanelNotFoundError",(function(){return errors_PanelNotFoundError})),n.d(t,"SELECT_RANGE_TRIGGER",(function(){return W})),n.d(t,"VALUE_CLICK_TRIGGER",(function(){return q})),n.d(t,"ViewMode",(function(){return g.a})),n.d(t,"withEmbeddableSubscription",(function(){return S})),n.d(t,"genericEmbeddableInputIsEqual",(function(){return y})),n.d(t,"omitGenericEmbeddableInput",(function(){return _})),n.d(t,"isSavedObjectEmbeddableInput",(function(){return N.a})),n.d(t,"isRangeSelectTriggerContext",(function(){return J})),n.d(t,"isValueClickTriggerContext",(function(){return Y})),n.d(t,"isRowClickTriggerContext",(function(){return X})),n.d(t,"isContextMenuTriggerContext",(function(){return Z})),n.d(t,"EmbeddableStateTransfer",(function(){return embeddable_state_transfer_EmbeddableStateTransfer})),n.d(t,"EmbeddableRenderer",(function(){return k})),n.d(t,"useEmbeddableFactory",(function(){return R})),n.d(t,"AttributeService",(function(){return attribute_service_AttributeService})),n.d(t,"ATTRIBUTE_SERVICE_KEY",(function(){return Pe})),n.d(t,"plugin",(function(){return we}));n(32);var i=n(0),a=n.n(i),o=n(4),r=n.n(o),s=n(5),d=n(17),l=n(3);class errors_PanelNotFoundError extends Error{constructor(){super(l.i18n.translate("embeddableApi.errors.paneldoesNotExist",{defaultMessage:"Panel not found"})),a()(this,"code","PANEL_NOT_FOUND")}}class errors_EmbeddableFactoryNotFoundError extends Error{constructor(e){super(l.i18n.translate("embeddableApi.errors.embeddableFactoryNotFound",{defaultMessage:"{type} can't be loaded. Please upgrade to the default distribution of Elasticsearch and Kibana with the appropriate license.",values:{type:e}})),a()(this,"code","EMBEDDABLE_FACTORY_NOT_FOUND")}}const c=e=>!!e&&("object"==typeof e&&("string"==typeof e.id&&("function"==typeof e.getInput&&"function"==typeof e.supportedTriggers)));var u=n(10),p=n.n(u),b=n(6),h=n(8),m=n(16),g=n(14);const f=["lastReloadRequestTime","executionContext","searchSessionId","hidePanelTitles","disabledActions","disableTriggers","enhancements","syncColors","viewMode","title","id"],v=["hidePanelTitles","disabledActions","disableTriggers","enhancements","syncColors","title","id"],_=e=>Object(s.omit)(e,f),y=(e,t)=>{const{title:n,hidePanelTitles:i,...a}=Object(s.pick)(e,v),{title:o,hidePanelTitles:r,...d}=Object(s.pick)(t,v);return n===o&&(Boolean(i)===Boolean(r)&&!!p()(a,d))};function x(e,t){return e.hidePanelTitles?"":void 0===e.title?t.defaultTitle:e.title}class embeddable_Embeddable{constructor(e,t,n){a()(this,"runtimeId",embeddable_Embeddable.runtimeId++),a()(this,"parent",void 0),a()(this,"isContainer",!1),a()(this,"deferEmbeddableLoad",!1),a()(this,"type",void 0),a()(this,"id",void 0),a()(this,"fatalError",void 0),a()(this,"output",void 0),a()(this,"input",void 0),a()(this,"input$",void 0),a()(this,"output$",void 0),a()(this,"renderComplete",new m.RenderCompleteDispatcher),a()(this,"parentSubscription",void 0),a()(this,"destroyed",!1),this.id=e.id,this.output={title:x(e,t),...t},this.input={viewMode:g.a.EDIT,...e},this.parent=n,this.input$=new b.BehaviorSubject(this.input),this.output$=new b.BehaviorSubject(this.output),n&&(this.parentSubscription=b.merge(n.getInput$(),n.getOutput$()).subscribe((()=>{if(!n.getInput().panels[this.id])return;const e=n.getInputForChild(this.id);this.onResetInput(e)}))),this.getOutput$().pipe(Object(h.map)((({title:e})=>e||"")),Object(h.distinctUntilChanged)()).subscribe((e=>{this.renderComplete.setTitle(e)}),(()=>{}))}getIsContainer(){return!0===this.isContainer}getUpdated$(){return Object(b.merge)(this.getInput$().pipe(Object(h.skip)(1)),this.getOutput$().pipe(Object(h.skip)(1))).pipe(Object(h.debounceTime)(0))}getInput$(){return this.input$.asObservable()}getOutput$(){return this.output$.asObservable()}getOutput(){return this.output}async getExplicitInputIsEqual(e){const t=this.getExplicitInput();return y(e,t)&&p()(_(e),_(t))}getExplicitInput(){const e=this.getRoot();var t,n,i;return e.getIsContainer()&&null!==(t=null===(n=e.getInput().panels)||void 0===n||null===(i=n[this.id])||void 0===i?void 0:i.explicitInput)&&void 0!==t?t:this.getInput()}getPersistableInput(){return this.getExplicitInput()}getInput(){return this.input}getTitle(){return this.output.title||""}getRoot(){let e=this;for(;e.parent;)e=e.parent;return e}updateInput(e){if(this.destroyed)throw new Error("Embeddable has been destroyed");this.parent?this.parent.updateInputForChild(this.id,e):this.onInputChanged(e)}render(e){if(this.renderComplete.setEl(e),this.renderComplete.setTitle(this.output.title||""),this.destroyed)throw new Error("Embeddable has been destroyed")}getInspectorAdapters(){}destroy(){this.destroyed=!0,this.input$.complete(),this.output$.complete(),this.parentSubscription&&this.parentSubscription.unsubscribe()}setInitializationFinished(){var e;this.deferEmbeddableLoad&&null!==(e=this.parent)&&void 0!==e&&e.isContainer&&this.parent.setChildLoaded(this)}updateOutput(e){const t={...this.output,...e};p()(this.output,t)||(this.output=t,this.output$.next(this.output))}onFatalError(e){var t;this.fatalError=e,this.output$.error(e),this.deferEmbeddableLoad&&null!==(t=this.parent)&&void 0!==t&&t.isContainer&&this.parent.setChildLoaded(this)}onResetInput(e){if(!p()(this.input,e)){const t=this.input.lastReloadRequestTime;this.input=e,this.input$.next(e),this.updateOutput({title:x(this.input,this.output)}),t!==e.lastReloadRequestTime&&this.reload()}}onInputChanged(e){const t=Object(s.cloneDeep)({...this.input,...e});this.onResetInput(t)}supportedTriggers(){return[]}}a()(embeddable_Embeddable,"runtimeId",0);const E=e=>{var t;return{isContainerType:null!==(t=e.isContainerType)&&void 0!==t&&t,canCreateNew:e.canCreateNew?e.canCreateNew.bind(e):()=>!0,getDefaultInput:e.getDefaultInput?e.getDefaultInput.bind(e):()=>({}),getExplicitInput:e.getExplicitInput?e.getExplicitInput.bind(e):()=>Promise.resolve({}),createFromSavedObject:e.createFromSavedObject?e.createFromSavedObject.bind(e):(t,n,i)=>{throw new Error(`Creation from saved object not supported by type ${e.type}`)},create:e.create.bind(e),type:e.type,isEditable:e.isEditable.bind(e),getDisplayName:e.getDisplayName.bind(e),getDescription:e.getDescription?e.getDescription.bind(e):()=>"",getIconType:e.getIconType?e.getIconType.bind(e):()=>"empty",savedObjectMetaData:e.savedObjectMetaData,telemetry:e.telemetry||(()=>({})),inject:e.inject||(e=>e),extract:e.extract||(e=>({state:e,references:[]})),migrations:e.migrations||{},grouping:e.grouping}};var j=n(2),P=n(20),O=n.n(P),T=n(9);const[w,I]=Object(m.createGetterSetter)("Theme");var A=n(1);function M(e){return Boolean(e.fatalError||void 0!==e.error)}class error_embeddable_ErrorEmbeddable extends embeddable_Embeddable{constructor(e,t,n){super(t,{},n),a()(this,"type","error"),a()(this,"error",void 0),a()(this,"dom",void 0),this.error=e}reload(){}render(e){const t="string"==typeof this.error?this.error:this.error.message;let n;this.dom=e;try{n=w()}catch(e){n={}}const i=Object(A.jsx)("div",{className:"embPanel__error embPanel__content","data-test-subj":"embeddableStackError"},Object(A.jsx)(j.EuiText,{color:"subdued",size:"xs"},Object(A.jsx)(j.EuiIcon,{type:"alert",color:"danger"}),Object(A.jsx)(j.EuiSpacer,{size:"s"}),Object(A.jsx)(T.Markdown,{markdown:t,openLinksInNewTab:!0,"data-test-subj":"errorMessageMarkdown"}))),a=n&&n.theme$?Object(A.jsx)(T.KibanaThemeProvider,{theme$:n.theme$},i):i;O.a.render(a,e)}destroy(){this.dom&&O.a.unmountComponentAtNode(this.dom)}}var C=n(18),F=n.n(C);const S=e=>class WithEmbeddableSubscription extends r.a.Component{constructor(e){super(e),a()(this,"subscription",void 0),a()(this,"mounted",!1),this.state={input:this.props.embeddable.getInput(),output:this.props.embeddable.getOutput()}}componentDidMount(){this.mounted=!0,this.subscription=b.merge(this.props.embeddable.getOutput$(),this.props.embeddable.getInput$()).subscribe((()=>{this.mounted&&this.setState({input:this.props.embeddable.getInput(),output:this.props.embeddable.getOutput()})}))}componentWillUnmount(){this.mounted=!1,this.subscription&&this.subscription.unsubscribe()}render(){return Object(A.jsx)(e,F()({input:this.state.input,output:this.state.output},this.props))}};class embeddable_root_EmbeddableRoot extends r.a.Component{constructor(e){super(e),a()(this,"root",void 0),a()(this,"alreadyMounted",!1),this.root=r.a.createRef()}componentDidMount(){this.root&&this.root.current&&this.props.embeddable&&(this.alreadyMounted=!0,this.props.embeddable.render(this.root.current))}componentDidUpdate(e){let t=!1;this.root&&this.root.current&&this.props.embeddable&&!this.alreadyMounted&&(this.alreadyMounted=!0,this.props.embeddable.render(this.root.current),t=!0),!t&&this.root&&this.root.current&&this.props.embeddable&&this.alreadyMounted&&this.props.input&&(null==e?void 0:e.input)!==this.props.input&&this.props.embeddable.updateInput(this.props.input)}shouldComponentUpdate(e){return Boolean(e.error!==this.props.error||e.loading!==this.props.loading||e.embeddable!==this.props.embeddable||this.root&&this.root.current&&e.embeddable&&!this.alreadyMounted||e.input!==this.props.input)}render(){return Object(A.jsx)(r.a.Fragment,null,Object(A.jsx)("div",{ref:this.root}),this.props.loading&&Object(A.jsx)(j.EuiLoadingSpinner,{"data-test-subj":"embedSpinner"}),this.props.error&&Object(A.jsx)(j.EuiText,{"data-test-subj":"embedError"},this.props.error))}}var N=n(15);function R({input:e,factory:t,onInputUpdated:n}){const[i,a]=Object(o.useState)(void 0),[s,d]=Object(o.useState)(!1),[l,c]=Object(o.useState)(),u=r.a.useRef(e);return Object(o.useEffect)((()=>{u.current=e}),[e]),Object(o.useEffect)((()=>{let e,n=!1;return a(void 0),d(!0),t.create(u.current).then((t=>{n?t&&t.destroy():(e=t,a(t))})).catch((e=>{n||c(null==e?void 0:e.message)})).finally((()=>{n||d(!1)})),()=>{n=!0,e&&e.destroy()}}),[t]),Object(o.useEffect)((()=>{if(!i)return;if(M(i))return;if(!n)return;const e=i.getInput$().subscribe((e=>{n(e)}));return()=>{e.unsubscribe()}}),[i,n]),[i,s,l]}const k=e=>function(e){return"factory"in e}(e)?Object(A.jsx)(D,e):Object(A.jsx)(embeddable_root_EmbeddableRoot,{embeddable:e.embeddable,input:e.input}),D=({factory:e,input:t,onInputUpdated:n})=>{const[i,a,o]=R({factory:e,input:t,onInputUpdated:n});return Object(A.jsx)(embeddable_root_EmbeddableRoot,{embeddable:i,loading:a,error:o,input:t})},L="editPanel";class edit_panel_action_EditPanelAction{constructor(e,t,n,i){var o;a()(this,"type",L),a()(this,"id",L),a()(this,"order",50),a()(this,"currentAppId",void 0),this.getEmbeddableFactory=e,this.application=t,this.stateTransfer=n,this.getOriginatingPath=i,null!==(o=this.application)&&void 0!==o&&o.currentAppId$&&this.application.currentAppId$.pipe(Object(h.take)(1)).subscribe((e=>this.currentAppId=e))}getDisplayName({embeddable:e}){const t=this.getEmbeddableFactory(e.type);if(!t)throw new errors_EmbeddableFactoryNotFoundError(e.type);return l.i18n.translate("embeddableApi.panel.editPanel.displayName",{defaultMessage:"Edit {value}",values:{value:t.getDisplayName()}})}getIconType(){return"pencil"}async isCompatible({embeddable:e}){const t=Boolean(e&&e.getOutput().editable&&(e.getOutput().editUrl||e.getOutput().editApp&&e.getOutput().editPath)),n=e.getInput().viewMode===g.a.EDIT;return Boolean(t&&n)}async execute(e){const t=this.getAppTarget(e);if(t)return void(this.stateTransfer&&t.state?await this.stateTransfer.navigateToEditor(t.app,{path:t.path,state:t.state}):await this.application.navigateToApp(t.app,{path:t.path}));const n=await this.getHref(e);n&&(window.location.href=n)}getAppTarget({embeddable:e}){const t=e?e.getOutput().editApp:void 0,n=e?e.getOutput().editPath:void 0;if(t&&n){if(this.currentAppId){var i;const a=!e.getInput().savedObjectId,o=null===(i=this.getOriginatingPath)||void 0===i?void 0:i.call(this);return{app:t,path:n,state:{originatingApp:this.currentAppId,valueInput:a?this.getExplicitInput({embeddable:e}):void 0,embeddableId:e.id,searchSessionId:e.getInput().searchSessionId,originatingPath:o}}}return{app:t,path:n}}}async getHref({embeddable:e}){const t=e?e.getOutput().editUrl:void 0;return t||""}getExplicitInput({embeddable:e}){var t,n,i,a,o;return null!==(t=null===(n=e.getRoot())||void 0===n||null===(i=n.getInput())||void 0===i||null===(a=i.panels)||void 0===a||null===(o=a[e.id])||void 0===o?void 0:o.explicitInput)&&void 0!==t?t:e.getInput()}}const B="CONTEXT_MENU_TRIGGER",z={id:B,title:l.i18n.translate("embeddableApi.contextMenuTrigger.title",{defaultMessage:"Context menu"}),description:l.i18n.translate("embeddableApi.contextMenuTrigger.description",{defaultMessage:"A panel top-right corner context menu click."})},$="PANEL_BADGE_TRIGGER",U={id:$,title:l.i18n.translate("embeddableApi.panelBadgeTrigger.title",{defaultMessage:"Panel badges"}),description:l.i18n.translate("embeddableApi.panelBadgeTrigger.description",{defaultMessage:"Actions appear in title bar when an embeddable loads in a panel."})},G="PANEL_NOTIFICATION_TRIGGER",V={id:G,title:l.i18n.translate("embeddableApi.panelNotificationTrigger.title",{defaultMessage:"Panel notifications"}),description:l.i18n.translate("embeddableApi.panelNotificationTrigger.description",{defaultMessage:"Actions appear in top-right corner of a panel."})},W="SELECT_RANGE_TRIGGER",H={id:W,title:l.i18n.translate("embeddableApi.selectRangeTrigger.title",{defaultMessage:"Range selection"}),description:l.i18n.translate("embeddableApi.selectRangeTrigger.description",{defaultMessage:"A range of values on the visualization"})},q="VALUE_CLICK_TRIGGER",K={id:q,title:l.i18n.translate("embeddableApi.valueClickTrigger.title",{defaultMessage:"Single click"}),description:l.i18n.translate("embeddableApi.valueClickTrigger.description",{defaultMessage:"A data point click on the visualization"})},Y=e=>e.data&&"data"in e.data,J=e=>e.data&&"range"in e.data,X=e=>!!e.data&&"object"==typeof e.data&&"number"==typeof e.data.rowIndex,Z=e=>!!e&&"object"==typeof e&&!!e.embeddable&&"object"==typeof e.embeddable;var Q=n(27),ee=n.n(Q);const te=e=>Object.keys(e);class container_Container extends embeddable_Embeddable{constructor(e,t,n,i){super(e,t,i),a()(this,"isContainer",!0),a()(this,"children",{}),a()(this,"subscription",void 0),this.getFactory=n,this.getFactory=n,this.subscription=this.getInput$().pipe(Object(h.startWith)(e),Object(h.pairwise)()).subscribe((([{panels:e},{panels:t}])=>{this.maybeUpdateChildren(t,e)}))}setChildLoaded(e){this.input.panels[e.id]?(this.children[e.id]=e,this.updateOutput({embeddableLoaded:{...this.output.embeddableLoaded,[e.id]:!0}})):e.destroy()}updateInputForChild(e,t){if(!this.input.panels[e])throw new errors_PanelNotFoundError;const n={panels:{...this.input.panels,[e]:{...this.input.panels[e],explicitInput:{...this.input.panels[e].explicitInput,...t}}}};this.updateInput(n)}reload(){Object.values(this.children).forEach((e=>e.reload()))}async addNewEmbeddable(e,t){const n=this.getFactory(e);if(!n)throw new errors_EmbeddableFactoryNotFoundError(e);const i=this.createNewPanelState(n,t);return this.createAndSaveEmbeddable(e,i)}removeEmbeddable(e){const t={...this.input.panels};delete t[e],this.updateInput({panels:t})}getChildIds(){return Object.keys(this.children)}getChild(e){return this.children[e]}getInputForChild(e){const t=this.getInheritedInput(e),n=this.getPanelState(e),i=n.explicitInput,a={};return te(n.explicitInput).forEach((e=>{void 0===i[e]&&void 0!==t[e]||(a[e]=i[e])})),{...t,...a}}destroy(){super.destroy(),Object.values(this.children).forEach((e=>e.destroy())),this.subscription.unsubscribe()}async untilEmbeddableLoaded(e){if(!this.input.panels[e])throw new errors_PanelNotFoundError;return this.output.embeddableLoaded[e]?this.children[e]:new Promise(((t,n)=>{const i=Object(b.merge)(this.getOutput$(),this.getInput$()).subscribe((()=>{this.output.embeddableLoaded[e]&&(i.unsubscribe(),t(this.children[e])),void 0===this.input.panels[e]&&(i.unsubscribe(),t(void 0))}))}))}async getExplicitInputIsEqual(e){const{panels:t,...n}=e,{panels:i,...a}=this.getInput();if(!Object(s.isEqual)(n,a))return!1;const o=Object.keys(t),r=Object.keys(i);if(o.length!==r.length||Object(s.xor)(o,r).length>0)return!1;for(const e of o){const n=await this.untilEmbeddableLoaded(e),i=t[e].explicitInput;if(!M(n)&&!await n.getExplicitInputIsEqual(i))return!1}return!0}createNewPanelState(e,t={}){const n=t.id||ee.a.v4(),i=this.createNewExplicitEmbeddableInput(n,e,t);return{type:e.type,explicitInput:{...i,id:n}}}getPanelState(e){if(void 0===this.input.panels[e])throw new errors_PanelNotFoundError;return this.input.panels[e]}async createAndSaveEmbeddable(e,t){return this.updateInput({panels:{...this.input.panels,[t.explicitInput.id]:t}}),await this.untilEmbeddableLoaded(t.explicitInput.id)}createNewExplicitEmbeddableInput(e,t,n={}){const i=this.getInheritedInput(e),a=t.getDefaultInput(n),o=n;return te(a).forEach((e=>{void 0===i[e]&&void 0===o[e]&&(o[e]=a[e])})),o}onPanelRemoved(e){const t=this.getChild(e);t&&(t.destroy(),delete this.children[e]),this.updateOutput({embeddableLoaded:{...this.output.embeddableLoaded,[e]:void 0}})}async onPanelAdded(e){let t;this.updateOutput({embeddableLoaded:{...this.output.embeddableLoaded,[e.explicitInput.id]:!1}});const n=this.getInputForChild(e.explicitInput.id);try{const i=this.getFactory(e.type);if(!i)throw new errors_EmbeddableFactoryNotFoundError(e.type);t=Object(N.a)(n)?await i.createFromSavedObject(n.savedObjectId,n,this):await i.create(n,this)}catch(n){t=new error_embeddable_ErrorEmbeddable(n,{id:e.explicitInput.id},this)}return t?t.deferEmbeddableLoad||this.setChildLoaded(t):void 0===t&&this.removeEmbeddable(e.explicitInput.id),t}panelHasChanged(e,t){if(e.type!==t.type)return!0}maybeUpdateChildren(e,t){Object.keys({...e,...this.output.embeddableLoaded}).forEach((n=>void 0!==e[n]&&void 0===this.output.embeddableLoaded[n]?this.onPanelAdded(e[n]):void 0===e[n]&&void 0!==this.output.embeddableLoaded[n]?this.onPanelRemoved(n):void(e[n]&&t[n]&&this.panelHasChanged(e[n],t[n])&&(this.onPanelRemoved(n),this.onPanelAdded(e[n])))))}}var ne=n(12),ie=n.n(ne);class embeddable_child_panel_EmbeddableChildPanel extends r.a.Component{constructor(e){super(e),a()(this,"mounted",void 0),a()(this,"embeddable",void 0),a()(this,"subscription",void 0),this.state={loading:!0},this.mounted=!1}async componentDidMount(){this.mounted=!0;const{container:e}=this.props;this.embeddable=await e.untilEmbeddableLoaded(this.props.embeddableId),this.mounted&&this.setState({loading:!1})}componentWillUnmount(){this.mounted=!1,this.subscription&&this.subscription.unsubscribe()}render(){const{PanelComponent:e,index:t}=this.props,n=ie()("embPanel",{"embPanel-isLoading":this.state.loading});return Object(A.jsx)("div",{className:n},this.state.loading||!this.embeddable?Object(A.jsx)(j.EuiLoadingChart,{size:"l",mono:!0}):Object(A.jsx)(e,{embeddable:this.embeddable,index:t}))}}var ae=n(19);const oe="openInspector";class inspect_panel_action_InspectPanelAction{constructor(e){a()(this,"type",oe),a()(this,"id",oe),a()(this,"order",20),this.inspector=e}getDisplayName(){return l.i18n.translate("embeddableApi.panel.inspectPanel.displayName",{defaultMessage:"Inspect"})}getIconType(){return"inspect"}async isCompatible({embeddable:e}){return this.inspector.isAvailable(e.getInspectorAdapters())}async execute({embeddable:e}){const t=e.getInspectorAdapters();if(!await this.isCompatible({embeddable:e})||void 0===t)throw new Error("Action not compatible with context");const n=this.inspector.open(t,{title:e.getTitle(),options:{fileName:e.getTitle()||e.getInput().title||e.getOutput().defaultTitle||l.i18n.translate("embeddableApi.panel.inspectPanel.untitledEmbeddableFilename",{defaultMessage:"untitled"})}}),i=e.destroy;e.destroy=()=>{n.close(),i&&i.call(e)},n.onClose.finally((()=>{e.destroy=i}))}}var re=n(11),se=n(28);function de({menuItems:e}){const[t,n]=Object(o.useState)(!1);return Object(A.jsx)(j.EuiPopover,{id:"createNew",button:Object(A.jsx)(j.EuiButton,{"data-test-subj":"createNew",iconType:"plusInCircle",iconSide:"left",onClick:()=>{n(!t)},fill:!0},Object(A.jsx)(re.FormattedMessage,{id:"embeddableApi.addPanel.createNewDefaultOption",defaultMessage:"Create new"})),isOpen:t,closePopover:()=>{n(!1)},panelPaddingSize:"none",anchorPosition:"downRight"},Object(A.jsx)(j.EuiContextMenuPanel,{items:e}))}class add_panel_flyout_AddPanelFlyout extends r.a.Component{constructor(e){super(e),a()(this,"lastToast",void 0),a()(this,"state",{isCreateMenuOpen:!1}),a()(this,"showToast",(e=>{this.lastToast&&this.props.notifications.toasts.remove(this.lastToast),this.lastToast=this.props.notifications.toasts.addSuccess({title:l.i18n.translate("embeddableApi.addPanel.savedObjectAddedToContainerSuccessMessageTitle",{defaultMessage:"{savedObjectName} was added",values:{savedObjectName:e}}),"data-test-subj":"addObjectToContainerSuccess"})})),a()(this,"createNewEmbeddable",(async e=>{this.props.onClose();const t=this.props.getFactory(e);if(!t)throw new errors_EmbeddableFactoryNotFoundError(e);const n=await t.getExplicitInput(),i=await this.props.container.addNewEmbeddable(e,n);i&&this.showToast(i.getInput().title||"")})),a()(this,"onAddPanel",(async(e,t,n,i)=>{const a=[...this.props.getAllFactories()].find((e=>e.savedObjectMetaData&&e.savedObjectMetaData.type===t));if(!a)throw new errors_EmbeddableFactoryNotFoundError(t);this.props.container.addNewEmbeddable(a.type,{savedObjectId:e}),this.doTelemetryForAddEvent(this.props.container.type,a,i),this.showToast(n)}))}doTelemetryForAddEvent(e,t,n){const{reportUiCounter:i}=this.props;if(i){var a;const o=null!==(a=t.savedObjectMetaData)&&void 0!==a&&a.getSavedObjectSubType?t.savedObjectMetaData.getSavedObjectSubType(n):t.type;i(e,se.METRIC_TYPE.CLICK,`${o}:add`)}}getCreateMenuItems(){return[...this.props.getAllFactories()].filter((e=>e.isEditable()&&!e.isContainerType&&e.canCreateNew())).map((e=>Object(A.jsx)(j.EuiContextMenuItem,{key:e.type,"data-test-subj":`createNew-${e.type}`,onClick:()=>this.createNewEmbeddable(e.type),className:"embPanel__addItem"},function([e,...t]){return`${e.toUpperCase()}${t.join("")}`}(e.getDisplayName()))))}render(){const e=this.props.SavedObjectFinder,t=[...this.props.getAllFactories()].filter((e=>Boolean(e.savedObjectMetaData)&&!e.isContainerType)).map((({savedObjectMetaData:e})=>e)),n=Object(A.jsx)(e,{onChoose:this.onAddPanel,savedObjectMetaData:t,showFilter:!0,noItemsMessage:l.i18n.translate("embeddableApi.addPanel.noMatchingObjectsMessage",{defaultMessage:"No matching objects found."})},this.props.showCreateNewMenu?Object(A.jsx)(de,{menuItems:this.getCreateMenuItems()}):null);return Object(A.jsx)(r.a.Fragment,null,Object(A.jsx)(j.EuiFlyoutHeader,{hasBorder:!0},Object(A.jsx)(j.EuiTitle,{size:"m"},Object(A.jsx)("h2",null,Object(A.jsx)(re.FormattedMessage,{id:"embeddableApi.addPanel.Title",defaultMessage:"Add from library"})))),Object(A.jsx)(j.EuiFlyoutBody,null,n))}}function le(e){const{embeddable:t,getFactory:n,getAllFactories:i,overlays:a,notifications:o,SavedObjectFinder:r,showCreateNewMenu:s,reportUiCounter:d,theme:l}=e,c=a.openFlyout(Object(T.toMountPoint)(Object(A.jsx)(add_panel_flyout_AddPanelFlyout,{container:t,onClose:()=>{c&&c.close()},getFactory:n,getAllFactories:i,notifications:o,reportUiCounter:d,SavedObjectFinder:r,showCreateNewMenu:s}),{theme$:l.theme$}),{"data-test-subj":"dashboardAddPanel",ownFocus:!0});return c}const ce="ACTION_ADD_PANEL";class add_panel_action_AddPanelAction{constructor(e,t,n,i,o,r,s){a()(this,"type",ce),a()(this,"id",ce),this.getFactory=e,this.getAllFactories=t,this.overlays=n,this.notifications=i,this.SavedObjectFinder=o,this.theme=r,this.reportUiCounter=s}getDisplayName(){return l.i18n.translate("embeddableApi.addPanel.displayName",{defaultMessage:"Add panel"})}getIconType(){return"plusInCircleFilled"}async isCompatible(e){const{embeddable:t}=e;return t.getIsContainer()&&t.getInput().viewMode===g.a.EDIT}async execute(e){const{embeddable:t}=e;if(!t.getIsContainer()||!await this.isCompatible(e))throw new Error("Context is incompatible");le({embeddable:t,getFactory:this.getFactory,getAllFactories:this.getAllFactories,overlays:this.overlays,notifications:this.notifications,SavedObjectFinder:this.SavedObjectFinder,reportUiCounter:this.reportUiCounter,theme:this.theme})}}const ue="deletePanel";class remove_panel_action_RemovePanelAction{constructor(){a()(this,"type",ue),a()(this,"id",ue),a()(this,"order",1)}getDisplayName(){return l.i18n.translate("embeddableApi.panel.removePanel.displayName",{defaultMessage:"Delete from dashboard"})}getIconType(){return"trash"}async isCompatible({embeddable:e}){const t=e.parent&&void 0!==e.parent.getInput().expandedPanelId&&e.parent.getInput().expandedPanelId===e.id;return Boolean(e.parent&&e.getInput().viewMode===g.a.EDIT&&!t)}async execute({embeddable:e}){if(!e.parent||!await this.isCompatible({embeddable:e}))throw new ae.IncompatibleActionError;e.parent.removeEmbeddable(e.id)}}const pe="ACTION_CUSTOMIZE_PANEL";class customize_panel_action_CustomizePanelTitleAction{constructor(e){a()(this,"type",pe),a()(this,"id",pe),a()(this,"order",40),this.getDataFromUser=e}getDisplayName(){return l.i18n.translate("embeddableApi.customizePanel.action.displayName",{defaultMessage:"Edit panel title"})}getIconType(){return"pencil"}async isCompatible({embeddable:e}){return e.getInput().viewMode===g.a.EDIT}async execute({embeddable:e}){const t=await this.getDataFromUser({embeddable:e}),{title:n,hideTitle:i}=t;e.updateInput({title:n,hidePanelTitles:i})}}class panel_options_menu_PanelOptionsMenu extends r.a.Component{static getDerivedStateFromProps(e,t){return e.closeContextMenu?{...t,isPopoverOpen:!1}:t}constructor(e){super(e),a()(this,"mounted",!1),a()(this,"closePopover",(()=>{this.mounted&&this.setState({isPopoverOpen:!1})})),a()(this,"toggleContextMenu",(()=>{if(!this.mounted)return;this.setState((({isPopoverOpen:e})=>({isPopoverOpen:!e})),(()=>{this.state.isPopoverOpen&&(this.setState({actionContextMenuPanel:void 0}),this.props.getActionContextMenuPanel().then((e=>{this.mounted&&this.setState({actionContextMenuPanel:e})})).catch((e=>console.error(e))))}))})),this.state={actionContextMenuPanel:void 0,isPopoverOpen:!1}}async componentDidMount(){this.mounted=!0,this.setState({actionContextMenuPanel:void 0});const e=await this.props.getActionContextMenuPanel();this.mounted&&this.setState({actionContextMenuPanel:e})}componentWillUnmount(){this.mounted=!1}render(){const{isViewMode:e,title:t,index:n}=this.props,i=l.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonEnhancedAriaLabel",{defaultMessage:"Panel options for {title}",values:{title:t}}),a=void 0===n?l.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonAriaLabel",{defaultMessage:"Panel options"}):l.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonAriaLabelWithIndex",{defaultMessage:"Options for panel {index}",values:{index:n}}),o=Object(A.jsx)(j.EuiButtonIcon,{iconType:e?"boxesHorizontal":"gear",color:"text",className:"embPanel__optionsMenuButton","aria-label":t?i:a,"data-test-subj":"embeddablePanelToggleMenuIcon",onClick:this.toggleContextMenu});return Object(A.jsx)(j.EuiPopover,{className:"embPanel__optionsMenuPopover",button:o,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downRight","data-test-subj":this.state.isPopoverOpen?"embeddablePanelContextMenuOpen":"embeddablePanelContextMenuClosed"},Object(A.jsx)(j.EuiContextMenu,{initialPanelId:"mainMenu",panels:this.state.actionContextMenuPanel||[]}))}}function be({title:e,index:t,isViewMode:n,hidePanelTitle:i,getActionContextMenuPanel:a,closeContextMenu:o,badges:s,notifications:d,embeddable:c,headerId:u,customizeTitle:p}){const b=function(e){if("getDescription"in e){const t=e.getDescription();if(t)return t}return""}(c),h=!i&&(!n||e),m=!n||s.length>0||d.length>0||h||b,g=ie()("embPanel__header",{"embPanel__header--floater":!m}),f=l.i18n.translate("embeddableApi.panel.placeholderTitle",{defaultMessage:"[No Title]"}),v=()=>Object(A.jsx)("span",{id:u},m&&e?l.i18n.translate("embeddableApi.panel.enhancedDashboardPanelAriaLabel",{defaultMessage:"Dashboard panel: {title}",values:{title:e||f}}):l.i18n.translate("embeddableApi.panel.dashboardPanelAriaLabel",{defaultMessage:"Dashboard panel"}));if(!m)return Object(A.jsx)("div",{"data-test-subj":"dashboardPanelTitle__wrapper",className:g},Object(A.jsx)(panel_options_menu_PanelOptionsMenu,{getActionContextMenuPanel:a,isViewMode:n,closeContextMenu:o,title:e,index:t}),Object(A.jsx)(j.EuiScreenReaderOnly,null,v()));return Object(A.jsx)("span",{"data-test-subj":"dashboardPanelTitle__wrapper"},Object(A.jsx)("figcaption",{className:g,"data-test-subj":`embeddablePanelHeading-${(e||"").replace(/\s/g,"")}`},Object(A.jsx)("h2",{"data-test-subj":"dashboardPanelTitle",className:"embPanel__title embPanel__dragger"},Object(A.jsx)(j.EuiScreenReaderOnly,null,v()),(()=>{let t;return h&&(t=n?Object(A.jsx)("span",{className:ie()("embPanel__titleText",{embPanel__placeholderTitleText:!e})},e||f):p?Object(A.jsx)(j.EuiLink,{color:"text","data-test-subj":"embeddablePanelTitleLink",className:ie()("embPanel__titleText",{embPanel__placeholderTitleText:!e}),"aria-label":l.i18n.translate("embeddableApi.panel.editTitleAriaLabel",{defaultMessage:"Click to edit title: {title}",values:{title:e||f}}),onClick:()=>p.execute({embeddable:c})},e||f):null),b?Object(A.jsx)(j.EuiToolTip,{content:b,delay:"regular",position:"top",anchorClassName:"embPanel__titleTooltipAnchor"},Object(A.jsx)("span",{className:"embPanel__titleInner"},t," ",Object(A.jsx)(j.EuiIcon,{type:"iInCircle",color:"subdued"}))):Object(A.jsx)("span",{className:"embPanel__titleInner"},t)})(),function(e,t){return e.map((e=>Object(A.jsx)(j.EuiBadge,{key:e.id,className:"embPanel__headerBadge",iconType:e.getIconType({embeddable:t,trigger:U}),onClick:()=>e.execute({embeddable:t,trigger:U}),onClickAriaLabel:e.getDisplayName({embeddable:t,trigger:U})},e.getDisplayName({embeddable:t,trigger:U}))))}(s,c)),function(e,t){return e.map((e=>{const n={embeddable:t};let i=e.MenuItem?r.a.createElement(Object(T.uiToReactComponent)(e.MenuItem),{key:e.id,context:{embeddable:t,trigger:V}}):Object(A.jsx)(j.EuiNotificationBadge,{"data-test-subj":`embeddablePanelNotification-${e.id}`,key:e.id,style:{marginTop:"4px",marginRight:"4px"},onClick:()=>e.execute({...n,trigger:V})},e.getDisplayName({...n,trigger:V}));if(e.getDisplayNameTooltip){const t=e.getDisplayNameTooltip({...n,trigger:V});t&&(i=Object(A.jsx)(j.EuiToolTip,{position:"top",delay:"regular",content:t,key:e.id},i))}return i}))}(d,c),Object(A.jsx)(panel_options_menu_PanelOptionsMenu,{isViewMode:n,getActionContextMenuPanel:a,closeContextMenu:o,title:e,index:t})))}class customize_panel_modal_CustomizePanelModal extends o.Component{constructor(e){var t;super(e),a()(this,"reset",(()=>{this.setState({title:this.props.embeddable.getOutput().defaultTitle})})),a()(this,"onHideTitleToggle",(()=>{this.setState((e=>({hideTitle:!e.hideTitle})))})),a()(this,"save",(()=>{const e=this.state.title===this.props.embeddable.getOutput().defaultTitle?void 0:this.state.title;this.props.updateTitle(e,this.state.hideTitle)})),this.state={hideTitle:e.embeddable.getInput().hidePanelTitles,title:null!==(t=e.embeddable.getInput().title)&&void 0!==t?t:this.props.embeddable.getOutput().defaultTitle}}render(){const e="customizePanelModalTitle";return Object(A.jsx)(j.EuiFocusTrap,{clickOutsideDisables:!0,initialFocus:".panelTitleInputText"},Object(A.jsx)(j.EuiOutsideClickDetector,{onOutsideClick:this.props.cancel},Object(A.jsx)("div",{role:"dialog","aria-modal":"true","aria-labelledby":e,className:"euiModal__flex"},Object(A.jsx)("form",{onSubmit:e=>{e.preventDefault(),this.save()}},Object(A.jsx)(j.EuiModalHeader,null,Object(A.jsx)(j.EuiModalHeaderTitle,{"data-test-subj":"customizePanelTitle"},Object(A.jsx)("h2",{id:e},"Customize panel"))),Object(A.jsx)(j.EuiModalBody,null,Object(A.jsx)(j.EuiFormRow,null,Object(A.jsx)(j.EuiSwitch,{checked:!this.state.hideTitle,"data-test-subj":"customizePanelHideTitle",id:"hideTitle",label:Object(A.jsx)(re.FormattedMessage,{defaultMessage:"Show panel title",id:"embeddableApi.customizePanel.modal.showTitle"}),onChange:this.onHideTitleToggle})),Object(A.jsx)(j.EuiFormRow,{label:l.i18n.translate("embeddableApi.customizePanel.modal.optionsMenuForm.panelTitleFormRowLabel",{defaultMessage:"Panel title"})},Object(A.jsx)(j.EuiFieldText,{id:"panelTitleInput",className:"panelTitleInputText","data-test-subj":"customEmbeddablePanelTitleInput",name:"min",type:"text",disabled:this.state.hideTitle,value:this.state.title||"",onChange:e=>this.setState({title:e.target.value}),"aria-label":l.i18n.translate("embeddableApi.customizePanel.modal.optionsMenuForm.panelTitleInputAriaLabel",{defaultMessage:"Enter a custom title for your panel"}),append:Object(A.jsx)(j.EuiButtonEmpty,{"data-test-subj":"resetCustomEmbeddablePanelTitle",onClick:this.reset,disabled:this.state.hideTitle},Object(A.jsx)(re.FormattedMessage,{id:"embeddableApi.customizePanel.modal.optionsMenuForm.resetCustomDashboardButtonLabel",defaultMessage:"Reset"}))}))),Object(A.jsx)(j.EuiModalFooter,null,Object(A.jsx)(j.EuiButtonEmpty,{onClick:()=>this.props.cancel()},Object(A.jsx)(re.FormattedMessage,{id:"embeddableApi.customizePanel.modal.cancel",defaultMessage:"Cancel"})),Object(A.jsx)(j.EuiButton,{"data-test-subj":"saveNewTitleButton",onClick:this.save,fill:!0},Object(A.jsx)(re.FormattedMessage,{id:"embeddableApi.customizePanel.modal.saveButtonTitle",defaultMessage:"Save"})))))))}}function he(e){if(!e.error)return null;const t="AbortError"===e.error.name?l.i18n.translate("embeddableApi.panel.labelAborted",{defaultMessage:"Aborted"}):l.i18n.translate("embeddableApi.panel.labelError",{defaultMessage:"Error"});return Object(A.jsx)("div",{className:"embPanel__labelWrapper"},Object(A.jsx)("div",{className:"embPanel__label"},Object(A.jsx)(j.EuiToolTip,{"data-test-subj":"embeddableErrorMessage",content:e.error.message},Object(A.jsx)(j.EuiBadge,{"data-test-subj":"embeddableErrorLabel",color:"danger"},t))))}const me=({order:e},{order:t})=>(t||0)-(e||0);class embeddable_panel_EmbeddablePanel extends r.a.Component{constructor(e){var t,n,i,o;super(e),a()(this,"embeddableRoot",void 0),a()(this,"parentSubscription",void 0),a()(this,"subscription",new b.Subscription),a()(this,"mounted",!1),a()(this,"generateId",Object(j.htmlIdGenerator)()),a()(this,"onFocus",(e=>{this.setState({focusedPanelIndex:e})})),a()(this,"onBlur",(e=>{this.state.focusedPanelIndex===e&&this.setState({focusedPanelIndex:void 0})})),a()(this,"closeMyContextMenuPanel",(()=>{this.mounted&&this.setState({closeContextMenu:!0},(()=>{this.mounted&&this.setState({closeContextMenu:!1})}))})),a()(this,"getUniversalActions",(()=>{var e;let t={};if(this.props.inspector&&(t={inspectPanel:new inspect_panel_action_InspectPanelAction(this.props.inspector)}),!(this.props.getEmbeddableFactory&&this.props.getAllEmbeddableFactories&&this.props.overlays&&this.props.notifications&&this.props.SavedObjectFinder&&this.props.application))return t;return{...t,customizePanelTitle:new customize_panel_action_CustomizePanelTitleAction((n=this.props.overlays,i=this.props.theme,async function(e){return new Promise((t=>{const a=n.openModal(Object(T.toMountPoint)(Object(A.jsx)(customize_panel_modal_CustomizePanelModal,{embeddable:e.embeddable,updateTitle:(e,n)=>{a.close(),t({title:e,hideTitle:n})},cancel:()=>a.close()}),{theme$:i.theme$}),{"data-test-subj":"customizePanel"})}))})),addPanel:new add_panel_action_AddPanelAction(this.props.getEmbeddableFactory,this.props.getAllEmbeddableFactories,this.props.overlays,this.props.notifications,this.props.SavedObjectFinder,this.props.theme,this.props.reportUiCounter),removePanel:new remove_panel_action_RemovePanelAction,editPanel:new edit_panel_action_EditPanelAction(this.props.getEmbeddableFactory,this.props.application,this.props.stateTransfer,null===(e=this.props.containerContext)||void 0===e?void 0:e.getCurrentPath)};var n,i})),a()(this,"getActionContextMenuPanel",(async()=>{let e=await this.props.getActions(B,{embeddable:this.props.embeddable});const{disabledActions:t}=this.props.embeddable.getInput();if(t){const n=(e=>({id:t})=>-1===e.indexOf(t))(t);e=e.filter(n)}let n=e.concat(Object.values(this.state.universalActions||{})).sort(me);return this.props.actionPredicate&&(n=n.filter((({id:e})=>this.props.actionPredicate(e)))),await Object(ae.buildContextMenuForActions)({actions:n.map((e=>({action:e,context:{embeddable:this.props.embeddable},trigger:z}))),closeMenu:this.closeMyContextMenuPanel})}));const{embeddable:s}=this.props,d=null!==(t=s.getInput().viewMode)&&void 0!==t?t:g.a.EDIT,l=Boolean(null===(n=s.parent)||void 0===n||null===(i=n.getInput())||void 0===i?void 0:i.hidePanelTitles)||Boolean(null===(o=s.getInput())||void 0===o?void 0:o.hidePanelTitles);this.state={universalActions:this.getUniversalActions(),panels:[],viewMode:d,hidePanelTitle:l,closeContextMenu:!1,badges:[],notifications:[]},this.embeddableRoot=r.a.createRef()}async refreshBadges(){if(!this.mounted)return;if(!1===this.props.showBadges)return;let e=await this.props.getActions($,{embeddable:this.props.embeddable});const{disabledActions:t}=this.props.embeddable.getInput();t&&(e=e.filter((e=>-1===t.indexOf(e.id)))),p()(this.state.badges,e)||this.setState({badges:e})}async refreshNotifications(){if(!this.mounted)return;if(!1===this.props.showNotifications)return;let e=await this.props.getActions(G,{embeddable:this.props.embeddable});const{disabledActions:t}=this.props.embeddable.getInput();t&&(e=e.filter((e=>-1===t.indexOf(e.id)))),p()(this.state.notifications,e)||this.setState({notifications:e})}UNSAFE_componentWillMount(){this.mounted=!0;const{embeddable:e}=this.props,{parent:t}=e;this.subscription.add(e.getInput$().subscribe((async()=>{var t;this.mounted&&(this.setState({viewMode:null!==(t=e.getInput().viewMode)&&void 0!==t?t:g.a.EDIT}),this.refreshBadges(),this.refreshNotifications())}))),t&&(this.parentSubscription=t.getInput$().subscribe((async()=>{var n,i,a;this.mounted&&t&&(this.setState({hidePanelTitle:Boolean(null===(n=e.parent)||void 0===n||null===(i=n.getInput())||void 0===i?void 0:i.hidePanelTitles)||Boolean(null===(a=e.getInput())||void 0===a?void 0:a.hidePanelTitles)}),this.refreshBadges(),this.refreshNotifications())})))}componentWillUnmount(){this.mounted=!1,this.subscription.unsubscribe(),this.parentSubscription&&this.parentSubscription.unsubscribe(),this.state.errorEmbeddable&&this.state.errorEmbeddable.destroy(),this.props.embeddable.destroy()}render(){const e=[g.a.VIEW,g.a.PRINT].includes(this.state.viewMode),t=ie()("embPanel",{"embPanel--editing":!e,"embPanel--loading":this.state.loading}),n={};this.state.loading&&(n["data-loading"]=!0),this.state.error&&(n["data-error"]=!0);const i=this.props.embeddable.getTitle(),a=this.generateId();return Object(A.jsx)(j.EuiPanel,{className:t,"data-test-subj":"embeddablePanel","data-test-embeddable-id":this.props.embeddable.id,paddingSize:"none",role:"figure","aria-labelledby":a,hasShadow:this.props.showShadow},!this.props.hideHeader&&Object(A.jsx)(be,{getActionContextMenuPanel:this.getActionContextMenuPanel,hidePanelTitle:this.state.hidePanelTitle,isViewMode:e,customizeTitle:"customizePanelTitle"in this.state.universalActions?this.state.universalActions.customizePanelTitle:void 0,closeContextMenu:this.state.closeContextMenu,title:i,index:this.props.index,badges:this.state.badges,notifications:this.state.notifications,embeddable:this.props.embeddable,headerId:a}),Object(A.jsx)(he,{error:this.state.error}),Object(A.jsx)("div",F()({className:"embPanel__content",ref:this.embeddableRoot},n)))}componentDidMount(){this.embeddableRoot.current&&(this.subscription.add(this.props.embeddable.getOutput$().subscribe((e=>{this.setState({error:e.error,loading:e.loading})}),(e=>{if(this.embeddableRoot.current){const t=new error_embeddable_ErrorEmbeddable(e,{id:this.props.embeddable.id});t.render(this.embeddableRoot.current),this.setState({errorEmbeddable:t})}}))),this.props.embeddable.render(this.embeddableRoot.current))}}const ge="embeddable_editor_state";function fe(e){return ye("originatingApp",e,"string")}const ve="embeddable_package_state";function _e(e){return ye("type",e,"string")&&ye("input",e,"object")}function ye(e,t,n){return Boolean(t)&&e in t&&(!n||typeof t[e]===n)}const xe="EMBEDDABLE_STATE_TRANSFER";class embeddable_state_transfer_EmbeddableStateTransfer{constructor(e,t,n,i){a()(this,"isTransferInProgress",void 0),a()(this,"storage",void 0),a()(this,"appList",void 0),a()(this,"getAppNameFromId",(e=>{var t,n;return null===(t=this.appList)||void 0===t||null===(n=t.get(e))||void 0===n?void 0:n.title})),this.navigateToApp=e,this.storage=i||new m.Storage(sessionStorage),this.isTransferInProgress=!1,this.appList=n,t.subscribe((()=>{this.isTransferInProgress=!1}))}getIncomingEditorState(e,t){return this.getIncomingState(fe,e,ge,{keysToRemoveAfterFetch:t?[ge]:void 0})}clearEditorState(e){const t=this.storage.get(xe);if(t){var n;if(e)null===(n=t.embeddable_editor_state)||void 0===n||delete n[e];else delete t.embeddable_editor_state;this.storage.set(xe,t)}}getIncomingEmbeddablePackage(e,t){return this.getIncomingState(_e,e,ve,{keysToRemoveAfterFetch:t?[ve]:void 0})}async navigateToEditor(e,t){this.isTransferInProgress=!0,await this.navigateToWithState(e,ge,{...t})}async navigateToWithEmbeddablePackage(e,t){this.isTransferInProgress=!0,await this.navigateToWithState(e,ve,{...t})}getIncomingState(e,t,n,i){var a,o;const r=null===(a=this.storage.get(xe))||void 0===a||null===(o=a[n])||void 0===o?void 0:o[t],d=!e||e(r)?Object(s.cloneDeep)(r):void 0;if(d&&null!=i&&i.keysToRemoveAfterFetch){const e={...this.storage.get(xe)};i.keysToRemoveAfterFetch.forEach((t=>{delete e[t]})),this.storage.set(xe,e)}return d}async navigateToWithState(e,t,n){var i;const a=(null===(i=this.storage.get(xe))||void 0===i?void 0:i[t])||{},o={...this.storage.get(xe),[t]:{...a,[e]:null==n?void 0:n.state}};this.storage.set(xe,o),await this.navigateToApp(e,{path:null==n?void 0:n.path,openInNewTab:null==n?void 0:n.openInNewTab})}}function Ee(e){return!!e.inputIsRefType&&!!e.getInputAsValueType&&!!e.getInputAsRefType}var je=n(29);const Pe="attributes";class attribute_service_AttributeService{constructor(e,t,n,i,o,r){if(a()(this,"inputIsRefType",(e=>Object(N.a)(e))),a()(this,"getInputAsValueType",(async e=>{if(!this.inputIsRefType(e))return e;const{attributes:t}=await this.unwrapAttributes(e),n=t.title,{savedObjectId:i,...a}=e;return{...a,attributes:Object(s.omit)(t,["title","description"]),title:n}})),a()(this,"getInputAsRefType",(async(e,t)=>this.inputIsRefType(e)?e:new Promise(((n,i)=>{const a=async t=>{await this.options.checkForDuplicateTitle(t);try{const i={...e[Pe]};i.title=t.newTitle;const a=await this.wrapAttributes(i,!0),o=Object(s.omit)(e,[Pe,"title"]);return n({...o,...a}),{id:a.savedObjectId}}catch(e){return i(e),{error:e}}};t&&t.showSaveModal&&this.showSaveModal(Object(A.jsx)(d.SavedObjectSaveModal,{onSave:a,onClose:()=>i(),title:Object(s.get)(t,"saveModalTitle",e[Pe].title),showCopyOnSave:!1,objectType:this.type,showDescription:!1}),this.i18nContext)})))),this.type=e,this.showSaveModal=t,this.i18nContext=n,this.toasts=i,this.options=o,r){if(!r(this.type))throw new errors_EmbeddableFactoryNotFoundError(this.type)}}async defaultUnwrapMethod(e){return Promise.resolve({attributes:{...e}})}async unwrapAttributes(e){return this.inputIsRefType(e)?this.options.unwrapMethod?await this.options.unwrapMethod(e.savedObjectId):await this.defaultUnwrapMethod(e):{attributes:e[Pe]}}async wrapAttributes(e,t,n){const i=n||{},a=n&&this.inputIsRefType(n)?n.savedObjectId:void 0;if(!t)return{[Pe]:e};try{const t=await this.options.saveMethod(e,a);return"id"in t?{...i,savedObjectId:t.id}:{...i}}catch(e){return this.toasts.addDanger({title:l.i18n.translate("embeddableApi.attributeService.saveToLibraryError",{defaultMessage:"An error occurred while saving. Error: {errorMessage}",values:{errorMessage:e.message}}),"data-test-subj":"attributeServiceSaveFailure"}),Promise.reject({error:e})}}}var Oe=n(13),Te=n(7);class plugin_EmbeddablePublicPlugin{constructor(e){a()(this,"embeddableFactoryDefinitions",new Map),a()(this,"embeddableFactories",new Map),a()(this,"enhancements",new Map),a()(this,"customEmbeddableFactoryProvider",void 0),a()(this,"stateTransferService",{}),a()(this,"isRegistryReady",!1),a()(this,"appList",void 0),a()(this,"appListSubscription",void 0),a()(this,"registerEnhancement",(e=>{if(this.enhancements.has(e.id))throw new Error(`enhancement with id ${e.id} already exists in the registry`);this.enhancements.set(e.id,{id:e.id,telemetry:e.telemetry||(()=>({})),inject:e.inject||s.identity,extract:e.extract||(e=>({state:e,references:[]})),migrations:e.migrations||{}})})),a()(this,"getEnhancement",(e=>this.enhancements.get(e)||{id:"unknown",telemetry:(e,t)=>t,inject:s.identity,extract:e=>({state:e,references:[]}),migrations:{}})),a()(this,"getEmbeddableFactories",(()=>(this.ensureFactoriesExist(),this.embeddableFactories.values()))),a()(this,"registerEmbeddableFactory",((e,t)=>{if(this.embeddableFactoryDefinitions.has(e))throw new Error(`Embeddable factory [embeddableFactoryId = ${e}] already registered in Embeddables API.`);return this.embeddableFactoryDefinitions.set(e,t),()=>this.getEmbeddableFactory(e)})),a()(this,"getEmbeddableFactory",(e=>{if(!this.isRegistryReady)throw new Error("Embeddable factories can only be retrieved after setup lifecycle.");this.ensureFactoryExists(e);return this.embeddableFactories.get(e)})),a()(this,"ensureFactoriesExist",(()=>{this.embeddableFactoryDefinitions.forEach((e=>this.ensureFactoryExists(e.type)))})),a()(this,"ensureFactoryExists",(e=>{if(!this.embeddableFactories.get(e)){const t=this.embeddableFactoryDefinitions.get(e);if(!t)return;this.embeddableFactories.set(e,this.customEmbeddableFactoryProvider?this.customEmbeddableFactoryProvider(t):E(t))}}))}setup(e,{uiActions:t}){return I(e.theme),(e=>{e.registerTrigger(z),e.registerTrigger(U),e.registerTrigger(V),e.registerTrigger(H),e.registerTrigger(K)})(t),{registerEmbeddableFactory:this.registerEmbeddableFactory,registerEnhancement:this.registerEnhancement,setCustomEmbeddableFactoryProvider:e=>{if(this.customEmbeddableFactoryProvider)throw new Error("Custom embeddable factory provider is already set, and can only be set once");this.customEmbeddableFactoryProvider=e}}}start(e,{uiActions:t,inspector:n}){this.embeddableFactoryDefinitions.forEach((e=>{this.embeddableFactories.set(e.type,this.customEmbeddableFactoryProvider?this.customEmbeddableFactoryProvider(e):E(e))})),this.appListSubscription=e.application.applications$.subscribe((e=>{this.appList=e})),this.stateTransferService=new embeddable_state_transfer_EmbeddableStateTransfer(e.application.navigateToApp,e.application.currentAppId$,this.appList),this.isRegistryReady=!0;const i={getEmbeddableFactory:this.getEmbeddableFactory,getEnhancement:this.getEnhancement},a=()=>((e,t,n)=>{const i=new Set;for(const e of Object.keys(Te.a))i.add(e);for(const t of e){const e=t.migrations,n="function"==typeof e?e():e;Object.keys(n).forEach((e=>i.add(e)))}for(const e of t){const t=e.migrations,n="function"==typeof t?t():t;Object.keys(n).forEach((e=>i.add(e)))}const a={};return i.forEach((e=>{a[e]=t=>({...n(t,e)})})),a})(Array.from(this.embeddableFactories.values()),Array.from(this.enhancements.values()),Object(Oe.c)(i));return{getEmbeddableFactory:this.getEmbeddableFactory,getEmbeddableFactories:this.getEmbeddableFactories,getAttributeService:(t,n)=>new attribute_service_AttributeService(t,d.showSaveModal,e.i18n.Context,e.notifications.toasts,n,this.getEmbeddableFactory),getStateTransfer:t=>t?new embeddable_state_transfer_EmbeddableStateTransfer(e.application.navigateToApp,e.application.currentAppId$,this.appList,t):this.stateTransferService,EmbeddablePanel:(()=>({embeddable:i,hideHeader:a,containerContext:o,index:r})=>Object(A.jsx)(embeddable_panel_EmbeddablePanel,{hideHeader:a,embeddable:i,index:r,stateTransfer:this.stateTransferService,getActions:t.getTriggerCompatibleActions,getEmbeddableFactory:this.getEmbeddableFactory,getAllEmbeddableFactories:this.getEmbeddableFactories,overlays:e.overlays,notifications:e.notifications,application:e.application,inspector:n,SavedObjectFinder:Object(d.getSavedObjectFinder)(e.savedObjects,e.uiSettings),containerContext:o,theme:e.theme}))(),telemetry:Object(Oe.d)(i),extract:Object(Oe.a)(i),inject:Object(Oe.b)(i),getAllMigrations:a,migrateToLatest:e=>Object(je.migrateToLatest)(a(),e)}}stop(){this.appListSubscription&&this.appListSubscription.unsubscribe()}}function we(e){return new plugin_EmbeddablePublicPlugin(e)}}]);