!function(e){var t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=10)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,s){e.exports=s(12)(2)},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,s){s(11),__kbnBundles__.define("plugin/newsfeed/public",s,13)},function(e,t,s){s.p=window.__kbnPublicPath__.newsfeed},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,s){"use strict";s.r(t),s.d(t,"NewsfeedApiEndpoint",(function(){return N})),s.d(t,"plugin",(function(){return I}));var n=s(6),a=s.n(n),r=s(4),i=s(7),o=s(9),u=s.n(o),l=s(3),c=s.n(l),d=s(2),f=s.n(d),h=s(5),b=s(1),p=s(8),j=s(0);const m=()=>Object(j.jsx)(b.EuiEmptyPrompt,{iconType:"documents",titleSize:"s","data-test-subj":"emptyNewsfeed",title:Object(j.jsx)("h2",null,Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsTitle",defaultMessage:"No news?"})),body:Object(j.jsx)("p",null,Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsText",defaultMessage:"If your Kibana instance doesn’t have internet access, ask your administrator to disable this feature. Otherwise, we’ll keep trying to fetch the news."}))}),g=()=>Object(j.jsx)(b.EuiEmptyPrompt,{title:Object(j.jsx)(b.EuiLoadingElastic,{size:"xl"}),body:Object(j.jsx)("p",null,Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.loadingPrompt.gettingNewsText",defaultMessage:"Getting the latest news..."}))}),O=()=>{const{newsFetchResult:e,setFlyoutVisible:t}=Object(l.useContext)(w),s=Object(l.useCallback)((()=>t(!1)),[t]);return Object(j.jsx)(b.EuiPortal,null,Object(j.jsx)(b.EuiFlyout,{onClose:s,size:"s","aria-labelledby":"flyoutSmallTitle",className:"kbnNews__flyout","data-test-subj":"NewsfeedFlyout"},Object(j.jsx)(b.EuiFlyoutHeader,{hasBorder:!0},Object(j.jsx)(b.EuiTitle,{size:"s"},Object(j.jsx)("h2",{id:"flyoutSmallTitle"},Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.flyoutList.whatsNewTitle",defaultMessage:"What's new at Elastic"})))),Object(j.jsx)(b.EuiFlyoutBody,{className:"kbnNews__flyoutAlerts"},e?e.feedItems.length>0?e.feedItems.map((e=>Object(j.jsx)(b.EuiHeaderAlert,{key:e.hash,title:e.title,text:e.description,"data-test-subj":"newsHeadAlert",action:Object(j.jsx)(b.EuiLink,{target:"_blank",href:e.linkUrl,external:!0},e.linkText),date:e.publishOn.format("DD MMMM YYYY"),badge:e.badge?Object(j.jsx)(b.EuiBadge,{color:"hollow"},e.badge):void 0}))):Object(j.jsx)(m,null):Object(j.jsx)(g,null)),Object(j.jsx)(b.EuiFlyoutFooter,null,Object(j.jsx)(b.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{iconType:"cross",onClick:s,flush:"left"},Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.flyoutList.closeButtonLabel",defaultMessage:"Close"}))),Object(j.jsx)(b.EuiFlexItem,{grow:!1},e?Object(j.jsx)(b.EuiText,{color:"subdued",size:"s"},Object(j.jsx)("p",null,Object(j.jsx)(h.FormattedMessage,{id:"newsfeed.flyoutList.versionTextLabel",defaultMessage:"{version}",values:{version:`Version ${e.kibanaVersion}`}}))):null)))))},w=c.a.createContext({}),x=({newsfeedApi:e})=>{const[t,s]=Object(l.useState)(!1),[n,a]=Object(l.useState)(null),r=Object(l.useMemo)((()=>!!n&&n.hasNew),[n]);Object(l.useEffect)((()=>{const t=e.fetchResults$.subscribe((e=>{a(e)}));return()=>t.unsubscribe()}),[e]);const i=Object(l.useCallback)((()=>{n&&e.markAsRead(n.feedItems.map((e=>e.hash))),s(!t)}),[e,n,t]);return Object(j.jsx)(w.Provider,{value:{setFlyoutVisible:s,newsFetchResult:n}},Object(j.jsx)(c.a.Fragment,null,Object(j.jsx)(b.EuiHeaderSectionItemButton,{"data-test-subj":"newsfeed","aria-controls":"keyPadMenu","aria-expanded":t,"aria-haspopup":"true","aria-label":r?p.i18n.translate("newsfeed.headerButton.unreadAriaLabel",{defaultMessage:"Newsfeed menu - unread items available"}):p.i18n.translate("newsfeed.headerButton.readAriaLabel",{defaultMessage:"Newsfeed menu - all items read"}),notification:!!r||null,onClick:i},Object(j.jsx)(b.EuiIcon,{type:"cheer",size:"m"})),t?Object(j.jsx)(O,null):null))},_=e=>!f()(e.expire_on).isBefore(Date.now())&&!f()(e.publish_on).isAfter(Date.now()),y=(e,t)=>{const{expire_on:s,publish_on:n,languages:a,title:r,description:i,link_text:o,link_url:u,badge:l,hash:c}=e;let d=t;return a&&!a.includes(d)&&(d="en"),{title:r[d],description:i[d],linkText:null!=o?o[d]:null,linkUrl:u[d],badge:null!=l?l[d]:null,publishOn:f()(n),expireOn:f()(s),hash:c.slice(0,10)}},S=e=>![e.title,e.description,e.linkText,e.linkUrl,e.publishOn,e.hash].includes(void 0);class driver_NewsfeedApiDriver{constructor(e,t,s,n){a()(this,"kibanaVersion",void 0),a()(this,"loadedTime",f()().utc()),this.userLanguage=t,this.fetchInterval=s,this.storage=n,this.kibanaVersion=e.replace(/^(\d+\.\d+\.\d+).*/,"$1")}shouldFetch(){const e=this.storage.getLastFetchTime();if(!e)return!0;const t=f()(e);if(this.loadedTime.diff(t)>0)return!0;const s=f.a.utc();return f.a.duration(s.diff(t)).asMilliseconds()>this.fetchInterval}fetchNewsfeedItems(e){const t=e.pathTemplate.replace("{VERSION}",this.kibanaVersion),s=(e.urlRoot||"https://feeds.elastic.co")+t,n=new Request(s,{method:"GET"});return r.from(window.fetch(n).then((async e=>{const{items:t}=await e.json();return this.convertResponse(t)})))}convertResponse(e){const t=((e,t)=>e.filter(_).map((e=>y(e,t))).filter(S))(e,this.userLanguage),s=this.storage.setFetchedItems(t.map((e=>e.hash)));return{error:null,kibanaVersion:this.kibanaVersion,hasNew:s,feedItems:t}}}class NeverFetchNewsfeedApiDriver{shouldFetch(){return!1}fetchNewsfeedItems(){throw new Error("Not implemented!")}}class storage_NewsfeedStorage{constructor(e){a()(this,"lastFetchStorageKey",void 0),a()(this,"readStatusStorageKey",void 0),a()(this,"unreadStatus$",void 0),this.lastFetchStorageKey=k(e,"lastFetch"),this.readStatusStorageKey=k(e,"readStatus"),this.unreadStatus$=new r.BehaviorSubject(v(this.getReadStatus()))}getLastFetchTime(){const e=localStorage.getItem(this.lastFetchStorageKey);if(e)return f()(e,"x").toDate()}setLastFetchTime(e){localStorage.setItem(this.lastFetchStorageKey,JSON.stringify(e.getTime()))}setFetchedItems(e){const t=this.getReadStatus(),s={};return e.forEach((e=>{var n;s[e]=null!==(n=t[e])&&void 0!==n&&n})),this.setReadStatus(s)}markItemsAsRead(e){const t=this.getReadStatus();return e.forEach((e=>{t[e]=!0})),this.setReadStatus(t)}isAnyUnread(){return this.unreadStatus$.value}isAnyUnread$(){return this.unreadStatus$.asObservable()}getReadStatus(){try{return JSON.parse(localStorage.getItem(this.readStatusStorageKey)||"{}")}catch(e){return{}}}setReadStatus(e){const t=v(e);return this.unreadStatus$.next(v(e)),localStorage.setItem(this.readStatusStorageKey,JSON.stringify(e)),t}}const v=e=>Object.values(e).some((e=>!e)),k=(e,t)=>`newsfeed.${e}.${t}`;let N;!function(e){e.KIBANA="kibana",e.KIBANA_ANALYTICS="kibana-analytics",e.SECURITY_SOLUTION="security-solution",e.OBSERVABILITY="observability"}(N||(N={}));class plugin_NewsfeedPublicPlugin{constructor(e){a()(this,"kibanaVersion",void 0),a()(this,"config",void 0),a()(this,"stop$",new r.ReplaySubject(1)),this.kibanaVersion=e.env.packageInfo.version;const t=e.config.get();this.config=Object.freeze({...t,mainInterval:f.a.duration(t.mainInterval),fetchInterval:f.a.duration(t.fetchInterval)})}setup(e){return{}}start(e,{screenshotMode:t}){const s=t.isScreenshotMode(),n=this.createNewsfeedApi(this.config,N.KIBANA,s);return e.chrome.navControls.registerRight({order:1e3,mount:e=>this.mount(n,e)}),{createNewsFeed$:e=>{const t=Object.assign({},this.config,{service:{...this.config.service,pathTemplate:`/${e}/v{VERSION}.json`}}),{fetchResults$:n}=this.createNewsfeedApi(t,e,s);return n}}}stop(){this.stop$.next()}createNewsfeedApi(e,t,s){const n=function(e,t,s,n){const a=new storage_NewsfeedStorage(s),o=e.mainInterval.asMilliseconds(),u=(()=>{if(n)return new NeverFetchNewsfeedApiDriver;const s=p.i18n.getLocale(),r=e.fetchInterval.asMilliseconds();return new driver_NewsfeedApiDriver(t,s,r,a)})(),l=Object(r.timer)(0,o).pipe(Object(i.filter)((()=>u.shouldFetch())),Object(i.mergeMap)((()=>u.fetchNewsfeedItems(e.service).pipe(Object(i.catchError)((e=>(window.console.error(e),Object(r.of)({error:e,kibanaVersion:t,hasNew:!1,feedItems:[]}))))))),Object(i.tap)((()=>a.setLastFetchTime(new Date))));return{fetchResults$:Object(r.combineLatest)([l,a.isAnyUnread$()]).pipe(Object(i.map)((([e,t])=>({...e,hasNew:!e.error&&t})))),markAsRead:e=>{a.markItemsAsRead(e)}}}(e,this.kibanaVersion,t,s);return{markAsRead:n.markAsRead,fetchResults$:n.fetchResults$.pipe(Object(i.takeUntil)(this.stop$),Object(i.catchError)((()=>r.of(null))))}}mount(e,t){return u.a.render(Object(j.jsx)(h.I18nProvider,null,Object(j.jsx)(x,{newsfeedApi:e})),t),()=>u.a.unmountComponentAtNode(t)}}function I(e){return new plugin_NewsfeedPublicPlugin(e)}}]);