!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=10)}([function(e,t,i){e.exports=i(12)(2)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var a=10;function u(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function l(e,t,i,n){var r,o,s,c;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=u(e))>0&&s.length>r&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,c=a,console&&console.warn&&console.warn(c)}return e}function g(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}function h(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=g.bind(n);return r.listener=i,n.wrapFn=r,r}function d(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):f(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return u(this)},c.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var a=r[e];if(void 0===a)return!1;if("function"==typeof a)o(a,this,t);else{var u=a.length,l=f(a,u);for(i=0;i<u;++i)o(l[i],this,t)}return!0},c.prototype.addListener=function(e,t){return l(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return l(this,e,t,!0)},c.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},c.prototype.removeListener=function(e,t){var i,n,r,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return d(this,e,!0)},c.prototype.rawListeners=function(e){return d(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},c.prototype.listenerCount=p,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){i(11),__kbnBundles__.define("plugin/uiActions/public",i,13)},function(e,t,i){i.p=window.__kbnPublicPath__.uiActions},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,i){"use strict";i.r(t),i.d(t,"plugin",(function(){return N})),i.d(t,"UiActionsService",(function(){return ui_actions_service_UiActionsService})),i.d(t,"createAction",(function(){return s})),i.d(t,"IncompatibleActionError",(function(){return incompatible_action_error_IncompatibleActionError})),i.d(t,"buildContextMenuForActions",(function(){return m})),i.d(t,"VISUALIZE_FIELD_TRIGGER",(function(){return C})),i.d(t,"visualizeFieldTrigger",(function(){return S})),i.d(t,"VISUALIZE_GEO_FIELD_TRIGGER",(function(){return j})),i.d(t,"visualizeGeoFieldTrigger",(function(){return P})),i.d(t,"ROW_CLICK_TRIGGER",(function(){return O})),i.d(t,"rowClickTrigger",(function(){return M})),i.d(t,"ACTION_VISUALIZE_FIELD",(function(){return D})),i.d(t,"ACTION_VISUALIZE_GEO_FIELD",(function(){return k})),i.d(t,"ACTION_VISUALIZE_LENS_FIELD",(function(){return R}));var n=i(0),r=i.n(n),o=i(2);class action_internal_ActionInternal{constructor(e){r()(this,"id",void 0),r()(this,"type",void 0),r()(this,"order",void 0),r()(this,"MenuItem",void 0),r()(this,"ReactMenuItem",void 0),r()(this,"grouping",void 0),this.definition=e,this.id=this.definition.id,this.type=this.definition.type||"",this.order=this.definition.order||0,this.MenuItem=this.definition.MenuItem,this.ReactMenuItem=this.MenuItem?Object(o.uiToReactComponent)(this.MenuItem):void 0,this.grouping=this.definition.grouping}execute(e){return this.definition.execute(e)}getIconType(e){if(this.definition.getIconType)return this.definition.getIconType(e)}getDisplayName(e){return this.definition.getDisplayName?this.definition.getDisplayName(e):`Action: ${this.id}`}getDisplayNameTooltip(e){return this.definition.getDisplayNameTooltip?this.definition.getDisplayNameTooltip(e):""}async isCompatible(e){return!this.definition.isCompatible||await this.definition.isCompatible(e)}async getHref(e){if(this.definition.getHref)return await this.definition.getHref(e)}async shouldAutoExecute(e){return!!this.definition.shouldAutoExecute&&this.definition.shouldAutoExecute(e)}}function s(e){return{getIconType:()=>{},order:0,isCompatible:()=>Promise.resolve(!0),getDisplayName:()=>"",...e}}var c=i(1);class incompatible_action_error_IncompatibleActionError extends Error{constructor(){super(c.i18n.translate("uiActions.errors.incompatibleAction",{defaultMessage:"Action is incompatible"})),r()(this,"code","INCOMPATIBLE_ACTION")}}class trigger_contract_TriggerContract{constructor(e){r()(this,"id",void 0),r()(this,"title",void 0),r()(this,"description",void 0),r()(this,"exec",(async(e,t)=>{await this.internal.execute(e,t)})),this.internal=e,this.id=this.internal.trigger.id,this.title=this.internal.trigger.title,this.description=this.internal.trigger.description}}class trigger_internal_TriggerInternal{constructor(e,t){r()(this,"contract",void 0),this.service=e,this.trigger=t,this.contract=new trigger_contract_TriggerContract(this)}async execute(e,t){const i=this.trigger.id,n=await this.service.getTriggerCompatibleActions(i,e);await Promise.all([n.map((i=>this.service.executionService.execute({action:i,context:e,trigger:this.trigger},t)))])}}var a=i(3),u=i.n(a),l=i(4),g=i(6);const h=c.i18n.translate("uiActions.actionPanel.title",{defaultMessage:"Options"}),d=c.i18n.translate("uiActions.actionPanel.more",{defaultMessage:"More"}),p=(e,t,i)=>n=>{n.currentTarget instanceof HTMLAnchorElement?n.defaultPrevented||0!==n.button||n.currentTarget.target&&"_self"!==n.currentTarget.target||n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||(n.preventDefault(),e.execute(t)):e.execute(t),i()},f=e=>{const t=[];for(const i of e){const{_order:e,_title:n,...r}=i;t.push(r)}return t};async function m({actions:e,title:t=h,closeMenu:i=(()=>{})}){const n={mainMenu:{id:"mainMenu",title:t,items:[]}},r=e.map((async e=>{const{action:t}=e,r={...e.context,trigger:e.trigger};if(!await e.action.isCompatible(r))return;let s="",c="";if(t.grouping)for(let e=0;e<t.grouping.length;e++){const i=t.grouping[e];if(c=i.id,!n[c]){const t=i.getDisplayName?i.getDisplayName(r):i.id;n[c]={id:c,title:t,items:[],_level:e,_icon:i.getIconType?i.getIconType(r):"empty"},s&&n[s].items.push({name:t,panel:c,icon:i.getIconType?i.getIconType(r):"empty",_order:i.order||0,_title:i.getDisplayName?i.getDisplayName(r):""})}s=c}n[s||"mainMenu"].items.push({name:t.MenuItem?g.createElement(Object(o.uiToReactComponent)(t.MenuItem),{context:r}):t.getDisplayName(r),icon:t.getIconType(r),"data-test-subj":`embeddablePanelAction-${t.id}`,onClick:p(t,r,i),href:t.getHref?await t.getHref(r):void 0,_order:t.order||0,_title:t.getDisplayName(r)})}));await Promise.all(r);for(const e of Object.values(n)){const t=e.items.filter(Boolean);e.items=u.a.sortBy(t,(e=>{var t;return-1*(null!==(t=e._order)&&void 0!==t?t:0)}),(e=>e._title))}((e,t)=>{const i=e[t];if(!i)return;if(!i.items)return;if(i.items.length<=4)return;const n=i.items.slice(0,3),r=i.items.slice(3),o=i.id+"__more",s={name:d,panel:o,icon:"boxesHorizontal","data-test-subj":`embeddablePanelMore-${t}`,_order:-1};i.items=[...n,s];const c={id:o,title:i.title||h,items:r};e[o]=c})(n,"mainMenu");for(const e of Object.values(n))0===e._level&&(n.mainMenu.items.length>0&&n.mainMenu.items.push({isSeparator:!0,key:e.id+"__separator"}),e.items.length>3?n.mainMenu.items.push({name:e.title||e.id,icon:e._icon||"empty",panel:e.id}):n.mainMenu.items.push(...e.items));return(e=>{const t=[];for(const i of e){const{_level:e,_icon:n,...r}=i;t.push({...r,items:f(r.items)})}return t})(Object.values(n))}var v=i(7),_=i(9),y=i(8),b=i.n(y);const[w,T]=Object(l.createGetterSetter)("Theme");var A=i(5);let x=null;const I="contextMenu-container";const{resolveLastPosition:E}=function(){let e=0,t=0;const i=[];function n(e){i.push({el:e.target,mouseX:e.clientX,mouseY:e.clientY}),i.length>10&&i.shift()}function r(i){e=i.clientX,t=i.clientY}return document.addEventListener("mouseup",n,!0),document.addEventListener("click",n,!0),document.addEventListener("mousemove",r,{passive:!0}),document.addEventListener("mouseenter",r,{passive:!0}),{resolveLastPosition:()=>{const n=[...i].reverse().find((({el:e})=>e&&document.body.contains(e)));if(!n)return{x:e,y:t};const{top:r,left:o,bottom:s,right:c}=n.el.getBoundingClientRect(),a=n.mouseX,u=n.mouseY;return r<=u&&s>=u&&o<=a&&c>=a?{x:a,y:u}:{x:o+(c-o)/2,y:s}}}}();class open_context_menu_ContextMenuSession extends _.EventEmitter{close(){if(x===this){const e=document.getElementById(I);e&&(b.a.unmountComponentAtNode(e),this.emit("closed"))}}}function L(e,t={}){x&&x.close();const i=function(){let e=document.getElementById(I),{x:t,y:i}=E();return i+=window.scrollY,t+=window.scrollX,e?(e.style.left=t+"px",e.style.top=i+"px"):(e=document.createElement("div"),e.style.left=t+"px",e.style.top=i+"px",e.style.position="absolute",e.style.zIndex="9999",e.id=I,document.body.appendChild(e)),e}(),n=x=new open_context_menu_ContextMenuSession;return b.a.render(Object(A.jsx)(o.KibanaThemeProvider,{theme$:w().theme$},Object(A.jsx)(v.EuiPopover,{className:"embPanel__optionsMenuPopover",button:i,isOpen:!0,closePopover:()=>{t.onClose&&t.onClose(),n.close()},panelPaddingSize:"none",anchorPosition:"downRight"},Object(A.jsx)(v.EuiContextMenu,{initialPanelId:"mainMenu",panels:e,"data-test-subj":t["data-test-subj"]}))),i),n}class ui_actions_execution_service_UiActionsExecutionService{constructor(){r()(this,"batchingQueue",[]),r()(this,"pendingTasks",new Set)}async execute({action:e,context:t,trigger:i},n){var r,o;const s=null!==(r=!await(null===(o=e.shouldAutoExecute)||void 0===o?void 0:o.call(e,{...t,trigger:i})))&&void 0!==r&&r,c={action:e,context:t,trigger:i,defer:Object(l.defer)(),alwaysShowPopup:!!n};if(s)this.batchingQueue.push(c);else{this.pendingTasks.add(c);try{await e.execute({...t,trigger:i}),this.pendingTasks.delete(c)}catch(e){throw this.pendingTasks.delete(c),new Error(e)}}return this.scheduleFlush(),c.defer.promise}scheduleFlush(){setTimeout((()=>{if(0===this.pendingTasks.size){const e=Object(a.uniqBy)(this.batchingQueue,(e=>e.action.id));if(e.length>0){let t=!1;for(const i of e)if(i.alwaysShowPopup){t=!0;break}t?this.showActionPopupMenu(e):1===e.length?this.executeSingleTask(e[0]):e.length>1&&this.showActionPopupMenu(e)}this.batchingQueue.splice(0,this.batchingQueue.length)}}),0)}async executeSingleTask({context:e,action:t,defer:i,trigger:n}){try{await t.execute({...e,trigger:n}),i.resolve()}catch(e){i.reject(e)}}async showActionPopupMenu(e){const t=L(await m({actions:e.map((({action:e,context:t,trigger:i})=>({action:e,context:t,trigger:i}))),title:"",closeMenu:()=>{e.forEach((e=>e.defer.resolve())),t.close()}}),{"data-test-subj":"multipleActionsContextMenu"})}}class ui_actions_service_UiActionsService{constructor({triggers:e=new Map,actions:t=new Map,triggerToActions:i=new Map}={}){r()(this,"executionService",new ui_actions_execution_service_UiActionsExecutionService),r()(this,"triggers",void 0),r()(this,"actions",void 0),r()(this,"triggerToActions",void 0),r()(this,"registerTrigger",(e=>{if(this.triggers.has(e.id))throw new Error(`Trigger [trigger.id = ${e.id}] already registered.`);const t=new trigger_internal_TriggerInternal(this,e);this.triggers.set(e.id,t),this.triggerToActions.set(e.id,[])})),r()(this,"getTrigger",(e=>{const t=this.triggers.get(e);if(!t)throw new Error(`Trigger [triggerId = ${e}] does not exist.`);return t.contract})),r()(this,"registerAction",(e=>{if(this.actions.has(e.id))throw new Error(`Action [action.id = ${e.id}] already registered.`);const t=new action_internal_ActionInternal(e);return this.actions.set(t.id,t),t})),r()(this,"unregisterAction",(e=>{if(!this.actions.has(e))throw new Error(`Action [action.id = ${e}] is not registered.`);this.actions.delete(e)})),r()(this,"hasAction",(e=>this.actions.has(e))),r()(this,"attachAction",((e,t)=>{if(!this.triggers.get(e))throw new Error(`No trigger [triggerId = ${e}] exists, for attaching action [actionId = ${t}].`);const i=this.triggerToActions.get(e);i.find((e=>e===t))||this.triggerToActions.set(e,[...i,t])})),r()(this,"detachAction",((e,t)=>{if(!this.triggers.get(e))throw new Error(`No trigger [triggerId = ${e}] exists, for detaching action [actionId = ${t}].`);const i=this.triggerToActions.get(e);this.triggerToActions.set(e,i.filter((e=>e!==t)))})),r()(this,"addTriggerAction",((e,t)=>{this.actions.has(t.id)||this.registerAction(t),this.attachAction(e,t.id)})),r()(this,"getAction",(e=>{if(!this.actions.has(e))throw new Error(`Action [action.id = ${e}] not registered.`);return this.actions.get(e)})),r()(this,"getTriggerActions",(e=>{this.getTrigger(e);return this.triggerToActions.get(e).map((e=>this.actions.get(e))).filter(Boolean)})),r()(this,"getTriggerCompatibleActions",(async(e,t)=>{const i=this.getTriggerActions(e),n=await Promise.all(i.map((i=>i.isCompatible({...t,trigger:this.getTrigger(e)}))));return i.reduce(((e,t,i)=>n[i]?[...e,t]:e),[])})),r()(this,"executeTriggerActions",(async(e,t)=>{const i=this.getTrigger(e);await i.exec(t)})),r()(this,"clear",(()=>{this.actions.clear(),this.triggers.clear(),this.triggerToActions.clear()})),r()(this,"fork",(()=>{const e=new Map,t=new Map,i=new Map;for(const[t,i]of this.triggers.entries())e.set(t,i);for(const[e,i]of this.actions.entries())t.set(e,i);for(const[e,t]of this.triggerToActions.entries())i.set(e,[...t]);return new ui_actions_service_UiActionsService({triggers:e,actions:t,triggerToActions:i})})),this.triggers=e,this.actions=t,this.triggerToActions=i}}const O="ROW_CLICK_TRIGGER",M={id:O,title:c.i18n.translate("uiActions.triggers.rowClickTitle",{defaultMessage:"Table row click"}),description:c.i18n.translate("uiActions.triggers.rowClickkDescription",{defaultMessage:"A click on a table row"})},C="VISUALIZE_FIELD_TRIGGER",S={id:C,title:"Visualize field",description:"Triggered when user wants to visualize a field."},j="VISUALIZE_GEO_FIELD_TRIGGER",P={id:j,title:"Visualize Geo field",description:"Triggered when user wants to visualize a geo field."};class plugin_UiActionsPlugin{constructor(e){r()(this,"service",new ui_actions_service_UiActionsService)}setup(e){return T(e.theme),this.service.registerTrigger(M),this.service.registerTrigger(S),this.service.registerTrigger(P),this.service}start(e){return this.service}stop(){this.service.clear()}}const D="ACTION_VISUALIZE_FIELD",k="ACTION_VISUALIZE_GEO_FIELD",R="ACTION_VISUALIZE_LENS_FIELD";function N(e){return new plugin_UiActionsPlugin(e)}}]);